<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Reference - APIS</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="../assets/_mkdocstrings.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">APIS</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href=".." class="nav-link">APIS</a>
                            </li>
                            <li class="nav-item">
                                <a href="../configuration/" class="nav-link">Configuration</a>
                            </li>
                            <li class="nav-item">
                                <a href="../customization/" class="nav-link">Customization</a>
                            </li>
                            <li class="nav-item">
                                <a href="../development/" class="nav-link">Development</a>
                            </li>
                            <li class="nav-item">
                                <a href="../features/" class="nav-link">Additional Features</a>
                            </li>
                            <li class="nav-item">
                                <a href="../glossary/" class="nav-link">Glossary</a>
                            </li>
                            <li class="nav-item">
                                <a href="../installation/" class="nav-link">Installation</a>
                            </li>
                            <li class="nav-item">
                                <a href="../ontology/" class="nav-link">Create your ontology</a>
                            </li>
                            <li class="nav-item">
                                <a href="./" class="nav-link active" aria-current="page">Reference</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                            <li class="nav-item">
                                <a rel="prev" href="../ontology/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" class="nav-link disabled">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#reference" class="nav-link">Reference</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#apis_core" class="nav-link">apis_core</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#apis_core.apis_entities" class="nav-link">apis_entities</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#apis_core.apis_metainfo" class="nav-link">apis_metainfo</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#apis_core.collections" class="nav-link">collections</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#apis_core.generic" class="nav-link">generic</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#apis_core.history" class="nav-link">history</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#apis_core.relations" class="nav-link">relations</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#apis_core.uris" class="nav-link">uris</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#apis_core.urls" class="nav-link">urls</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#apis_core.utils" class="nav-link">utils</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="reference">Reference</h1>
<!-- vale Vale.Spelling = NO -->



<div class="doc doc-object doc-module">



<a id="apis_core"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h2 id="apis_core.apis_entities" class="doc doc-heading">
            <code>apis_entities</code>


</h2>

    <div class="doc doc-contents ">









  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h3 id="apis_core.apis_entities.abc" class="doc doc-heading">
            <code>abc</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="apis_core.apis_entities.abc.E53_Place" class="doc doc-heading">
            <code>E53_Place</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="django.db.models.Model">Model</span></code></p>


        <p>The feature_code field refers to the geonames feature codes, as
listed on https://www.geonames.org/export/codes.html</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/apis_entities/abc.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">E53_Place</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The feature_code field refers to the geonames feature codes, as</span>
<span class="sd">    listed on https://www.geonames.org/export/codes.html</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">label</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">latitude</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;latitude&quot;</span><span class="p">))</span>
    <span class="n">longitude</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;longitude&quot;</span><span class="p">))</span>
    <span class="n">feature_code</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;feature code&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;&lt;a href=&quot;https://www.geonames.org/export/codes.html&quot; target=&quot;_blank&quot;&gt;Geonames Feature Code List&lt;/a&gt;&#39;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;place&quot;</span><span class="p">)</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;places&quot;</span><span class="p">)</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="ow">or</span> <span class="n">force_str</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;No label&quot;</span><span class="p">))</span>

    <span class="n">import_definitions</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;https://d-nb.info/*|/.*.rdf&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">load_uri_using_path</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">place</span><span class="o">.</span><span class="n">E53_PlaceFromDNB</span>
        <span class="p">),</span>
        <span class="s2">&quot;https://sws.geonames.org/*|/.*.rdf*&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">load_uri_using_path</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">place</span><span class="o">.</span><span class="n">E53_PlaceFromGeonames</span>
        <span class="p">),</span>
        <span class="s2">&quot;http://www.wikidata.org/*|/.*.rdf&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">load_uri_using_path</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">place</span><span class="o">.</span><span class="n">E53_PlaceFromWikidata</span>
        <span class="p">),</span>
    <span class="p">}</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_rdf_types</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">CRM</span><span class="o">.</span><span class="n">E53_Place</span><span class="p">]</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_from_string</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">string</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="apis_core.apis_entities.filtersets" class="doc doc-heading">
            <code>filtersets</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="apis_core.apis_entities.filtersets.ModelSearchFilter" class="doc doc-heading">
            <code>ModelSearchFilter</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="django_filters.CharFilter">CharFilter</span></code></p>


        <p>This filter is a customized CharFilter that
uses the <code>generate_search_filter</code> method to
adapt the search filter to the model that is
searched.
It also extracts sets the help text based on
the fields searched.</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/apis_entities/filtersets.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ModelSearchFilter</span><span class="p">(</span><span class="n">django_filters</span><span class="o">.</span><span class="n">CharFilter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This filter is a customized CharFilter that</span>
<span class="sd">    uses the `generate_search_filter` method to</span>
<span class="sd">    adapt the search filter to the model that is</span>
<span class="sd">    searched.</span>
<span class="sd">    It also extracts sets the help text based on</span>
<span class="sd">    the fields searched.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;help_text&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">extra</span><span class="p">:</span>
            <span class="n">field_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">verbose_name</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">default_search_fields</span><span class="p">(</span><span class="n">model</span><span class="p">)]</span>
            <span class="c1"># use force_str on the fields verbose names to convert</span>
            <span class="c1"># lazy instances to string and join the results</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">force_str</span><span class="p">,</span> <span class="n">field_names</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extra</span><span class="p">[</span><span class="s2">&quot;help_text&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Search in fields: </span><span class="si">{</span><span class="n">fields</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qs</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">qs</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">generate_search_filter</span><span class="p">(</span><span class="n">qs</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="apis_core.apis_entities.models" class="doc doc-heading">
            <code>models</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="apis_core.apis_entities.models.AbstractEntity" class="doc doc-heading">
            <code>AbstractEntity</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RootObject (apis_core.apis_metainfo.models.RootObject)" href="#apis_core.apis_metainfo.models.RootObject">RootObject</a></code></p>


        <p>Abstract super class which encapsulates common logic between the
different entity kinds and provides various methods relating to either
all or one specific entity kind.</p>
<p>Most of the class methods are designed to be used in the subclass as they
are considering contexts which depend on the subclass entity type.
So they are to be understood in that dynamic context.</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/apis_entities/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AbstractEntity</span><span class="p">(</span><span class="n">RootObject</span><span class="p">,</span> <span class="n">metaclass</span><span class="o">=</span><span class="n">AbstractEntityModelBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract super class which encapsulates common logic between the</span>
<span class="sd">    different entity kinds and provides various methods relating to either</span>
<span class="sd">    all or one specific entity kind.</span>

<span class="sd">    Most of the class methods are designed to be used in the subclass as they</span>
<span class="sd">    are considering contexts which depend on the subclass entity type.</span>
<span class="sd">    So they are to be understood in that dynamic context.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">cached_property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_prev_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">NEXT_PREV</span><span class="p">:</span>
            <span class="n">prev_instance</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">id__lt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;-id&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">only</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">first</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">prev_instance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">prev_instance</span><span class="o">.</span><span class="n">id</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">cached_property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_next_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">NEXT_PREV</span><span class="p">:</span>
            <span class="n">next_instance</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">id__gt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">only</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">first</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">next_instance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">next_instance</span><span class="o">.</span><span class="n">id</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">import_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">import_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;same_as&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_uris</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;same_as&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;relations&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_relations_to_uris</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;relations&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_default_uri</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">route</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;GetEntityGenericRoot&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pk&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">})</span>
        <span class="k">except</span> <span class="n">NoReverseMatch</span><span class="p">:</span>
            <span class="n">route</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;apis_core:GetEntityGeneric&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pk&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">})</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">apis_base_uri</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base</span><span class="si">}{</span><span class="n">route</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_facet_label</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;db_string&quot;</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_fields</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">F</span><span class="p">(</span><span class="s2">&quot;db_string&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Concat</span><span class="p">(</span>
            <span class="n">Value</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">verbose_name</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">),</span>
            <span class="n">F</span><span class="p">(</span><span class="s2">&quot;pk&quot;</span><span class="p">),</span>
            <span class="n">output_field</span><span class="o">=</span><span class="n">CharField</span><span class="p">(),</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_facets</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">queryset</span><span class="p">):</span>
        <span class="n">facets</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;enable_facets&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">my_content_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">queryset</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>

            <span class="c1"># we filter all the relations that are somehow connected to instances of this queryset</span>
            <span class="c1"># we are only interested in the id and the type of the object the relations point to,</span>
            <span class="c1"># so we store those in `target_id` and `target_content_type`</span>
            <span class="n">query_filter</span> <span class="o">=</span> <span class="n">Q</span><span class="p">(</span>
                <span class="n">subj_content_type</span><span class="o">=</span><span class="n">my_content_type</span><span class="p">,</span> <span class="n">subj_object_id__in</span><span class="o">=</span><span class="n">queryset</span>
            <span class="p">)</span> <span class="o">|</span> <span class="n">Q</span><span class="p">(</span>
                <span class="n">Q</span><span class="p">(</span><span class="n">obj_content_type</span><span class="o">=</span><span class="n">my_content_type</span><span class="p">,</span> <span class="n">obj_object_id__in</span><span class="o">=</span><span class="n">queryset</span><span class="p">),</span>
                <span class="o">~</span><span class="n">Q</span><span class="p">(</span><span class="n">subj_content_type</span><span class="o">=</span><span class="n">my_content_type</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">rels</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">Relation</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">to_content_type_with_targets</span><span class="p">(</span><span class="n">my_content_type</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span>
                    <span class="s2">&quot;target_id&quot;</span><span class="p">,</span> <span class="s2">&quot;target_content_type&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">query_filter</span><span class="p">)</span>

            <span class="c1"># we use the ids to get a the labels of the targets</span>
            <span class="c1"># and we store those in an id: label dict</span>
            <span class="n">target_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">rel</span><span class="p">[</span><span class="s2">&quot;target_id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">rels</span><span class="p">]</span>
            <span class="n">entity_classes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">AbstractEntity</span><span class="p">),</span> <span class="n">apps</span><span class="o">.</span><span class="n">get_models</span><span class="p">())</span>
            <span class="p">)</span>

            <span class="c1"># this should be moved to an EntityManager once the entites app is in apis_core</span>
            <span class="n">when_clauses_classes</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">When</span><span class="p">(</span>
                    <span class="o">**</span><span class="p">{</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">__isnull&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
                    <span class="n">then</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_facet_label</span><span class="p">(),</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">entity_classes</span>
            <span class="p">]</span>
            <span class="n">identifiers</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">RootObject</span><span class="o">.</span><span class="n">objects_inheritance</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">id__in</span><span class="o">=</span><span class="n">target_ids</span><span class="p">)</span>
                <span class="o">.</span><span class="n">select_subclasses</span><span class="p">()</span>
                <span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">Case</span><span class="p">(</span><span class="o">*</span><span class="n">when_clauses_classes</span><span class="p">))</span>
                <span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s2">&quot;pk&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">identifiers</span> <span class="o">=</span> <span class="p">{</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">]:</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">identifiers</span><span class="p">}</span>

            <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">rels</span><span class="p">:</span>
                <span class="n">_id</span> <span class="o">=</span> <span class="n">rel</span><span class="p">[</span><span class="s2">&quot;target_id&quot;</span><span class="p">]</span>
                <span class="n">content_type</span> <span class="o">=</span> <span class="n">rel</span><span class="p">[</span><span class="s2">&quot;target_content_type&quot;</span><span class="p">]</span>
                <span class="n">facetname</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;relation_to_&quot;</span> <span class="o">+</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_id</span><span class="p">(</span><span class="n">content_type</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">_id</span> <span class="ow">in</span> <span class="n">facets</span><span class="p">[</span><span class="n">facetname</span><span class="p">]:</span>
                    <span class="n">facets</span><span class="p">[</span><span class="n">facetname</span><span class="p">][</span><span class="n">_id</span><span class="p">][</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">facets</span><span class="p">[</span><span class="n">facetname</span><span class="p">][</span><span class="n">_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">identifiers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">_id</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">),</span>
                    <span class="p">}</span>
        <span class="k">return</span> <span class="n">facets</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="apis_core.apis_entities.views" class="doc doc-heading">
            <code>views</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="apis_core.apis_entities.views.EntitiesAutocomplete" class="doc doc-heading">
            <code>EntitiesAutocomplete</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="dal.autocomplete.Select2QuerySetView">Select2QuerySetView</span></code></p>


        <p>This endpoint allows us to use autocomplete over multiple model classes.
It takes a parameter <code>entities</code> which is a list of ContentType natural
keys and searches for the query in all instances of those entities
(using <code>generate_search_filter</code>, which means it uses a different search
approach for every model).
The return values of the endpoint are then prefixed with the id of the
contenttype of the results, separated by an underscore.</p>
<p>Example:
Using this endpoint with the parameters:</p>
<pre><code>?entities=apis_ontology.person&amp;entities=apis_ontology.place&amp;q=ammer
</code></pre>
<p>gives you all the persons and places that have <code>ammer</code> in their names
and labels.</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/apis_entities/views.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">EntitiesAutocomplete</span><span class="p">(</span><span class="n">autocomplete</span><span class="o">.</span><span class="n">Select2QuerySetView</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This endpoint allows us to use autocomplete over multiple model classes.</span>
<span class="sd">    It takes a parameter `entities` which is a list of ContentType natural</span>
<span class="sd">    keys and searches for the query in all instances of those entities</span>
<span class="sd">    (using `generate_search_filter`, which means it uses a different search</span>
<span class="sd">    approach for every model).</span>
<span class="sd">    The return values of the endpoint are then prefixed with the id of the</span>
<span class="sd">    contenttype of the results, separated by an underscore.</span>

<span class="sd">    Example:</span>
<span class="sd">    Using this endpoint with the parameters:</span>

<span class="sd">        ?entities=apis_ontology.person&amp;entities=apis_ontology.place&amp;q=ammer</span>

<span class="sd">    gives you all the persons and places that have `ammer` in their names</span>
<span class="sd">    and labels.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_result_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">content_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">content_type</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">_&quot;</span> <span class="o">+</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_result_value</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">Q</span><span class="p">()</span>
        <span class="n">entities</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s2">&quot;entities&quot;</span><span class="p">):</span>
            <span class="n">app_label</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
            <span class="n">content_type</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span>
                <span class="n">ContentType</span><span class="p">,</span> <span class="n">app_label</span><span class="o">=</span><span class="n">app_label</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span>
            <span class="p">)</span>
            <span class="n">entities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">content_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">entities</span><span class="p">:</span>
            <span class="n">entities</span> <span class="o">=</span> <span class="n">get_entity_content_types</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">content_type</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">RootObject</span><span class="o">.</span><span class="n">objects_inheritance</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span><span class="o">.</span><span class="n">_get_ancestors_path</span><span class="p">(</span>
                <span class="n">content_type</span><span class="o">.</span><span class="n">model_class</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">q</span> <span class="o">|=</span> <span class="n">Q</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">__isnull&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span> <span class="o">&amp;</span> <span class="n">generate_search_filter</span><span class="p">(</span>
                <span class="n">content_type</span><span class="o">.</span><span class="n">model_class</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">__&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">RootObject</span><span class="o">.</span><span class="n">objects_inheritance</span><span class="o">.</span><span class="n">select_subclasses</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="apis_core.apis_metainfo" class="doc doc-heading">
            <code>apis_metainfo</code>


</h2>

    <div class="doc doc-contents ">









  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h3 id="apis_core.apis_metainfo.models" class="doc doc-heading">
            <code>models</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="apis_core.apis_metainfo.models.RootObject" class="doc doc-heading">
            <code>RootObject</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GenericModel (apis_core.generic.abc.GenericModel)" href="#apis_core.generic.abc.GenericModel">GenericModel</a></code>, <code><span title="django.db.models.Model">Model</span></code></p>


        <p>The very root thing that can exist in a given ontology. Several classes inherit from it.
By having one overarching super class we gain the advantage of unique identifiers.</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/apis_metainfo/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RootObject</span><span class="p">(</span><span class="n">GenericModel</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The very root thing that can exist in a given ontology. Several classes inherit from it.</span>
<span class="sd">    By having one overarching super class we gain the advantage of unique identifiers.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">objects</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Manager</span><span class="p">()</span>
    <span class="n">objects_inheritance</span> <span class="o">=</span> <span class="n">InheritanceManager</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="apis_core.collections" class="doc doc-heading">
            <code>collections</code>


</h2>

    <div class="doc doc-contents ">









  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h3 id="apis_core.collections.filters" class="doc doc-heading">
            <code>filters</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="apis_core.collections.filters.CollectionsIncludeExcludeFilter" class="doc doc-heading">
            <code>CollectionsIncludeExcludeFilter</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="django_filters.filters.ModelMultipleChoiceFilter">ModelMultipleChoiceFilter</span></code></p>


        <p>The CollectionsIncludeExcludeFilter provides to ModelMultipleChoiceFilters that allow
to filter model instances that are either <strong>in</strong> a collection OR (or AND) are <strong>not in</strong>
a collection.</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/collections/filters.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CollectionsIncludeExcludeFilter</span><span class="p">(</span><span class="n">django_filters</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">ModelMultipleChoiceFilter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The CollectionsIncludeExcludeFilter provides to ModelMultipleChoiceFilters that allow</span>
<span class="sd">    to filter model instances that are either **in** a collection OR (or AND) are **not in**</span>
<span class="sd">    a collection.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">RowColumnMultiValueField</span><span class="p">(</span>
            <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">field</span><span class="p">,</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">field</span><span class="p">],</span>
            <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;include&quot;</span><span class="p">,</span> <span class="s2">&quot;exclude&quot;</span><span class="p">],</span>
            <span class="n">required</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">extra</span><span class="p">[</span><span class="s2">&quot;required&quot;</span><span class="p">],</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qs</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">qs</span>
        <span class="n">include</span> <span class="o">=</span> <span class="n">exclude</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">Q</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">content_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">qs</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
            <span class="n">skoscollectioncontentobject</span> <span class="o">=</span> <span class="n">apps</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span>
                <span class="s2">&quot;collections.SkosCollectionContentObject&quot;</span>
            <span class="p">)</span>
            <span class="n">include</span><span class="p">,</span> <span class="n">exclude</span> <span class="o">=</span> <span class="n">value</span>
            <span class="n">include_ids</span> <span class="o">=</span> <span class="n">skoscollectioncontentobject</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">,</span> <span class="n">collection__in</span><span class="o">=</span><span class="n">include</span>
            <span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s2">&quot;object_id&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">include</span><span class="p">:</span>
                <span class="n">q</span> <span class="o">&amp;=</span> <span class="n">Q</span><span class="p">(</span><span class="n">pk__in</span><span class="o">=</span><span class="n">include_ids</span><span class="p">)</span>
            <span class="n">exclude_ids</span> <span class="o">=</span> <span class="n">skoscollectioncontentobject</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">,</span> <span class="n">collection__in</span><span class="o">=</span><span class="n">exclude</span>
            <span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s2">&quot;object_id&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">exclude</span><span class="p">:</span>
                <span class="n">q</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">Q</span><span class="p">(</span><span class="n">pk__in</span><span class="o">=</span><span class="n">exclude_ids</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">LookupError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Not filtering for collections: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">qs</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="apis_core.collections.models" class="doc doc-heading">
            <code>models</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="apis_core.collections.models.SkosCollection" class="doc doc-heading">
            <code>SkosCollection</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GenericModel (apis_core.generic.abc.GenericModel)" href="#apis_core.generic.abc.GenericModel">GenericModel</a></code>, <code><span title="django.db.models.Model">Model</span></code></p>


        <p>SKOS collections are labeled and/or ordered groups of SKOS concepts.
Collections are useful where a group of concepts shares something in common,
and it is convenient to group them under a common label, or
where some concepts can be placed in a meaningful order.</p>
<p>Miles, Alistair, and Sean Bechhofer. "SKOS simple knowledge
organization system reference. W3C recommendation (2009)."</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/collections/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SkosCollection</span><span class="p">(</span><span class="n">GenericModel</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    SKOS collections are labeled and/or ordered groups of SKOS concepts.</span>
<span class="sd">    Collections are useful where a group of concepts shares something in common,</span>
<span class="sd">    and it is convenient to group them under a common label, or</span>
<span class="sd">    where some concepts can be placed in a meaningful order.</span>

<span class="sd">    Miles, Alistair, and Sean Bechhofer. &quot;SKOS simple knowledge</span>
<span class="sd">    organization system reference. W3C recommendation (2009).&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="s2">&quot;skos:prefLabel&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Collection label or name&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">label_lang</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="s2">&quot;skos:prefLabel language&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Language of preferred label given above&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">creator</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="s2">&quot;dc:creator&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Person or organisation that created this collection&quot;</span>
        <span class="s2">&quot;If more than one list all using a semicolon ;&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">contributor</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="s2">&quot;dc:contributor&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Person or organisation that made contributions to the collection&quot;</span>
        <span class="s2">&quot;If more than one list all using a semicolon ;&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">objects</span> <span class="o">=</span> <span class="n">SkosCollectionManager</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="nb">object</span><span class="p">):</span>
        <span class="n">content_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
        <span class="n">SkosCollectionContentObject</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span>
            <span class="n">collection</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">,</span> <span class="n">object_id</span><span class="o">=</span><span class="n">instance</span><span class="o">.</span><span class="n">pk</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="nb">object</span><span class="p">):</span>
        <span class="n">content_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
        <span class="n">SkosCollectionContentObject</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">collection</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">,</span> <span class="n">object_id</span><span class="o">=</span><span class="n">instance</span><span class="o">.</span><span class="n">pk</span>
        <span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">parent_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">content_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">sccos</span> <span class="o">=</span> <span class="n">SkosCollectionContentObject</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">,</span> <span class="n">object_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sccos</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sccos</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">collection</span>
        <span class="k">raise</span> <span class="n">SkosCollection</span><span class="o">.</span><span class="n">MultipleObjectsReturned</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s1">&quot; is part of multiple collections&#39;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="apis_core.collections.models.SkosCollectionContentObject" class="doc doc-heading">
            <code>SkosCollectionContentObject</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GenericModel (apis_core.generic.abc.GenericModel)" href="#apis_core.generic.abc.GenericModel">GenericModel</a></code>, <code><span title="django.db.models.Model">Model</span></code></p>


        <p><em>Throughtable</em> datamodel to connect collections to arbitrary content</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/collections/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SkosCollectionContentObject</span><span class="p">(</span><span class="n">GenericModel</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    *Throughtable* datamodel to connect collections to arbitrary content</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">collection</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">SkosCollection</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>

    <span class="n">content_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">ContentType</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">object_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">()</span>
    <span class="n">content_object</span> <span class="o">=</span> <span class="n">GenericForeignKey</span><span class="p">(</span><span class="s2">&quot;content_type&quot;</span><span class="p">,</span> <span class="s2">&quot;object_id&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">content_object</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="apis_core.collections.signals" class="doc doc-heading">
            <code>signals</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="apis_core.collections.signals.add_to_session_collection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_to_session_collection</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">created</span><span class="p">,</span> <span class="n">raw</span><span class="p">,</span> <span class="n">using</span><span class="p">,</span> <span class="n">update_fields</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Add a created apis_core.history model instance to all the SkosCollections
that are listed in the <code>session_collections</code> session variable.
This needs the 'crum.CurrentRequestUserMiddleware' middleware to
be enabled.</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/collections/signals.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@receiver</span><span class="p">(</span><span class="n">post_save</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">add_to_session_collection</span><span class="p">(</span>
    <span class="n">sender</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">created</span><span class="p">,</span> <span class="n">raw</span><span class="p">,</span> <span class="n">using</span><span class="p">,</span> <span class="n">update_fields</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a created apis_core.history model instance to all the SkosCollections</span>
<span class="sd">    that are listed in the `session_collections` session variable.</span>
<span class="sd">    This needs the &#39;crum.CurrentRequestUserMiddleware&#39; middleware to</span>
<span class="sd">    be enabled.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">request</span> <span class="o">=</span> <span class="n">get_current_request</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">APISHistoryTableBase</span><span class="p">)</span> <span class="ow">and</span> <span class="n">request</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">pk</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;session_collections&quot;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">sc</span> <span class="o">=</span> <span class="n">SkosCollection</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
            <span class="n">content_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
            <span class="n">SkosCollectionContentObject</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                <span class="n">collection</span><span class="o">=</span><span class="n">sc</span><span class="p">,</span>
                <span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">,</span>
                <span class="n">object_id</span><span class="o">=</span><span class="n">instance</span><span class="o">.</span><span class="n">history_id</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Tagged </span><span class="si">{</span><span class="n">instance</span><span class="si">}</span><span class="s2"> with tag </span><span class="si">{</span><span class="n">sc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="apis_core.collections.templatetags" class="doc doc-heading">
            <code>templatetags</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h4 id="apis_core.collections.templatetags.collections" class="doc doc-heading">
            <code>collections</code>


</h4>

    <div class="doc doc-contents ">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="apis_core.collections.templatetags.collections.collection_object_collection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">collection_object_collection</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">skoscollectioncollectionobjects</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Provide a button to change the connection between an object and
a collection to point to the collection the collection is in.</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/collections/templatetags/collections.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@register</span><span class="o">.</span><span class="n">inclusion_tag</span><span class="p">(</span>
    <span class="s2">&quot;collections/collection_object_collection.html&quot;</span><span class="p">,</span> <span class="n">takes_context</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">collection_object_collection</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">skoscollectioncollectionobjects</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provide a button to change the connection between an object and</span>
<span class="sd">    a collection to point to the collection the collection is in.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">skoscollectioncollectionobjects</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">context</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Multiple collections found to toggle, please check `collection_object_collection`&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">skoscollectioncollectionobjects</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">collectionobject</span> <span class="o">=</span> <span class="n">skoscollectioncollectionobjects</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="n">context</span><span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">collectionobject</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">parent_collection</span>
        <span class="n">context</span><span class="p">[</span><span class="s2">&quot;collectionobject&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">collectionobject</span>
        <span class="n">context</span><span class="p">[</span><span class="s2">&quot;content_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span>
    <span class="k">return</span> <span class="n">context</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="apis_core.collections.templatetags.collections.collection_object_collection_by_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">collection_object_collection_by_id</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">*</span><span class="n">collection_ids</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Wrapper templatetag to allow using <code>collection_object_parent</code> with
just the <code>ids</code> of collections.</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/collections/templatetags/collections.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@register</span><span class="o">.</span><span class="n">inclusion_tag</span><span class="p">(</span>
    <span class="s2">&quot;collections/collection_object_collection.html&quot;</span><span class="p">,</span> <span class="n">takes_context</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">collection_object_collection_by_id</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">*</span><span class="n">collection_ids</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wrapper templatetag to allow using `collection_object_parent` with</span>
<span class="sd">    just the `ids` of collections.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">content_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="n">sccos</span> <span class="o">=</span> <span class="n">SkosCollectionContentObject</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
        <span class="n">collection__in</span><span class="o">=</span><span class="n">collection_ids</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">,</span> <span class="n">object_id</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">collection_object_collection</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">sccos</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="apis_core.collections.templatetags.collections.collection_session_toggle_by_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">collection_session_toggle_by_id</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">collection_id</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Provide a checkbox to toggle if a session collection is active.
The checkbox calls the CollectionSessionToggle view.</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/collections/templatetags/collections.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@register</span><span class="o">.</span><span class="n">inclusion_tag</span><span class="p">(</span>
    <span class="s2">&quot;collections/collection_session_toggle.html&quot;</span><span class="p">,</span> <span class="n">takes_context</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">collection_session_toggle_by_id</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">collection_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provide a checkbox to toggle if a session collection is active.</span>
<span class="sd">    The checkbox calls the CollectionSessionToggle view.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">session_collections</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;session_collections&quot;</span><span class="p">,</span> <span class="p">[])</span>
    <span class="n">context</span><span class="p">[</span><span class="s2">&quot;collection&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SkosCollection</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">collection_id</span><span class="p">)</span>
    <span class="n">context</span><span class="p">[</span><span class="s2">&quot;enabled&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">collection_id</span> <span class="ow">in</span> <span class="n">session_collections</span>
    <span class="k">return</span> <span class="n">context</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="apis_core.collections.templatetags.collections.collection_toggle" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">collection_toggle</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">collection</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Provide a button to add or remove a connection between a
collection and an object.</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/collections/templatetags/collections.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@register</span><span class="o">.</span><span class="n">inclusion_tag</span><span class="p">(</span><span class="s2">&quot;collections/collection_toggle.html&quot;</span><span class="p">,</span> <span class="n">takes_context</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">collection_toggle</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">collection</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provide a button to add or remove a connection between a</span>
<span class="sd">    collection and an object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">content_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="n">context</span><span class="p">[</span><span class="s2">&quot;content_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">content_type</span>
    <span class="n">context</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span>
    <span class="n">context</span><span class="p">[</span><span class="s2">&quot;collection&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">collection</span>
    <span class="n">context</span><span class="p">[</span><span class="s2">&quot;exists&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SkosCollectionContentObject</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
        <span class="n">object_id</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="n">collection</span>
    <span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">context</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="apis_core.collections.templatetags.collections.collection_toggle_by_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">collection_toggle_by_id</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">collectionid</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Wrapper templatetag to allow using <code>collection_toggle</code>
with just the <code>id</code> of the collection.</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/collections/templatetags/collections.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@register</span><span class="o">.</span><span class="n">inclusion_tag</span><span class="p">(</span><span class="s2">&quot;collections/collection_toggle.html&quot;</span><span class="p">,</span> <span class="n">takes_context</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">collection_toggle_by_id</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">collectionid</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wrapper templatetag to allow using `collection_toggle`</span>
<span class="sd">    with just the `id` of the collection.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">collection</span> <span class="o">=</span> <span class="n">SkosCollection</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">collectionid</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">collection_toggle</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">collection</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="apis_core.collections.views" class="doc doc-heading">
            <code>views</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="apis_core.collections.views.CollectionObjectCollection" class="doc doc-heading">
            <code>CollectionObjectCollection</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="django.contrib.auth.mixins.LoginRequiredMixin">LoginRequiredMixin</span></code>, <code><a class="autorefs autorefs-internal" title="ContentObjectMixin (apis_core.collections.views.ContentObjectMixin)" href="#apis_core.collections.views.ContentObjectMixin">ContentObjectMixin</a></code>, <code><span title="django.views.generic.base.TemplateView">TemplateView</span></code></p>


        <p>Change the requested CollectionObjects collection to point to the collection the
current collection is in.</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/collections/views.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CollectionObjectCollection</span><span class="p">(</span><span class="n">LoginRequiredMixin</span><span class="p">,</span> <span class="n">ContentObjectMixin</span><span class="p">,</span> <span class="n">TemplateView</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Change the requested CollectionObjects collection to point to the collection the</span>
<span class="sd">    current collection is in.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">template_name</span> <span class="o">=</span> <span class="s2">&quot;collections/collection_object_collection.html&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">collectionobject</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span>
            <span class="n">SkosCollectionContentObject</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;collectionobject&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="n">collectionobject</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">parent_collection</span>
        <span class="n">collectionobject</span><span class="o">.</span><span class="n">collection</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="n">collectionobject</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s2">&quot;collectionobject&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">collectionobject</span>
        <span class="k">return</span> <span class="n">context</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="apis_core.collections.views.CollectionSessionToggle" class="doc doc-heading">
            <code>CollectionSessionToggle</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="django.contrib.auth.mixins.LoginRequiredMixin">LoginRequiredMixin</span></code>, <code><span title="django.views.generic.base.TemplateView">TemplateView</span></code></p>


        <p>Toggle the existence of an SkosCollection in the <code>session_collections</code>
session variable.
This can be used in combination with the
<code>collections.signals.add_to_session_collection</code> signal, to add objects
to a collection if the collections id is listed in the session variable.
The equivalent templateatag that calls this view is
<code>collections.templatetags.collections.collection_session_toggle_by_id</code></p>







              <details class="quote">
                <summary>Source code in <code>apis_core/collections/views.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CollectionSessionToggle</span><span class="p">(</span><span class="n">LoginRequiredMixin</span><span class="p">,</span> <span class="n">TemplateView</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Toggle the existence of an SkosCollection in the `session_collections`</span>
<span class="sd">    session variable.</span>
<span class="sd">    This can be used in combination with the</span>
<span class="sd">    `collections.signals.add_to_session_collection` signal, to add objects</span>
<span class="sd">    to a collection if the collections id is listed in the session variable.</span>
<span class="sd">    The equivalent templateatag that calls this view is</span>
<span class="sd">    `collections.templatetags.collections.collection_session_toggle_by_id`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">template_name</span> <span class="o">=</span> <span class="s2">&quot;collections/collection_session_toggle.html&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ctx</span><span class="p">[</span><span class="s2">&quot;collection&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skoscollection</span>
        <span class="n">ctx</span><span class="p">[</span><span class="s2">&quot;enabled&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skoscollection</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_collections</span>
        <span class="k">return</span> <span class="n">ctx</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skoscollection</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span>
            <span class="n">SkosCollection</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;skoscollection&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session_collections</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;session_collections&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session_collections</span> <span class="o">^=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">skoscollection</span><span class="o">.</span><span class="n">id</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="p">[</span><span class="s2">&quot;session_collections&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session_collections</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">redirect_to</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">redirect_to</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="apis_core.collections.views.CollectionToggle" class="doc doc-heading">
            <code>CollectionToggle</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="django.contrib.auth.mixins.LoginRequiredMixin">LoginRequiredMixin</span></code>, <code><a class="autorefs autorefs-internal" title="ContentObjectMixin (apis_core.collections.views.ContentObjectMixin)" href="#apis_core.collections.views.ContentObjectMixin">ContentObjectMixin</a></code>, <code><span title="django.views.generic.base.TemplateView">TemplateView</span></code></p>


        <p>Toggle a collection - if a CollectionObject connecting the requested object
and collection does not exist, then create it. If it does exist, delete it.</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/collections/views.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span>
<span class="normal">99</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CollectionToggle</span><span class="p">(</span><span class="n">LoginRequiredMixin</span><span class="p">,</span> <span class="n">ContentObjectMixin</span><span class="p">,</span> <span class="n">TemplateView</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Toggle a collection - if a CollectionObject connecting the requested object</span>
<span class="sd">    and collection does not exist, then create it. If it does exist, delete it.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">template_name</span> <span class="o">=</span> <span class="s2">&quot;collections/collection_toggle.html&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collection</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">SkosCollection</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;collection&quot;</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s2">&quot;exists&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">created</span>
        <span class="n">context</span><span class="p">[</span><span class="s2">&quot;collection&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection</span>
        <span class="k">return</span> <span class="n">context</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">scco</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">created</span> <span class="o">=</span> <span class="n">SkosCollectionContentObject</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span>
            <span class="n">collection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="p">,</span>
            <span class="n">content_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">obj_content_type</span><span class="p">,</span>
            <span class="n">object_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">created</span><span class="p">:</span>
            <span class="n">scco</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">redirect_to</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">redirect_to</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="apis_core.collections.views.ContentObjectMixin" class="doc doc-heading">
            <code>ContentObjectMixin</code>


</h4>


    <div class="doc doc-contents ">


        <p>Setup the ContentType and the object used by a view, based on the
<code>content_type_id</code> and the <code>object_id</code> arguments passed in the URL.</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/collections/views.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ContentObjectMixin</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Setup the ContentType and the object used by a view, based on the</span>
<span class="sd">    `content_type_id` and the `object_id` arguments passed in the URL.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obj_content_type</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span>
            <span class="n">ContentType</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;content_type_id&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">obj_content_type</span><span class="o">.</span><span class="n">model_class</span><span class="p">(),</span> <span class="n">pk</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;object_id&quot;</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s2">&quot;content_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj_content_type</span>
        <span class="n">context</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span>
        <span class="k">return</span> <span class="n">context</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="apis_core.generic" class="doc doc-heading">
            <code>generic</code>


</h2>

    <div class="doc doc-contents ">









  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h3 id="apis_core.generic.abc" class="doc doc-heading">
            <code>abc</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="apis_core.generic.abc.GenericModel" class="doc doc-heading">
            <code>GenericModel</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="django.db.models.Model">Model</span></code></p>








              <details class="quote">
                <summary>Source code in <code>apis_core/generic/abc.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">GenericModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">id</span> <span class="o">:=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; (ID: </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">content_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_listview_url</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="n">ct</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;apis_core:generic:list&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">ct</span><span class="p">])</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_createview_url</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="n">ct</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;apis_core:generic:create&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">ct</span><span class="p">])</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_importview_url</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="n">ct</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;apis_core:generic:import&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">ct</span><span class="p">])</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_openapi_tags</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">mro_paths</span><span class="p">(</span><span class="bp">cls</span><span class="p">)]</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_namespace_prefix</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="n">ct</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rdf_namespace_prefix</span><span class="p">()</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">ct</span><span class="o">.</span><span class="n">model</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_namespace_uri</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">apis_base_uri</span><span class="p">()</span> <span class="o">+</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_listview_url</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_rdf_types</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_edit_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ct</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;apis_core:generic:update&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">ct</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_duplicate_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ct</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;apis_core:generic:duplicate&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">ct</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_enrich_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ct</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;apis_core:generic:enrich&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">ct</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ct</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;apis_core:generic:detail&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">ct</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_delete_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ct</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;apis_core:generic:delete&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">ct</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_merge_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_id</span><span class="p">):</span>
        <span class="n">ct</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;apis_core:generic:merge&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">ct</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">other_id</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_select_merge_or_enrich_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ct</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;apis_core:generic:selectmergeorenrich&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">ct</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_create_success_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_update_success_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_edit_url</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_api_detail_endpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ct</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;apis_core:generic:genericmodelapi-detail&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">ct</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">])</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_change_permission</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">permission_fullname</span><span class="p">(</span><span class="s2">&quot;change&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_add_permission</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">permission_fullname</span><span class="p">(</span><span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_delete_permission</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">permission_fullname</span><span class="p">(</span><span class="s2">&quot;delete&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_view_permission</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">permission_fullname</span><span class="p">(</span><span class="s2">&quot;view&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_verbose_name_plural</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">verbose_name_plural</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_verbose_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">verbose_name</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">valid_import_url</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if an URI is a can be imported.</span>
<span class="sd">        The exact fetching logic for an URI is defined in the</span>
<span class="sd">        `import_definitions` attribute of the class.</span>
<span class="sd">        `import_definitions` has to be a dict, mapping a regex</span>
<span class="sd">        matching the URI to a callable taking the URI as an argument.</span>
<span class="sd">        This method check if there is a callable defined for this URI.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">uri</span> <span class="o">=</span> <span class="n">get_autocomplete_data_and_normalized_uri</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">regex</span><span class="p">,</span> <span class="n">fn</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;import_definitions&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">uri</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">fn</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">fetch_from</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Normalize the URI and extract the autocomplete data.</span>
<span class="sd">        Then try to fetch data from an URI:</span>
<span class="sd">        Check if there is import logic configured for this URI and if</span>
<span class="sd">        so, use that import logic to fetch the data.</span>
<span class="sd">        Finally, combine the fetched data and the autocomplete data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Fetch from </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">uri</span><span class="p">)</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">nuri</span> <span class="o">=</span> <span class="n">get_autocomplete_data_and_normalized_uri</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fn</span> <span class="o">:=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">valid_import_url</span><span class="p">(</span><span class="n">nuri</span><span class="p">):</span>
            <span class="n">fetcheddata</span> <span class="o">=</span> <span class="n">fn</span><span class="p">(</span><span class="n">nuri</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
            <span class="c1"># merge the two dicts</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">fetcheddata</span> <span class="o">|</span> <span class="n">data</span>
            <span class="c1"># combine values that exist in both dicts</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">fetcheddata</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
                <span class="n">ret</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">fetcheddata</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">ret</span>
        <span class="k">raise</span> <span class="n">ImproperlyConfigured</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Import not configured for URI </span><span class="si">{</span><span class="n">uri</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">import_from</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">allow_empty</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetch data from an URI and create a model instance using</span>
<span class="sd">        that data. If the `allow_empty` argument is set, this also</span>
<span class="sd">        creates a model instance if the data fetched was empty. This</span>
<span class="sd">        might make sense if you still want to create an instance and</span>
<span class="sd">        attach the URI to it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># we allow other apps to injercept the import</span>
        <span class="c1"># whatever they return will be used instead of</span>
        <span class="c1"># creating a new object</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">nuri</span> <span class="o">=</span> <span class="n">get_autocomplete_data_and_normalized_uri</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">receiver</span><span class="p">,</span> <span class="n">response</span> <span class="ow">in</span> <span class="n">pre_import_from</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="bp">cls</span><span class="p">,</span> <span class="n">uri</span><span class="o">=</span><span class="n">nuri</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">response</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">response</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">allow_empty</span> <span class="ow">or</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
            <span class="n">instance</span><span class="o">.</span><span class="n">_uris</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uri&quot;</span><span class="p">,</span> <span class="n">nuri</span><span class="p">)]</span>
            <span class="n">instance</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">instance</span><span class="o">.</span><span class="n">import_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">instance</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not fetch data to import from </span><span class="si">{</span><span class="n">uri</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">import_from_dict_subset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Import attributes of this instance from data in a dict.</span>
<span class="sd">        We iterate through the individual values of the dict and</span>
<span class="sd">        a) only set them if the instance has an attribute matching</span>
<span class="sd">        the key and b) use the fields `clean` method to check if</span>
<span class="sd">        the value validates. If it does not validate, we return</span>
<span class="sd">        the validation error in the errors dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_import_errors</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">field</span><span class="o">.</span><span class="n">clean</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                            <span class="s2">&quot;Could not set </span><span class="si">%s</span><span class="s2"> on </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_import_errors</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">import_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">import_from_dict_subset</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_merge_charfield_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">CharField</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="n">CharField</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">field</span><span class="o">.</span><span class="n">choices</span><span class="p">:</span>
            <span class="n">otherres</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="n">res</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">otherres</span> <span class="ow">and</span> <span class="n">otherres</span> <span class="o">!=</span> <span class="n">res</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">otherres</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_merge_textfield_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">TextField</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="n">TextField</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">)):</span>
            <span class="c1"># if own value is None, fallback to empty string</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">res</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
            <span class="n">res</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;Merged from </span><span class="si">{</span><span class="n">other</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_merge_booleanfield</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">BooleanField</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="n">BooleanField</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_field_value_after_merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method finds the value of a field after merging `other` into `self`.</span>
<span class="sd">        It first tries to find a merge method that is specific to that field</span>
<span class="sd">        (merge_{fieldname}) and then tries to find a method that is specific to</span>
<span class="sd">        the type of the field (merge_{fieldtype})</span>
<span class="sd">        If neither of those exist, it uses the others field value if the field</span>
<span class="sd">        in self is not set, otherwise it keeps the value in self.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fieldtype</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">get_internal_type</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="c1"># if there is a `get_merge_{fieldname}` method in this model, use that one</span>
        <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;get_merge_</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_value&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)):</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;get_merge_</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_value&quot;</span><span class="p">)(</span><span class="n">other</span><span class="p">)</span>
        <span class="c1"># otherwise we check if there is a method for the field type and use that one</span>
        <span class="k">elif</span> <span class="nb">callable</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;get_merge_</span><span class="si">{</span><span class="n">fieldtype</span><span class="si">}</span><span class="s2">_value&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)):</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;get_merge_</span><span class="si">{</span><span class="n">fieldtype</span><span class="si">}</span><span class="s2">_value&quot;</span><span class="p">)(</span><span class="n">other</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">)):</span>
                <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">merge_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method iterates through the model fields and uses the</span>
<span class="sd">        `get_field_value_after_merge` method to copy values from `other` to `self`.</span>
<span class="sd">        It is called by the `merge_with` method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
            <span class="n">newval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_field_value_after_merge</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">newval</span> <span class="o">!=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">)):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="n">newval</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">merge_with</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entities</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">:</span>
            <span class="n">entities</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">origin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="n">pre_merge_with</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">entities</span><span class="o">=</span><span class="n">entities</span><span class="p">)</span>

        <span class="n">e_a</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">self_model_class</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">model__iexact</span><span class="o">=</span><span class="n">e_a</span><span class="p">)</span><span class="o">.</span><span class="n">model_class</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entities</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">entities</span> <span class="o">=</span> <span class="n">self_model_class</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">entities</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entities</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entities</span><span class="p">,</span> <span class="n">QuerySet</span><span class="p">):</span>
            <span class="n">entities</span> <span class="o">=</span> <span class="p">[</span><span class="n">entities</span><span class="p">]</span>
            <span class="n">entities</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">self_model_class</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">ent</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="n">ent</span>
                <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="n">entities</span>
            <span class="p">]</span>
        <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">:</span>
            <span class="n">e_b</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">ent</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="k">if</span> <span class="n">e_a</span> <span class="o">!=</span> <span class="n">e_b</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">ent</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">local_many_to_many</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_set&quot;</span><span class="p">):</span>
                    <span class="n">sl</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
                    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sl</span><span class="p">:</span>
                            <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">merge_fields</span><span class="p">(</span><span class="n">ent</span><span class="p">)</span>

        <span class="n">post_merge_with</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">entities</span><span class="o">=</span><span class="n">entities</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">:</span>
            <span class="n">ent</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">duplicate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">origin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="n">pre_duplicate</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1"># usually, copying instances would work like</span>
        <span class="c1"># https://docs.djangoproject.com/en/4.2/topics/db/queries/#copying-model-instances</span>
        <span class="c1"># but we are working with abstract classes,</span>
        <span class="c1"># so we have to do it by hand  using model_to_dict:(</span>
        <span class="n">objdict</span> <span class="o">=</span> <span class="n">model_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># remove unique fields from dict representation</span>
        <span class="n">unique_fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">field</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">fields</span> <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">unique</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">unique_fields</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Duplicating </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">: ignoring unique field </span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">objdict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># remove related fields from dict representation</span>
        <span class="n">related_fields</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">field</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_fields</span><span class="p">()</span> <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">is_relation</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">related_fields</span><span class="p">:</span>
            <span class="n">objdict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">newobj</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">objdict</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">related_fields</span><span class="p">:</span>
            <span class="c1"># we are not using `isinstance` because we want to</span>
            <span class="c1"># differentiate between different levels of inheritance</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="ow">is</span> <span class="n">ForeignKey</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">newobj</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="ow">is</span> <span class="n">ManyToManyField</span><span class="p">:</span>
                <span class="n">objfield</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">newobj</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">values</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
                <span class="n">objfield</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

        <span class="n">newobj</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">post_duplicate</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">duplicate</span><span class="o">=</span><span class="n">newobj</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">newobj</span>

    <span class="n">duplicate</span><span class="o">.</span><span class="n">alters_data</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">uri_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ct</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">app_label</span><span class="o">=</span><span class="s2">&quot;uris&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;uri&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">model_class</span><span class="p">()</span>
            <span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="n">ct</span><span class="p">,</span> <span class="n">object_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">uri_set_with_importer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">uri</span> <span class="k">for</span> <span class="n">uri</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">uri_set</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_import_url</span><span class="p">(</span><span class="n">uri</span><span class="o">.</span><span class="n">uri</span><span class="p">)]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="apis_core.generic.abc.GenericModel.fetch_from" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fetch_from</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Normalize the URI and extract the autocomplete data.
Then try to fetch data from an URI:
Check if there is import logic configured for this URI and if
so, use that import logic to fetch the data.
Finally, combine the fetched data and the autocomplete data.</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/generic/abc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">fetch_from</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normalize the URI and extract the autocomplete data.</span>
<span class="sd">    Then try to fetch data from an URI:</span>
<span class="sd">    Check if there is import logic configured for this URI and if</span>
<span class="sd">    so, use that import logic to fetch the data.</span>
<span class="sd">    Finally, combine the fetched data and the autocomplete data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Fetch from </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">uri</span><span class="p">)</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">nuri</span> <span class="o">=</span> <span class="n">get_autocomplete_data_and_normalized_uri</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fn</span> <span class="o">:=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">valid_import_url</span><span class="p">(</span><span class="n">nuri</span><span class="p">):</span>
        <span class="n">fetcheddata</span> <span class="o">=</span> <span class="n">fn</span><span class="p">(</span><span class="n">nuri</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="c1"># merge the two dicts</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">fetcheddata</span> <span class="o">|</span> <span class="n">data</span>
        <span class="c1"># combine values that exist in both dicts</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">fetcheddata</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="n">ret</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">fetcheddata</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">ret</span>
    <span class="k">raise</span> <span class="n">ImproperlyConfigured</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Import not configured for URI </span><span class="si">{</span><span class="n">uri</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="apis_core.generic.abc.GenericModel.get_field_value_after_merge" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_field_value_after_merge</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>This method finds the value of a field after merging <code>other</code> into <code>self</code>.
It first tries to find a merge method that is specific to that field
(merge_{fieldname}) and then tries to find a method that is specific to
the type of the field (merge_{fieldtype})
If neither of those exist, it uses the others field value if the field
in self is not set, otherwise it keeps the value in self.</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/generic/abc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_field_value_after_merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method finds the value of a field after merging `other` into `self`.</span>
<span class="sd">    It first tries to find a merge method that is specific to that field</span>
<span class="sd">    (merge_{fieldname}) and then tries to find a method that is specific to</span>
<span class="sd">    the type of the field (merge_{fieldtype})</span>
<span class="sd">    If neither of those exist, it uses the others field value if the field</span>
<span class="sd">    in self is not set, otherwise it keeps the value in self.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fieldtype</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">get_internal_type</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="c1"># if there is a `get_merge_{fieldname}` method in this model, use that one</span>
    <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;get_merge_</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_value&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;get_merge_</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_value&quot;</span><span class="p">)(</span><span class="n">other</span><span class="p">)</span>
    <span class="c1"># otherwise we check if there is a method for the field type and use that one</span>
    <span class="k">elif</span> <span class="nb">callable</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;get_merge_</span><span class="si">{</span><span class="n">fieldtype</span><span class="si">}</span><span class="s2">_value&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;get_merge_</span><span class="si">{</span><span class="n">fieldtype</span><span class="si">}</span><span class="s2">_value&quot;</span><span class="p">)(</span><span class="n">other</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">)):</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="apis_core.generic.abc.GenericModel.import_from" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">import_from</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="n">allow_empty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Fetch data from an URI and create a model instance using
that data. If the <code>allow_empty</code> argument is set, this also
creates a model instance if the data fetched was empty. This
might make sense if you still want to create an instance and
attach the URI to it.</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/generic/abc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">import_from</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">allow_empty</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fetch data from an URI and create a model instance using</span>
<span class="sd">    that data. If the `allow_empty` argument is set, this also</span>
<span class="sd">    creates a model instance if the data fetched was empty. This</span>
<span class="sd">    might make sense if you still want to create an instance and</span>
<span class="sd">    attach the URI to it.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># we allow other apps to injercept the import</span>
    <span class="c1"># whatever they return will be used instead of</span>
    <span class="c1"># creating a new object</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">nuri</span> <span class="o">=</span> <span class="n">get_autocomplete_data_and_normalized_uri</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">receiver</span><span class="p">,</span> <span class="n">response</span> <span class="ow">in</span> <span class="n">pre_import_from</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="bp">cls</span><span class="p">,</span> <span class="n">uri</span><span class="o">=</span><span class="n">nuri</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">response</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">response</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">allow_empty</span> <span class="ow">or</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">_uris</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uri&quot;</span><span class="p">,</span> <span class="n">nuri</span><span class="p">)]</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">import_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">instance</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not fetch data to import from </span><span class="si">{</span><span class="n">uri</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="apis_core.generic.abc.GenericModel.import_from_dict_subset" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">import_from_dict_subset</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Import attributes of this instance from data in a dict.
We iterate through the individual values of the dict and
a) only set them if the instance has an attribute matching
the key and b) use the fields <code>clean</code> method to check if
the value validates. If it does not validate, we return
the validation error in the errors dict.</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/generic/abc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">import_from_dict_subset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Import attributes of this instance from data in a dict.</span>
<span class="sd">    We iterate through the individual values of the dict and</span>
<span class="sd">    a) only set them if the instance has an attribute matching</span>
<span class="sd">    the key and b) use the fields `clean` method to check if</span>
<span class="sd">    the value validates. If it does not validate, we return</span>
<span class="sd">    the validation error in the errors dict.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_import_errors</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">field</span><span class="o">.</span><span class="n">clean</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="s2">&quot;Could not set </span><span class="si">%s</span><span class="s2"> on </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_import_errors</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="apis_core.generic.abc.GenericModel.merge_fields" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">merge_fields</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>This method iterates through the model fields and uses the
<code>get_field_value_after_merge</code> method to copy values from <code>other</code> to <code>self</code>.
It is called by the <code>merge_with</code> method.</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/generic/abc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">merge_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method iterates through the model fields and uses the</span>
<span class="sd">    `get_field_value_after_merge` method to copy values from `other` to `self`.</span>
<span class="sd">    It is called by the `merge_with` method.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
        <span class="n">newval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_field_value_after_merge</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">newval</span> <span class="o">!=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">)):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="n">newval</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="apis_core.generic.abc.GenericModel.valid_import_url" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">valid_import_url</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Check if an URI is a can be imported.
The exact fetching logic for an URI is defined in the
<code>import_definitions</code> attribute of the class.
<code>import_definitions</code> has to be a dict, mapping a regex
matching the URI to a callable taking the URI as an argument.
This method check if there is a callable defined for this URI.</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/generic/abc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">valid_import_url</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if an URI is a can be imported.</span>
<span class="sd">    The exact fetching logic for an URI is defined in the</span>
<span class="sd">    `import_definitions` attribute of the class.</span>
<span class="sd">    `import_definitions` has to be a dict, mapping a regex</span>
<span class="sd">    matching the URI to a callable taking the URI as an argument.</span>
<span class="sd">    This method check if there is a callable defined for this URI.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">uri</span> <span class="o">=</span> <span class="n">get_autocomplete_data_and_normalized_uri</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">regex</span><span class="p">,</span> <span class="n">fn</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;import_definitions&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">uri</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">fn</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="apis_core.generic.api_views" class="doc doc-heading">
            <code>api_views</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="apis_core.generic.api_views.InjectFacetsLimitOffsetPagination" class="doc doc-heading">
            <code>InjectFacetsLimitOffsetPagination</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="rest_framework.pagination.LimitOffsetPagination">LimitOffsetPagination</span></code></p>


        <p>This pagination class injects a <code>facets</code> dict into the API response object.
It looks for a <code>get_facets</code> method in the models class and if this
method exists it uses its return value as the value of the <code>facets</code> key in
the API response.
To make the API response always paginated, we have to set the <code>default_limit</code>
attribute to something other than None.</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/generic/api_views.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">InjectFacetsLimitOffsetPagination</span><span class="p">(</span><span class="n">pagination</span><span class="o">.</span><span class="n">LimitOffsetPagination</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This pagination class injects a `facets` dict into the API response object.</span>
<span class="sd">    It looks for a `get_facets` method in the models class and if this</span>
<span class="sd">    method exists it uses its return value as the value of the `facets` key in</span>
<span class="sd">    the API response.</span>
<span class="sd">    To make the API response always paginated, we have to set the `default_limit`</span>
<span class="sd">    attribute to something other than None.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">default_limit</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">facets</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">paginate_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queryset</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">view</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">queryset</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;get_facets&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facets</span> <span class="o">=</span> <span class="n">queryset</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_facets</span><span class="p">(</span><span class="n">queryset</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">paginate_queryset</span><span class="p">(</span><span class="n">queryset</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">view</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_paginated_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_paginated_response</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">facets</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;facets&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">facets</span><span class="p">})</span>
            <span class="n">response</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
        <span class="k">return</span> <span class="n">response</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="apis_core.generic.api_views.ModelViewSet" class="doc doc-heading">
            <code>ModelViewSet</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="rest_framework.viewsets.ModelViewSet">ModelViewSet</span></code></p>


        <p>API ViewSet for a generic model.
The queryset is overridden by the first match from
the <code>first_member_match</code> helper.
The serializer class is overridden by the first match from
the <code>first_member_match</code> helper.</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/generic/api_views.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ModelViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API ViewSet for a generic model.</span>
<span class="sd">    The queryset is overridden by the first match from</span>
<span class="sd">    the `first_member_match` helper.</span>
<span class="sd">    The serializer class is overridden by the first match from</span>
<span class="sd">    the `first_member_match` helper.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">filter_backends</span> <span class="o">=</span> <span class="p">[</span><span class="n">GenericFilterBackend</span><span class="p">]</span>
    <span class="n">schema</span> <span class="o">=</span> <span class="n">GenericAutoSchema</span><span class="p">()</span>
    <span class="n">pagination_class</span> <span class="o">=</span> <span class="n">InjectFacetsLimitOffsetPagination</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;contenttype&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">model_class</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">queryset_methods</span> <span class="o">=</span> <span class="n">module_paths</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;querysets&quot;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;ViewSetQueryset&quot;</span>
        <span class="p">)</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">first_member_match</span><span class="p">(</span><span class="n">queryset_methods</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">queryset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_serializer_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">renderer</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;request&quot;</span><span class="p">,</span> <span class="p">{}),</span> <span class="s2">&quot;accepted_renderer&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">serializer_class_modules</span> <span class="o">=</span> <span class="n">module_paths</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;serializers&quot;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;Serializer&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">renderer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="n">makeclassprefix</span><span class="p">(</span><span class="n">renderer</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
            <span class="n">serializer_class_modules</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">module_paths</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;serializers&quot;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">Serializer&quot;</span>
                <span class="p">)</span>
                <span class="o">+</span> <span class="n">serializer_class_modules</span>
            <span class="p">)</span>

        <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">first_member_match</span><span class="p">(</span>
            <span class="n">serializer_class_modules</span><span class="p">,</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="n">renderer</span><span class="p">,</span> <span class="s2">&quot;serializer&quot;</span><span class="p">,</span> <span class="n">GenericHyperlinkedModelSerializer</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">serializer_factory</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">serializer</span><span class="o">=</span><span class="n">serializer_class</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">action</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="apis_core.generic.filtersets" class="doc doc-heading">
            <code>filtersets</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="apis_core.generic.filtersets.GenericFilterSet" class="doc doc-heading">
            <code>GenericFilterSet</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="django_filters.filterset.FilterSet">FilterSet</span></code></p>


        <p>Our GenericFilterSet sets the default <code>form</code> to be our
GenericFilterSetForm, which is set up to ignore the <code>columns</code> field
of the form.</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/generic/filtersets.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">GenericFilterSet</span><span class="p">(</span><span class="n">FilterSet</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Our GenericFilterSet sets the default `form` to be our</span>
<span class="sd">    GenericFilterSetForm, which is set up to ignore the `columns` field</span>
<span class="sd">    of the form.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">GenericFilterSetForm</span>
        <span class="c1"># we set the UnknownFieldBehavior to WARN, so the form does not</span>
        <span class="c1"># break if there are JSONFields</span>
        <span class="n">unknown_field_behavior</span> <span class="o">=</span> <span class="n">django_filters</span><span class="o">.</span><span class="n">UnknownFieldBehavior</span><span class="o">.</span><span class="n">WARN</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">model</span>
        <span class="c1"># remove all the filters that are based on auto_created model fields</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_fields</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="s2">&quot;auto_created&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">skoscollection</span> <span class="o">=</span> <span class="n">apps</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="s2">&quot;collections.SkosCollection&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">skoscollection</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="s2">&quot;collections&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CollectionsIncludeExcludeFilter</span><span class="p">(</span>
                    <span class="n">queryset</span><span class="o">=</span><span class="n">skoscollection</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="ne">LookupError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Not adding collections filter to form: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="apis_core.generic.forms" class="doc doc-heading">
            <code>forms</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="apis_core.generic.forms.GenericFilterSetForm" class="doc doc-heading">
            <code>GenericFilterSetForm</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="django.forms.Form">Form</span></code></p>


        <p>FilterSet form for generic models
Adds a submit button using the django crispy form helper</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/generic/forms/__init__.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">GenericFilterSetForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    FilterSet form for generic models</span>
<span class="sd">    Adds a submit button using the django crispy form helper</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">columns_exclude</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">helper</span> <span class="o">=</span> <span class="n">FormHelper</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">form_method</span> <span class="o">=</span> <span class="s2">&quot;GET&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">form_tag</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="apis_core.generic.forms.GenericModelForm" class="doc doc-heading">
            <code>GenericModelForm</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="django.forms.ModelForm">ModelForm</span></code></p>


        <p>Model form for generic models
Adds a submit button using the django crispy form helper
and sets the ModelChoiceFields and ModelMultipleChoiceFields
to use autocomplete replacement fields</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/generic/forms/__init__.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">GenericModelForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model form for generic models</span>
<span class="sd">    Adds a submit button using the django crispy form helper</span>
<span class="sd">    and sets the ModelChoiceFields and ModelMultipleChoiceFields</span>
<span class="sd">    to use autocomplete replacement fields</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="s2">&quot;__all__&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">skoscollection</span> <span class="o">=</span> <span class="n">apps</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="s2">&quot;collections.SkosCollection&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;collections&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ModelMultipleChoiceField</span><span class="p">(</span>
                <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">queryset</span><span class="o">=</span><span class="n">skoscollection</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
                <span class="n">label</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Collections&quot;</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">instance</span> <span class="o">:=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;instance&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;collections&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">initial</span> <span class="o">=</span> <span class="n">skoscollection</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">by_instance</span><span class="p">(</span>
                    <span class="n">instance</span>
                <span class="p">)</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s2">&quot;pk&quot;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">LookupError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Not adding collections to form: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">helper</span> <span class="o">=</span> <span class="n">FormHelper</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="n">Submit</span><span class="p">(</span><span class="s2">&quot;submit&quot;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Submit&quot;</span><span class="p">)))</span>

        <span class="c1"># override the fields pointing to other models,</span>
        <span class="c1"># to make them use the autocomplete widgets</span>
        <span class="n">override_fieldtypes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;ModelMultipleChoiceField&quot;</span><span class="p">:</span> <span class="n">ApisModelSelect2Multiple</span><span class="p">,</span>
            <span class="s2">&quot;ModelChoiceField&quot;</span><span class="p">:</span> <span class="n">ApisModelSelect2</span><span class="p">,</span>
            <span class="s2">&quot;ModelImportChoiceField&quot;</span><span class="p">:</span> <span class="n">ApisModelSelect2</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
            <span class="n">clsname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="n">field</span><span class="p">]</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="k">if</span> <span class="n">clsname</span> <span class="ow">in</span> <span class="n">override_fieldtypes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">ct</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="n">field</span><span class="p">]</span><span class="o">.</span><span class="n">_queryset</span><span class="o">.</span><span class="n">model</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">ct</span><span class="o">.</span><span class="n">model_class</span><span class="p">(),</span> <span class="n">GenericModel</span><span class="p">):</span>
                    <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;apis_core:generic:autocomplete&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">ct</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="n">field</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">override_fieldtypes</span><span class="p">[</span><span class="n">clsname</span><span class="p">](</span>
                        <span class="n">url</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;data-html&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="n">field</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">choices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="n">field</span><span class="p">]</span><span class="o">.</span><span class="n">choices</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cleaned_data</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">cleaned_data</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Please fill out some of the form fields&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">cleaned_data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">skoscollection</span> <span class="o">=</span> <span class="n">apps</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="s2">&quot;collections.SkosCollection&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;collections&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">:</span>
                <span class="n">collections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleaned_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;collections&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="n">skoscollection</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">pk__in</span><span class="o">=</span><span class="n">collections</span><span class="p">):</span>
                    <span class="n">collection</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="n">skoscollection</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk__in</span><span class="o">=</span><span class="n">collections</span><span class="p">):</span>
                    <span class="n">collection</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">LookupError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Not creating collections from form: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">instance</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>



<div class="doc doc-object doc-module">



<h4 id="apis_core.generic.forms.fields" class="doc doc-heading">
            <code>fields</code>


</h4>

    <div class="doc doc-contents ">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h5 id="apis_core.generic.forms.fields.RowColumnMultiValueField" class="doc doc-heading">
            <code>RowColumnMultiValueField</code>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="django.forms.MultiValueField">MultiValueField</span></code></p>


        <p>This is a custom MultiValueField that simply shows multiple form
fields in a row. The form fields are passed to the constructor and
the corresponding RowColumnMultiWidget simply iterates through all
the fields and shows them in rows.
Additionaly it is possible to pass a list of <code>labels</code> that are then
also passed on to the widget, which uses those to add a separate
label to the individual widgets.</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/generic/forms/fields.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RowColumnMultiValueField</span><span class="p">(</span><span class="n">MultiValueField</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a custom MultiValueField that simply shows multiple form</span>
<span class="sd">    fields in a row. The form fields are passed to the constructor and</span>
<span class="sd">    the corresponding RowColumnMultiWidget simply iterates through all</span>
<span class="sd">    the fields and shows them in rows.</span>
<span class="sd">    Additionaly it is possible to pass a list of `labels` that are then</span>
<span class="sd">    also passed on to the widget, which uses those to add a separate</span>
<span class="sd">    label to the individual widgets.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;widget&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">RowColumnMultiWidget</span><span class="p">(</span>
            <span class="n">widgets</span><span class="o">=</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">widget</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">],</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span>
        <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_list</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">data_list</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="apis_core.generic.forms.fields.RowColumnMultiWidget" class="doc doc-heading">
            <code>RowColumnMultiWidget</code>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="django.forms.MultiWidget">MultiWidget</span></code></p>


        <p>A custom MultiWidget that is meant to be used with the
RowColumnMultiValueField. The widget takes a list of widgets
as a parameter and displays those widgets in columns in one row.
The <code>labels</code> parameter is used to add a separate label to the
individual widgets.</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/generic/forms/fields.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RowColumnMultiWidget</span><span class="p">(</span><span class="n">MultiWidget</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A custom MultiWidget that is meant to be used with the</span>
<span class="sd">    RowColumnMultiValueField. The widget takes a list of widgets</span>
<span class="sd">    as a parameter and displays those widgets in columns in one row.</span>
<span class="sd">    The `labels` parameter is used to add a separate label to the</span>
<span class="sd">    individual widgets.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">template_name</span> <span class="o">=</span> <span class="s2">&quot;widgets/row_column_multiwidget.html&quot;</span>
    <span class="n">use_fieldset</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widgets</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[],</span> <span class="n">attrs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">widgets</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">widget</span> <span class="ow">in</span> <span class="n">ctx</span><span class="p">[</span><span class="s2">&quot;widget&quot;</span><span class="p">][</span><span class="s2">&quot;subwidgets&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span>
                <span class="n">widget</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ctx</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">decompress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">return</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="apis_core.generic.generators" class="doc doc-heading">
            <code>generators</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="apis_core.generic.generators.CustomEndpointEnumerator" class="doc doc-heading">
            <code>CustomEndpointEnumerator</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="drf_spectacular.generators.EndpointEnumerator">EndpointEnumerator</span></code></p>








              <details class="quote">
                <summary>Source code in <code>apis_core/generic/generators.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CustomEndpointEnumerator</span><span class="p">(</span><span class="n">EndpointEnumerator</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_content_type_endpoint</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">content_type</span><span class="p">:</span> <span class="n">ContentType</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;list&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a endpoint tuple, usable by the SchemaGenerator of DRF spectacular&quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;apis_core:generic:genericmodelapi-list&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">content_type</span><span class="p">])</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="n">resolve</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">cls</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;detail&quot;</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{id}</span><span class="s2">/&quot;</span>
        <span class="n">regex</span> <span class="o">=</span> <span class="n">path</span>
        <span class="c1"># for now we only do &quot;GET&quot;</span>
        <span class="n">httpmethod</span> <span class="o">=</span> <span class="s2">&quot;GET&quot;</span>
        <span class="c1"># we have to add a attribute, so that the</span>
        <span class="c1"># `initkwargs` argument to the `as_view`</span>
        <span class="c1"># method can contain a `model` argument</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">callback</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">as_view</span><span class="p">({</span><span class="s2">&quot;get&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">},</span> <span class="n">model</span><span class="o">=</span><span class="n">content_type</span><span class="o">.</span><span class="n">model_class</span><span class="p">())</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">regex</span><span class="p">,</span> <span class="n">httpmethod</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_api_endpoints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patterns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call the EndpointEnumerator&#39;s `get_api_endpoints` method to get all</span>
<span class="sd">        the automatically found endpoints, remove the ones that we want to override</span>
<span class="sd">        and the add our custom endpoints to this list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">api_endpoints</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_api_endpoints</span><span class="p">(</span><span class="n">patterns</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span>
        <span class="n">api_endpoints</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">endpoint</span>
            <span class="k">for</span> <span class="n">endpoint</span> <span class="ow">in</span> <span class="n">api_endpoints</span>
            <span class="k">if</span> <span class="s2">&quot;/api/</span><span class="si">{contenttype}</span><span class="s2">/&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">endpoint</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">content_type</span> <span class="ow">in</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">content_type</span><span class="o">.</span><span class="n">model_class</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span>
                <span class="n">content_type</span><span class="o">.</span><span class="n">model_class</span><span class="p">(),</span> <span class="n">GenericModel</span>
            <span class="p">):</span>
                <span class="n">api_endpoints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_generate_content_type_endpoint</span><span class="p">(</span><span class="n">content_type</span><span class="p">))</span>
                <span class="n">api_endpoints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_generate_content_type_endpoint</span><span class="p">(</span><span class="n">content_type</span><span class="p">,</span> <span class="s2">&quot;detail&quot;</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">api_endpoints</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="apis_core.generic.generators.CustomEndpointEnumerator.get_api_endpoints" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_api_endpoints</span><span class="p">(</span><span class="n">patterns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Call the EndpointEnumerator's <code>get_api_endpoints</code> method to get all
the automatically found endpoints, remove the ones that we want to override
and the add our custom endpoints to this list.</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/generic/generators.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_api_endpoints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patterns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Call the EndpointEnumerator&#39;s `get_api_endpoints` method to get all</span>
<span class="sd">    the automatically found endpoints, remove the ones that we want to override</span>
<span class="sd">    and the add our custom endpoints to this list.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">api_endpoints</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_api_endpoints</span><span class="p">(</span><span class="n">patterns</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span>
    <span class="n">api_endpoints</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">endpoint</span>
        <span class="k">for</span> <span class="n">endpoint</span> <span class="ow">in</span> <span class="n">api_endpoints</span>
        <span class="k">if</span> <span class="s2">&quot;/api/</span><span class="si">{contenttype}</span><span class="s2">/&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">endpoint</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">content_type</span> <span class="ow">in</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">content_type</span><span class="o">.</span><span class="n">model_class</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span>
            <span class="n">content_type</span><span class="o">.</span><span class="n">model_class</span><span class="p">(),</span> <span class="n">GenericModel</span>
        <span class="p">):</span>
            <span class="n">api_endpoints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_generate_content_type_endpoint</span><span class="p">(</span><span class="n">content_type</span><span class="p">))</span>
            <span class="n">api_endpoints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_generate_content_type_endpoint</span><span class="p">(</span><span class="n">content_type</span><span class="p">,</span> <span class="s2">&quot;detail&quot;</span><span class="p">)</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">api_endpoints</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="apis_core.generic.helpers" class="doc doc-heading">
            <code>helpers</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="apis_core.generic.helpers.default_search_fields" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">default_search_fields</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">field_names</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Retrieve the default model fields to use for a search operation
By default those are all the CharFields and TextFields of a model.
It is also possible to define those fields on the model using the
<code>_default_search_fields</code> attribute.
The method also takes a <code>field_names</code> argument to override the list
of fields.</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/generic/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">default_search_fields</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">field_names</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve the default model fields to use for a search operation</span>
<span class="sd">    By default those are all the CharFields and TextFields of a model.</span>
<span class="sd">    It is also possible to define those fields on the model using the</span>
<span class="sd">    `_default_search_fields` attribute.</span>
<span class="sd">    The method also takes a `field_names` argument to override the list</span>
<span class="sd">    of fields.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">default_types</span> <span class="o">=</span> <span class="p">(</span><span class="n">CharField</span><span class="p">,</span> <span class="n">TextField</span><span class="p">)</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">field</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_fields</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">default_types</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="c1"># check if the model has a `_default_search_fields`</span>
    <span class="c1"># list and use that as searchfields</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;_default_search_fields&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">_default_search_fields</span>
        <span class="p">]</span>
    <span class="c1"># if `fields_to_search` is a list, use that</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field_names</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">field_names</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">fields</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="apis_core.generic.helpers.generate_search_filter" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_search_filter</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">fields_to_search</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Generate a default search filter that searches for the <code>query</code>
This helper can be used by autocomplete querysets if nothing
fancier is needed.
If the <code>prefix</code> is set, the field names will be prefixed with that string -
this can be useful if you want to use the <code>generate_search_filter</code> in a
<code>Q</code> combined query while searching over multiple models.</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/generic/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_search_filter</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">fields_to_search</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a default search filter that searches for the `query`</span>
<span class="sd">    This helper can be used by autocomplete querysets if nothing</span>
<span class="sd">    fancier is needed.</span>
<span class="sd">    If the `prefix` is set, the field names will be prefixed with that string -</span>
<span class="sd">    this can be useful if you want to use the `generate_search_filter` in a</span>
<span class="sd">    `Q` combined query while searching over multiple models.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

    <span class="n">_fields_to_search</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">default_search_fields</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">fields_to_search</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="n">q</span> <span class="o">=</span> <span class="n">Q</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">query</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">&amp;=</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">acc</span><span class="p">,</span> <span class="n">field_name</span><span class="p">:</span> <span class="n">acc</span>
            <span class="o">|</span> <span class="n">Q</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}{</span><span class="n">field_name</span><span class="si">}</span><span class="s2">__icontains&quot;</span><span class="p">:</span> <span class="n">token</span><span class="p">}),</span>
            <span class="n">_fields_to_search</span><span class="p">,</span>
            <span class="n">Q</span><span class="p">(),</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">q</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="apis_core.generic.helpers.mro_paths" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mro_paths</span><span class="p">(</span><span class="n">model</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-cached"><code>cached</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Create a list of MRO classes for a Django model</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/generic/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span>
<span class="k">def</span><span class="w"> </span><span class="nf">mro_paths</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a list of MRO classes for a Django model</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Model</span><span class="o">.</span><span class="n">mro</span><span class="p">(),</span> <span class="n">model</span><span class="o">.</span><span class="n">mro</span><span class="p">()):</span>
            <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">([</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__module__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]))</span>
            <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__module__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]))</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">paths</span><span class="p">))]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="apis_core.generic.helpers.split_and_strip_parameter" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">split_and_strip_parameter</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Clean a URI param list type
This method iterates through a list of strings. It looks if
the items contain a comma separated list of items and then splits
those and also runs strip on all those items.
So out of ["foo.bar", "bar.faz, faz.foo"] it
creates a list ["foo.bar", "bar.faz", "faz.foo"]</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/generic/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">split_and_strip_parameter</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Clean a URI param list type</span>
<span class="sd">    This method iterates through a list of strings. It looks if</span>
<span class="sd">    the items contain a comma separated list of items and then splits</span>
<span class="sd">    those and also runs strip on all those items.</span>
<span class="sd">    So out of [&quot;foo.bar&quot;, &quot;bar.faz, faz.foo&quot;] it</span>
<span class="sd">    creates a list [&quot;foo.bar&quot;, &quot;bar.faz&quot;, &quot;faz.foo&quot;]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">newlist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="n">subparams</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">strip</span><span class="p">,</span> <span class="n">param</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">))</span>
        <span class="n">newlist</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">subparams</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">newlist</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="apis_core.generic.helpers.string_to_bool" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">string_to_bool</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s1">&#39;false&#39;</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Convert a string to a boolean representing its semantic value</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/generic/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">string_to_bool</span><span class="p">(</span><span class="n">string</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a string to a boolean representing its semantic value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">string</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="apis_core.generic.helpers.template_names_via_mro" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">template_names_via_mro</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Use the MRO to generate a list of template names for a model</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/generic/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">template_names_via_mro</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use the MRO to generate a list of template names for a model</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">mro_paths</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># copy, so we don&#39;t modify the original list</span>
        <span class="k">if</span> <span class="n">folder</span><span class="p">:</span>
            <span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">folder</span><span class="p">)</span>
        <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}{</span><span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="apis_core.generic.middleware" class="doc doc-heading">
            <code>middleware</code>


</h3>

    <div class="doc doc-contents ">

        <p>Copyright (c) 2023 Benoit Blanchon
License: MIT</p>
<p>This is copied from https://github.com/bblanchon/django-htmx-messages-framework
Commit a2da4176ac4a53fb0d7f42e8a1de398e4e5f9c1c</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="apis_core.generic.middleware.HtmxMessageMiddleware" class="doc doc-heading">
            <code>HtmxMessageMiddleware</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="django.utils.deprecation.MiddlewareMixin">MiddlewareMixin</span></code></p>


        <p>Middleware that moves messages into the HX-Trigger header when request is made with HTMX</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/generic/middleware.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">HtmxMessageMiddleware</span><span class="p">(</span><span class="n">MiddlewareMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Middleware that moves messages into the HX-Trigger header when request is made with HTMX</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_response</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">HttpRequest</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="n">HttpResponse</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">HttpResponse</span><span class="p">:</span>
        <span class="c1"># The HX-Request header indicates that the request was made with HTMX</span>
        <span class="k">if</span> <span class="s2">&quot;HX-Request&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">response</span>

        <span class="c1"># Ignore redirections because HTMX cannot read the headers</span>
        <span class="k">if</span> <span class="mi">300</span> <span class="o">&lt;=</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&lt;</span> <span class="mi">400</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">response</span>

        <span class="c1"># Extract the messages</span>
        <span class="n">messages</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">message</span><span class="o">.</span><span class="n">message</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="n">message</span><span class="o">.</span><span class="n">tags</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">get_messages</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">messages</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">response</span>

        <span class="c1"># Get the existing HX-Trigger that could have been defined by the view</span>
        <span class="n">hx_trigger</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;HX-Trigger&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">hx_trigger</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># If the HX-Trigger is not set, start with an empty object</span>
            <span class="n">hx_trigger</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">elif</span> <span class="n">hx_trigger</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;{&quot;</span><span class="p">):</span>
            <span class="c1"># If the HX-Trigger uses the object syntax, parse the object</span>
            <span class="n">hx_trigger</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">hx_trigger</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If the HX-Trigger uses the string syntax, convert to the object syntax</span>
            <span class="n">hx_trigger</span> <span class="o">=</span> <span class="p">{</span><span class="n">hx_trigger</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>

        <span class="c1"># Add the messages array in the HX-Trigger object</span>
        <span class="n">hx_trigger</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">messages</span>

        <span class="c1"># Add or update the HX-Trigger</span>
        <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;HX-Trigger&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">hx_trigger</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">response</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="apis_core.generic.renderers" class="doc doc-heading">
            <code>renderers</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="apis_core.generic.renderers.GenericRDFBaseRenderer" class="doc doc-heading">
            <code>GenericRDFBaseRenderer</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="rest_framework.renderers.BaseRenderer">BaseRenderer</span></code></p>


        <p>Base class to render RDF graphs to various formats.
This renderer expects the serialized data to either be a rdflib grap <strong>or</strong>
to contain a list of rdflib graphs. If it works with a list of graphs, those
are combined to one graph.
This graph is then serialized and the result is returned. The serialization
format can be set using the <code>rdflib_format</code> attribute. If this is not set, the
<code>format</code> attribute of the renderer is used as serialization format (this is the
format as it is used by the Django Rest Framework for content negotiation.</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/generic/renderers.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">GenericRDFBaseRenderer</span><span class="p">(</span><span class="n">renderers</span><span class="o">.</span><span class="n">BaseRenderer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class to render RDF graphs to various formats.</span>
<span class="sd">    This renderer expects the serialized data to either be a rdflib grap **or**</span>
<span class="sd">    to contain a list of rdflib graphs. If it works with a list of graphs, those</span>
<span class="sd">    are combined to one graph.</span>
<span class="sd">    This graph is then serialized and the result is returned. The serialization</span>
<span class="sd">    format can be set using the `rdflib_format` attribute. If this is not set, the</span>
<span class="sd">    `format` attribute of the renderer is used as serialization format (this is the</span>
<span class="sd">    format as it is used by the Django Rest Framework for content negotiation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">format</span> <span class="o">=</span> <span class="s2">&quot;ttl&quot;</span>
    <span class="n">rdflib_format</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">accepted_media_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">renderer_context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">()</span>

        <span class="k">match</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">case</span> <span class="p">{</span><span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="n">results</span><span class="p">,</span> <span class="o">**</span><span class="n">rest</span><span class="p">}:</span>  <span class="c1"># noqa: F841</span>
                <span class="c1"># Handle case where data is a dict with multiple graphs</span>
                <span class="k">for</span> <span class="n">graph</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">Graph</span><span class="p">):</span>
                        <span class="c1"># Merge triples</span>
                        <span class="k">for</span> <span class="n">triple</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">:</span>
                            <span class="n">result</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">triple</span><span class="p">)</span>
                        <span class="c1"># Merge namespace bindings</span>
                        <span class="k">for</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">namespace</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">namespaces</span><span class="p">():</span>
                            <span class="n">result</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">case</span> <span class="p">{</span><span class="s2">&quot;detail&quot;</span><span class="p">:</span> <span class="n">detail</span><span class="p">}:</span>
                <span class="k">raise</span> <span class="n">APIException</span><span class="p">(</span><span class="n">detail</span><span class="p">)</span>
            <span class="k">case</span> <span class="n">Graph</span><span class="p">():</span>
                <span class="c1"># Handle case where data is a single graph</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">data</span>
                <span class="c1"># Ensure namespaces are properly bound in the single graph case</span>
                <span class="k">for</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">namespace</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">namespaces</span><span class="p">():</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Invalid data format. Expected rdflib Graph or dict with &#39;results&#39; key containing graphs&quot;</span>
                <span class="p">)</span>
        <span class="n">serialization_format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rdflib_format</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="n">serialization_format</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="apis_core.generic.routers" class="doc doc-heading">
            <code>routers</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="apis_core.generic.routers.CustomAPIRootView" class="doc doc-heading">
            <code>CustomAPIRootView</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="rest_framework.routers.APIRootView">APIRootView</span></code></p>


        <p>The default basic root view for CustomDefaultRouter</p>
<p>This view lists the output of the default APIRootView of the Django Rest Framework.
In addition, it injects the routes of the genericmodelapi (those are not hardcoded
registered but autogenerated based on the models that inherit from GenericModel).</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/generic/routers.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CustomAPIRootView</span><span class="p">(</span><span class="n">APIRootView</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The default basic root view for CustomDefaultRouter</span>

<span class="sd">    This view lists the output of the default APIRootView of the Django Rest Framework.</span>
<span class="sd">    In addition, it injects the routes of the genericmodelapi (those are not hardcoded</span>
<span class="sd">    registered but autogenerated based on the models that inherit from GenericModel).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">content_type</span> <span class="ow">in</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">content_type</span><span class="o">.</span><span class="n">model_class</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span>
                <span class="n">content_type</span><span class="o">.</span><span class="n">model_class</span><span class="p">(),</span> <span class="n">GenericModel</span>
            <span class="p">):</span>
                <span class="n">route</span> <span class="o">=</span> <span class="s2">&quot;apis_core:generic:genericmodelapi-list&quot;</span>
                <span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">reverse</span><span class="p">(</span><span class="n">route</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">content_type</span><span class="p">])</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span>
                    <span class="n">route</span><span class="p">,</span>
                    <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">content_type</span><span class="p">],</span>
                    <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span>
                    <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span>
                    <span class="nb">format</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;format&quot;</span><span class="p">),</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="apis_core.generic.routers.CustomDefaultRouter" class="doc doc-heading">
            <code>CustomDefaultRouter</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="rest_framework.routers.DefaultRouter">DefaultRouter</span></code></p>


        <p>The CustomDefaultRouter only diverts from the Django Rest Framework DefaultRouter
by setting the APIRootView to our CustomAPIRootView.</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/generic/routers.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CustomDefaultRouter</span><span class="p">(</span><span class="n">DefaultRouter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The CustomDefaultRouter only diverts from the Django Rest Framework DefaultRouter</span>
<span class="sd">    by setting the APIRootView to our CustomAPIRootView.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">APIRootView</span> <span class="o">=</span> <span class="n">CustomAPIRootView</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="apis_core.generic.schema" class="doc doc-heading">
            <code>schema</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="apis_core.generic.schema.GenericAutoSchema" class="doc doc-heading">
            <code>GenericAutoSchema</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="drf_spectacular.openapi.AutoSchema">AutoSchema</span></code></p>


        <p>Add an option to the default drf_spectacular schema that
allows to set the tags of a route via the model.</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/generic/schema.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">GenericAutoSchema</span><span class="p">(</span><span class="n">AutoSchema</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add an option to the default drf_spectacular schema that</span>
<span class="sd">    allows to set the tags of a route via the model.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;get_openapi_tags&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">get_openapi_tags</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_tags</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="apis_core.generic.tables" class="doc doc-heading">
            <code>tables</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="apis_core.generic.tables.ActionColumn" class="doc doc-heading">
            <code>ActionColumn</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="CustomTemplateColumn (apis_core.generic.tables.CustomTemplateColumn)" href="#apis_core.generic.tables.CustomTemplateColumn">CustomTemplateColumn</a></code></p>


        <p>A custom template column with some additional attributes
for actions.</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/generic/tables.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ActionColumn</span><span class="p">(</span><span class="n">CustomTemplateColumn</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A custom template column with some additional attributes</span>
<span class="sd">    for actions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">orderable</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">exclude_from_export</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;td&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;style&quot;</span><span class="p">:</span> <span class="s2">&quot;width:1%;&quot;</span><span class="p">},</span> <span class="s2">&quot;th&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;style&quot;</span><span class="p">:</span> <span class="s2">&quot;font-size: 0&quot;</span><span class="p">}}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">permission</span> <span class="o">:=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;permission&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">table</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="n">permission_fullname</span><span class="p">(</span><span class="n">permission</span><span class="p">,</span> <span class="n">record</span><span class="p">)):</span>
                <span class="k">return</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="apis_core.generic.tables.CustomTemplateColumn" class="doc doc-heading">
            <code>CustomTemplateColumn</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="django_tables2.TemplateColumn">TemplateColumn</span></code></p>


        <p>A custom template column - the <code>tables.TemplateColumn</code> class does not allow
to set attributes via class variables. Therefor we use this
CustomTemplateColumn to set some arguments based on class attributes and
override the attributes in child classes.</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/generic/tables.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CustomTemplateColumn</span><span class="p">(</span><span class="n">tables</span><span class="o">.</span><span class="n">TemplateColumn</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A custom template column - the `tables.TemplateColumn` class does not allow</span>
<span class="sd">    to set attributes via class variables. Therefor we use this</span>
<span class="sd">    CustomTemplateColumn to set some arguments based on class attributes and</span>
<span class="sd">    override the attributes in child classes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">template_name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">orderable</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">exclude_from_export</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">verbose_name</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">template_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">template_name</span><span class="p">,</span>
            <span class="n">orderable</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">orderable</span><span class="p">,</span>
            <span class="n">exclude_from_export</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">exclude_from_export</span><span class="p">,</span>
            <span class="n">verbose_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="apis_core.generic.tables.DeleteColumn" class="doc doc-heading">
            <code>DeleteColumn</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ActionColumn (apis_core.generic.tables.ActionColumn)" href="#apis_core.generic.tables.ActionColumn">ActionColumn</a></code></p>


        <p>A column showing a delete button</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/generic/tables.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DeleteColumn</span><span class="p">(</span><span class="n">ActionColumn</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A column showing a delete button</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">template_name</span> <span class="o">=</span> <span class="s2">&quot;columns/delete.html&quot;</span>
    <span class="n">permission</span> <span class="o">=</span> <span class="s2">&quot;delete&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="apis_core.generic.tables.DescriptionColumn" class="doc doc-heading">
            <code>DescriptionColumn</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="CustomTemplateColumn (apis_core.generic.tables.CustomTemplateColumn)" href="#apis_core.generic.tables.CustomTemplateColumn">CustomTemplateColumn</a></code></p>


        <p>A column showing a model description</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/generic/tables.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DescriptionColumn</span><span class="p">(</span><span class="n">CustomTemplateColumn</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A column showing a model description</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">template_name</span> <span class="o">=</span> <span class="s2">&quot;columns/description.html&quot;</span>
    <span class="n">orderable</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="apis_core.generic.tables.DuplicateColumn" class="doc doc-heading">
            <code>DuplicateColumn</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ActionColumn (apis_core.generic.tables.ActionColumn)" href="#apis_core.generic.tables.ActionColumn">ActionColumn</a></code></p>


        <p>A column showing a duplicate button</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/generic/tables.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DuplicateColumn</span><span class="p">(</span><span class="n">ActionColumn</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A column showing a duplicate button</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">template_name</span> <span class="o">=</span> <span class="s2">&quot;columns/duplicate.html&quot;</span>
    <span class="n">permission</span> <span class="o">=</span> <span class="s2">&quot;create&quot;</span>
    <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;duplicate&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="apis_core.generic.tables.EditColumn" class="doc doc-heading">
            <code>EditColumn</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ActionColumn (apis_core.generic.tables.ActionColumn)" href="#apis_core.generic.tables.ActionColumn">ActionColumn</a></code></p>


        <p>A column showing an edit button</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/generic/tables.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">EditColumn</span><span class="p">(</span><span class="n">ActionColumn</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A column showing an edit button</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">template_name</span> <span class="o">=</span> <span class="s2">&quot;columns/edit.html&quot;</span>
    <span class="n">permission</span> <span class="o">=</span> <span class="s2">&quot;change&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="apis_core.generic.tables.GenericTable" class="doc doc-heading">
            <code>GenericTable</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="django_tables2.Table">Table</span></code></p>


        <p>A generic table that contains an edit button column, a delete button column
and a description column</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/generic/tables.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">GenericTable</span><span class="p">(</span><span class="n">tables</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A generic table that contains an edit button column, a delete button column</span>
<span class="sd">    and a description column</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">edit</span> <span class="o">=</span> <span class="n">EditColumn</span><span class="p">()</span>
    <span class="n">desc</span> <span class="o">=</span> <span class="n">DescriptionColumn</span><span class="p">()</span>
    <span class="n">delete</span> <span class="o">=</span> <span class="n">DeleteColumn</span><span class="p">()</span>
    <span class="n">view</span> <span class="o">=</span> <span class="n">ViewColumn</span><span class="p">()</span>
    <span class="n">noduplicate</span> <span class="o">=</span> <span class="n">DuplicateColumn</span><span class="p">()</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;desc&quot;</span><span class="p">]</span>
        <span class="n">sequence</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="s2">&quot;view&quot;</span><span class="p">,</span> <span class="s2">&quot;edit&quot;</span><span class="p">,</span> <span class="s2">&quot;delete&quot;</span><span class="p">,</span> <span class="s2">&quot;noduplicate&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="apis_core.generic.tables.MoreLessColumn" class="doc doc-heading">
            <code>MoreLessColumn</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="django_tables2.TemplateColumn">TemplateColumn</span></code></p>


        <p>Useful for displaying long fields.
A preview is shown initially with a "Show more" link
which is replaced with a "Show less" link when expanded.</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/generic/tables.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MoreLessColumn</span><span class="p">(</span><span class="n">tables</span><span class="o">.</span><span class="n">TemplateColumn</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Useful for displaying long fields.</span>
<span class="sd">    A preview is shown initially with a &quot;Show more&quot; link</span>
<span class="sd">    which is replaced with a &quot;Show less&quot; link when expanded.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">template_name</span> <span class="o">=</span> <span class="s2">&quot;columns/more-less.html&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">preview</span><span class="p">,</span> <span class="n">fulltext</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preview</span> <span class="o">=</span> <span class="n">preview</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fulltext</span> <span class="o">=</span> <span class="n">fulltext</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">template_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">template_name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extra_context</span><span class="p">[</span><span class="s2">&quot;preview&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preview</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extra_context</span><span class="p">[</span><span class="s2">&quot;fulltext&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fulltext</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="apis_core.generic.tables.ViewColumn" class="doc doc-heading">
            <code>ViewColumn</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ActionColumn (apis_core.generic.tables.ActionColumn)" href="#apis_core.generic.tables.ActionColumn">ActionColumn</a></code></p>


        <p>A column showing a view button</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/generic/tables.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ViewColumn</span><span class="p">(</span><span class="n">ActionColumn</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A column showing a view button</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">template_name</span> <span class="o">=</span> <span class="s2">&quot;columns/view.html&quot;</span>
    <span class="n">permission</span> <span class="o">=</span> <span class="s2">&quot;view&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="apis_core.generic.tests" class="doc doc-heading">
            <code>tests</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="apis_core.generic.tests.setup_test_app" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setup_test_app</span><span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Setup a Django test app for the provided package to allow test models
tables to be created if the containing app has migrations.</p>
<p>This function should be called from app.tests <strong>init</strong> module and pass
along <strong>package</strong>.</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/generic/tests/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">setup_test_app</span><span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Setup a Django test app for the provided package to allow test models</span>
<span class="sd">    tables to be created if the containing app has migrations.</span>

<span class="sd">    This function should be called from app.tests __init__ module and pass</span>
<span class="sd">    along __package__.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">app_config</span> <span class="o">=</span> <span class="n">AppConfig</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">package</span><span class="p">)</span>
    <span class="n">app_config</span><span class="o">.</span><span class="n">apps</span> <span class="o">=</span> <span class="n">apps</span>
    <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">containing_app_config</span> <span class="o">=</span> <span class="n">apps</span><span class="o">.</span><span class="n">get_containing_app_config</span><span class="p">(</span><span class="n">package</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">containing_app_config</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s2">_tests&quot;</span>
    <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">apps</span><span class="o">.</span><span class="n">app_configs</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There&#39;s already an app registered with the &#39;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">&#39; label.&quot;</span><span class="p">)</span>
    <span class="n">app_config</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
    <span class="n">apps</span><span class="o">.</span><span class="n">app_configs</span><span class="p">[</span><span class="n">app_config</span><span class="o">.</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">app_config</span>
    <span class="n">app_config</span><span class="o">.</span><span class="n">import_models</span><span class="p">()</span>
    <span class="n">apps</span><span class="o">.</span><span class="n">clear_cache</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>


<div class="doc doc-object doc-module">



<h4 id="apis_core.generic.tests.test_generic" class="doc doc-heading">
            <code>test_generic</code>


</h4>

    <div class="doc doc-contents ">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h5 id="apis_core.generic.tests.test_generic.TestGeneric" class="doc doc-heading">
            <code>TestGeneric</code>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="object">object</span></code></p>








              <details class="quote">
                <summary>Source code in <code>apis_core/generic/tests/test_generic.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">django_db</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TestGeneric</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Create an admin user</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">admin</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_superuser</span><span class="p">(</span>
            <span class="s2">&quot;admin&quot;</span><span class="p">,</span> <span class="n">fake</span><span class="o">.</span><span class="n">email</span><span class="p">(),</span> <span class="n">fake</span><span class="o">.</span><span class="n">password</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="c1"># Create a normal user</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span>
            <span class="n">fake</span><span class="o">.</span><span class="n">user_name</span><span class="p">(),</span> <span class="n">fake</span><span class="o">.</span><span class="n">email</span><span class="p">(),</span> <span class="n">fake</span><span class="o">.</span><span class="n">password</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="c1"># Create a couple of person objects</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fake</span><span class="o">.</span><span class="n">random_int</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">20</span><span class="p">)):</span>
            <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                <span class="n">first_name</span><span class="o">=</span><span class="n">fake</span><span class="o">.</span><span class="n">first_name</span><span class="p">(),</span> <span class="n">last_name</span><span class="o">=</span><span class="n">fake</span><span class="o">.</span><span class="n">last_name</span><span class="p">()</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unique</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">first_name</span><span class="o">=</span><span class="n">unique_first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="o">=</span><span class="n">unique_last_name</span>
        <span class="p">)</span>
        <span class="c1"># Create a person without any attributes</span>
        <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">person_count</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_person_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the correct number of persons was created&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">person_count</span>

    <span class="c1"># Initial tests for checking the permissions of the views</span>

    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="n">route_parameters</span><span class="p">,</span> <span class="n">routes</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_anon_person_views</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="p">,</span> <span class="n">route</span><span class="p">,</span> <span class="n">permission</span><span class="p">,</span> <span class="n">status_code</span><span class="p">,</span> <span class="n">client</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Anon user should not be able to access the person views&quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">route</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">302</span>

    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="n">route_parameters</span><span class="p">,</span> <span class="n">routes</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_admin_person_views</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="p">,</span> <span class="n">route</span><span class="p">,</span> <span class="n">permission</span><span class="p">,</span> <span class="n">status_code</span><span class="p">,</span> <span class="n">admin_client</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Admin user should be able to access the person list&quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">admin_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">route</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">status_code</span>

    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="n">route_parameters</span><span class="p">,</span> <span class="n">routes</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_person_user_views</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="p">,</span> <span class="n">route</span><span class="p">,</span> <span class="n">permission</span><span class="p">,</span> <span class="n">status_code</span><span class="p">,</span> <span class="n">client</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Normal user should not be able to access the person list&quot;&quot;&quot;</span>
        <span class="n">client</span><span class="o">.</span><span class="n">force_login</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">route</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">403</span>

    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="n">route_parameters</span><span class="p">,</span> <span class="n">routes</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_person_user_with_access</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="p">,</span> <span class="n">route</span><span class="p">,</span> <span class="n">permission</span><span class="p">,</span> <span class="n">status_code</span><span class="p">,</span> <span class="n">client</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Normal user should be able to access the person views after bein granted permission&quot;&quot;&quot;</span>
        <span class="n">content_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">Person</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">Permission</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">codename</span><span class="o">=</span><span class="n">permission</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">user_permissions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">client</span><span class="o">.</span><span class="n">force_login</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">route</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">status_code</span>

    <span class="c1"># More detailed tests checking the content of the responses and sending actual data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_person_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="p">,</span> <span class="n">admin_client</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the first_name of some person object is listed in the person list&quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">admin_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/generic_tests.person/&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">p</span><span class="o">.</span><span class="n">first_name</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_person_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="p">,</span> <span class="n">admin_client</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the details page of a person lists its details&quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">admin_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/generic_tests.person/</span><span class="si">{</span><span class="n">p</span><span class="o">.</span><span class="n">pk</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">p</span><span class="o">.</span><span class="n">first_name</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">p</span><span class="o">.</span><span class="n">last_name</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_person_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="p">,</span> <span class="n">admin_client</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if we can create a person using the create route&quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;first_name&quot;</span><span class="p">:</span> <span class="n">fake</span><span class="o">.</span><span class="n">first_name</span><span class="p">(),</span>
            <span class="s2">&quot;last_name&quot;</span><span class="p">:</span> <span class="n">fake</span><span class="o">.</span><span class="n">last_name</span><span class="p">(),</span>
        <span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">admin_client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/generic_tests.person/create&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
        <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;first_name&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;last_name&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">person_count</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_person_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="p">,</span> <span class="n">admin_client</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if we can delete a person using the delete route&quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">admin_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/generic_tests.person/delete/</span><span class="si">{</span><span class="n">p</span><span class="o">.</span><span class="n">pk</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
        <span class="k">assert</span> <span class="s2">&quot;Confirm deletion of:&quot;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_person_delete_confirmation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="p">,</span> <span class="n">admin_client</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if we can delete a person using the delete route&quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">admin_client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;/generic_tests.person/delete/</span><span class="si">{</span><span class="n">p</span><span class="o">.</span><span class="n">pk</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
        <span class="k">assert</span> <span class="n">p</span><span class="o">.</span><span class="n">first_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">p</span><span class="o">.</span><span class="n">last_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">person_count</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_person_delete_redirect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="p">,</span> <span class="n">admin_client</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if we can delete a person using the delete route&quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">admin_client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;/generic_tests.person/delete/</span><span class="si">{</span><span class="n">p</span><span class="o">.</span><span class="n">pk</span><span class="si">}</span><span class="s2">?redirect=/generic_tests.person/create&quot;</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">302</span>
        <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;Location&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;/generic_tests.person/create&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_person_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="p">,</span> <span class="n">admin_client</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if we can update a person&quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;first_name&quot;</span><span class="p">:</span> <span class="n">fake</span><span class="o">.</span><span class="n">first_name</span><span class="p">(),</span>
            <span class="s2">&quot;last_name&quot;</span><span class="p">:</span> <span class="n">fake</span><span class="o">.</span><span class="n">last_name</span><span class="p">(),</span>
        <span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">admin_client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;/generic_tests.person/update/</span><span class="si">{</span><span class="n">p</span><span class="o">.</span><span class="n">pk</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
        <span class="k">assert</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">last_name</span> <span class="o">==</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;last_name&quot;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">first_name</span> <span class="o">==</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;first_name&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_person_autocomplete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="p">,</span> <span class="n">admin_client</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if we find a person using autocomplete&quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">admin_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;/generic_tests.person/autocomplete?q=</span><span class="si">{</span><span class="n">p</span><span class="o">.</span><span class="n">first_name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">pk</span><span class="p">),</span> <span class="s2">&quot;selected_text&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)}],</span>
            <span class="s2">&quot;pagination&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;more&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
        <span class="p">}</span>
        <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> <span class="o">==</span> <span class="n">expected</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_person_table_export_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rf</span><span class="p">,</span> <span class="n">admin_user</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the person table provides the correct export filename&quot;&quot;&quot;</span>
        <span class="n">view</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">Person</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">view</span><span class="o">.</span><span class="n">get_export_filename</span><span class="p">(</span><span class="s2">&quot;ext&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;table.ext&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_dummy_table_export_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rf</span><span class="p">,</span> <span class="n">admin_user</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the dummy table provides the correct export filename&quot;&quot;&quot;</span>
        <span class="n">view</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">Dummy</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">view</span><span class="o">.</span><span class="n">get_export_filename</span><span class="p">(</span><span class="s2">&quot;ext&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;dummytable.ext&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_dummy_table_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">admin_client</span><span class="p">):</span>
        <span class="n">request</span> <span class="o">=</span> <span class="n">admin_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/generic_tests.dummy/&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;table&quot;</span><span class="p">],</span> <span class="n">DummyTable</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_list_view_contains_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">admin_client</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the columns selector is present &amp; if some of the options are present&quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">admin_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/generic_tests.person/&quot;</span><span class="p">)</span>
        <span class="n">assertContains</span><span class="p">(</span>
            <span class="n">response</span><span class="p">,</span>
            <span class="s1">&#39;&lt;select name=&quot;choices-columns&quot; class=&quot;selectmultiple form-select&quot; id=&quot;id_choices-columns&quot; multiple&gt;&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s1">&#39;&lt;option value=&quot;id&quot; selected&gt;ID&lt;/option&gt;&#39;</span><span class="p">)</span>
        <span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s1">&#39;&lt;option value=&quot;first_name&quot;&gt;First name&lt;/option&gt;&#39;</span><span class="p">)</span>
        <span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s1">&#39;&lt;option value=&quot;last_name&quot;&gt;Last name&lt;/option&gt;&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h6 id="apis_core.generic.tests.test_generic.TestGeneric.test_admin_person_views" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">test_admin_person_views</span><span class="p">(</span><span class="n">setup</span><span class="p">,</span> <span class="n">route</span><span class="p">,</span> <span class="n">permission</span><span class="p">,</span> <span class="n">status_code</span><span class="p">,</span> <span class="n">admin_client</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Admin user should be able to access the person list</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/generic/tests/test_generic.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="n">route_parameters</span><span class="p">,</span> <span class="n">routes</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_admin_person_views</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="p">,</span> <span class="n">route</span><span class="p">,</span> <span class="n">permission</span><span class="p">,</span> <span class="n">status_code</span><span class="p">,</span> <span class="n">admin_client</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Admin user should be able to access the person list&quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">admin_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">route</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">status_code</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="apis_core.generic.tests.test_generic.TestGeneric.test_anon_person_views" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">test_anon_person_views</span><span class="p">(</span><span class="n">setup</span><span class="p">,</span> <span class="n">route</span><span class="p">,</span> <span class="n">permission</span><span class="p">,</span> <span class="n">status_code</span><span class="p">,</span> <span class="n">client</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Anon user should not be able to access the person views</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/generic/tests/test_generic.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="n">route_parameters</span><span class="p">,</span> <span class="n">routes</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_anon_person_views</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="p">,</span> <span class="n">route</span><span class="p">,</span> <span class="n">permission</span><span class="p">,</span> <span class="n">status_code</span><span class="p">,</span> <span class="n">client</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Anon user should not be able to access the person views&quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">route</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">302</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="apis_core.generic.tests.test_generic.TestGeneric.test_dummy_table_export_filename" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">test_dummy_table_export_filename</span><span class="p">(</span><span class="n">rf</span><span class="p">,</span> <span class="n">admin_user</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Check if the dummy table provides the correct export filename</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/generic/tests/test_generic.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_dummy_table_export_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rf</span><span class="p">,</span> <span class="n">admin_user</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if the dummy table provides the correct export filename&quot;&quot;&quot;</span>
    <span class="n">view</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">Dummy</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">view</span><span class="o">.</span><span class="n">get_export_filename</span><span class="p">(</span><span class="s2">&quot;ext&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;dummytable.ext&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="apis_core.generic.tests.test_generic.TestGeneric.test_list_view_contains_columns" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">test_list_view_contains_columns</span><span class="p">(</span><span class="n">admin_client</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Check if the columns selector is present &amp; if some of the options are present</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/generic/tests/test_generic.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_list_view_contains_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">admin_client</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if the columns selector is present &amp; if some of the options are present&quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">admin_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/generic_tests.person/&quot;</span><span class="p">)</span>
    <span class="n">assertContains</span><span class="p">(</span>
        <span class="n">response</span><span class="p">,</span>
        <span class="s1">&#39;&lt;select name=&quot;choices-columns&quot; class=&quot;selectmultiple form-select&quot; id=&quot;id_choices-columns&quot; multiple&gt;&#39;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s1">&#39;&lt;option value=&quot;id&quot; selected&gt;ID&lt;/option&gt;&#39;</span><span class="p">)</span>
    <span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s1">&#39;&lt;option value=&quot;first_name&quot;&gt;First name&lt;/option&gt;&#39;</span><span class="p">)</span>
    <span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s1">&#39;&lt;option value=&quot;last_name&quot;&gt;Last name&lt;/option&gt;&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="apis_core.generic.tests.test_generic.TestGeneric.test_person_autocomplete" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">test_person_autocomplete</span><span class="p">(</span><span class="n">setup</span><span class="p">,</span> <span class="n">admin_client</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Check if we find a person using autocomplete</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/generic/tests/test_generic.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_person_autocomplete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="p">,</span> <span class="n">admin_client</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if we find a person using autocomplete&quot;&quot;&quot;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">admin_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;/generic_tests.person/autocomplete?q=</span><span class="si">{</span><span class="n">p</span><span class="o">.</span><span class="n">first_name</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">pk</span><span class="p">),</span> <span class="s2">&quot;selected_text&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)}],</span>
        <span class="s2">&quot;pagination&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;more&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
    <span class="p">}</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> <span class="o">==</span> <span class="n">expected</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="apis_core.generic.tests.test_generic.TestGeneric.test_person_count" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">test_person_count</span><span class="p">(</span><span class="n">setup</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Check if the correct number of persons was created</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/generic/tests/test_generic.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_person_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if the correct number of persons was created&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">person_count</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="apis_core.generic.tests.test_generic.TestGeneric.test_person_create" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">test_person_create</span><span class="p">(</span><span class="n">setup</span><span class="p">,</span> <span class="n">admin_client</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Check if we can create a person using the create route</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/generic/tests/test_generic.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_person_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="p">,</span> <span class="n">admin_client</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if we can create a person using the create route&quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;first_name&quot;</span><span class="p">:</span> <span class="n">fake</span><span class="o">.</span><span class="n">first_name</span><span class="p">(),</span>
        <span class="s2">&quot;last_name&quot;</span><span class="p">:</span> <span class="n">fake</span><span class="o">.</span><span class="n">last_name</span><span class="p">(),</span>
    <span class="p">}</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">admin_client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/generic_tests.person/create&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;first_name&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;last_name&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">person_count</span> <span class="o">+</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="apis_core.generic.tests.test_generic.TestGeneric.test_person_delete" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">test_person_delete</span><span class="p">(</span><span class="n">setup</span><span class="p">,</span> <span class="n">admin_client</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Check if we can delete a person using the delete route</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/generic/tests/test_generic.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_person_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="p">,</span> <span class="n">admin_client</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if we can delete a person using the delete route&quot;&quot;&quot;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">admin_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/generic_tests.person/delete/</span><span class="si">{</span><span class="n">p</span><span class="o">.</span><span class="n">pk</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">assert</span> <span class="s2">&quot;Confirm deletion of:&quot;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="apis_core.generic.tests.test_generic.TestGeneric.test_person_delete_confirmation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">test_person_delete_confirmation</span><span class="p">(</span><span class="n">setup</span><span class="p">,</span> <span class="n">admin_client</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Check if we can delete a person using the delete route</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/generic/tests/test_generic.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_person_delete_confirmation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="p">,</span> <span class="n">admin_client</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if we can delete a person using the delete route&quot;&quot;&quot;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">admin_client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;/generic_tests.person/delete/</span><span class="si">{</span><span class="n">p</span><span class="o">.</span><span class="n">pk</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">assert</span> <span class="n">p</span><span class="o">.</span><span class="n">first_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">p</span><span class="o">.</span><span class="n">last_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">person_count</span> <span class="o">-</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="apis_core.generic.tests.test_generic.TestGeneric.test_person_delete_redirect" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">test_person_delete_redirect</span><span class="p">(</span><span class="n">setup</span><span class="p">,</span> <span class="n">admin_client</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Check if we can delete a person using the delete route</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/generic/tests/test_generic.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_person_delete_redirect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="p">,</span> <span class="n">admin_client</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if we can delete a person using the delete route&quot;&quot;&quot;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">admin_client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;/generic_tests.person/delete/</span><span class="si">{</span><span class="n">p</span><span class="o">.</span><span class="n">pk</span><span class="si">}</span><span class="s2">?redirect=/generic_tests.person/create&quot;</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">302</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;Location&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;/generic_tests.person/create&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="apis_core.generic.tests.test_generic.TestGeneric.test_person_detail" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">test_person_detail</span><span class="p">(</span><span class="n">setup</span><span class="p">,</span> <span class="n">admin_client</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Check if the details page of a person lists its details</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/generic/tests/test_generic.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_person_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="p">,</span> <span class="n">admin_client</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if the details page of a person lists its details&quot;&quot;&quot;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">admin_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/generic_tests.person/</span><span class="si">{</span><span class="n">p</span><span class="o">.</span><span class="n">pk</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">p</span><span class="o">.</span><span class="n">first_name</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">p</span><span class="o">.</span><span class="n">last_name</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="apis_core.generic.tests.test_generic.TestGeneric.test_person_list" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">test_person_list</span><span class="p">(</span><span class="n">setup</span><span class="p">,</span> <span class="n">admin_client</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Check if the first_name of some person object is listed in the person list</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/generic/tests/test_generic.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_person_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="p">,</span> <span class="n">admin_client</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if the first_name of some person object is listed in the person list&quot;&quot;&quot;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">admin_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/generic_tests.person/&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">p</span><span class="o">.</span><span class="n">first_name</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="apis_core.generic.tests.test_generic.TestGeneric.test_person_table_export_filename" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">test_person_table_export_filename</span><span class="p">(</span><span class="n">rf</span><span class="p">,</span> <span class="n">admin_user</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Check if the person table provides the correct export filename</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/generic/tests/test_generic.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_person_table_export_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rf</span><span class="p">,</span> <span class="n">admin_user</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if the person table provides the correct export filename&quot;&quot;&quot;</span>
    <span class="n">view</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">Person</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">view</span><span class="o">.</span><span class="n">get_export_filename</span><span class="p">(</span><span class="s2">&quot;ext&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;table.ext&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="apis_core.generic.tests.test_generic.TestGeneric.test_person_update" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">test_person_update</span><span class="p">(</span><span class="n">setup</span><span class="p">,</span> <span class="n">admin_client</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Check if we can update a person</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/generic/tests/test_generic.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_person_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="p">,</span> <span class="n">admin_client</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if we can update a person&quot;&quot;&quot;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;first_name&quot;</span><span class="p">:</span> <span class="n">fake</span><span class="o">.</span><span class="n">first_name</span><span class="p">(),</span>
        <span class="s2">&quot;last_name&quot;</span><span class="p">:</span> <span class="n">fake</span><span class="o">.</span><span class="n">last_name</span><span class="p">(),</span>
    <span class="p">}</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">admin_client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;/generic_tests.person/update/</span><span class="si">{</span><span class="n">p</span><span class="o">.</span><span class="n">pk</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">assert</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">last_name</span> <span class="o">==</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;last_name&quot;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">first_name</span> <span class="o">==</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;first_name&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="apis_core.generic.tests.test_generic.TestGeneric.test_person_user_views" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">test_person_user_views</span><span class="p">(</span><span class="n">setup</span><span class="p">,</span> <span class="n">route</span><span class="p">,</span> <span class="n">permission</span><span class="p">,</span> <span class="n">status_code</span><span class="p">,</span> <span class="n">client</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Normal user should not be able to access the person list</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/generic/tests/test_generic.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="n">route_parameters</span><span class="p">,</span> <span class="n">routes</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_person_user_views</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="p">,</span> <span class="n">route</span><span class="p">,</span> <span class="n">permission</span><span class="p">,</span> <span class="n">status_code</span><span class="p">,</span> <span class="n">client</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Normal user should not be able to access the person list&quot;&quot;&quot;</span>
    <span class="n">client</span><span class="o">.</span><span class="n">force_login</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">route</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">403</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="apis_core.generic.tests.test_generic.TestGeneric.test_person_user_with_access" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">test_person_user_with_access</span><span class="p">(</span><span class="n">setup</span><span class="p">,</span> <span class="n">route</span><span class="p">,</span> <span class="n">permission</span><span class="p">,</span> <span class="n">status_code</span><span class="p">,</span> <span class="n">client</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Normal user should be able to access the person views after bein granted permission</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/generic/tests/test_generic.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="n">route_parameters</span><span class="p">,</span> <span class="n">routes</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_person_user_with_access</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="p">,</span> <span class="n">route</span><span class="p">,</span> <span class="n">permission</span><span class="p">,</span> <span class="n">status_code</span><span class="p">,</span> <span class="n">client</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Normal user should be able to access the person views after bein granted permission&quot;&quot;&quot;</span>
    <span class="n">content_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">Person</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Permission</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">codename</span><span class="o">=</span><span class="n">permission</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">user_permissions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">client</span><span class="o">.</span><span class="n">force_login</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">route</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">status_code</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="apis_core.generic.urls" class="doc doc-heading">
            <code>urls</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="apis_core.generic.urls.ContenttypeConverter" class="doc doc-heading">
            <code>ContenttypeConverter</code>


</h4>


    <div class="doc doc-contents ">


        <p>A converter that converts from a string representation of a
model (<code>app_label.model</code>) to the actual Django model class.</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/generic/urls.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ContenttypeConverter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A converter that converts from a string representation of a</span>
<span class="sd">    model (`app_label.model`) to the actual Django model class.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">regex</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\w+\.\w+&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">app_label</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="n">contenttype</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">ContentType</span><span class="p">,</span> <span class="n">app_label</span><span class="o">=</span><span class="n">app_label</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">contenttype</span><span class="o">.</span><span class="n">model_class</span><span class="p">(),</span> <span class="n">GenericModel</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">contenttype</span>
        <span class="k">raise</span> <span class="n">Http404</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">ContentType</span><span class="p">):</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">value</span><span class="o">.</span><span class="n">app_label</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">value</span><span class="o">.</span><span class="n">model</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="apis_core.generic.views" class="doc doc-heading">
            <code>views</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="apis_core.generic.views.Autocomplete" class="doc doc-heading">
            <code>Autocomplete</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GenericModelMixin (apis_core.generic.views.GenericModelMixin)" href="#apis_core.generic.views.GenericModelMixin">GenericModelMixin</a></code>, <code><a class="autorefs autorefs-internal" title="GenericModelPermissionRequiredMixin (apis_core.generic.views.GenericModelPermissionRequiredMixin)" href="#apis_core.generic.views.GenericModelPermissionRequiredMixin">GenericModelPermissionRequiredMixin</a></code>, <code><span title="dal.autocomplete.Select2QuerySetView">Select2QuerySetView</span></code></p>


        <p>Autocomplete view for a generic model.
Access requires the <code>&lt;model&gt;_view</code> permission.
The queryset is overridden by the first match from
the <code>first_member_match</code> helper.</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/generic/views.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Autocomplete</span><span class="p">(</span>
    <span class="n">GenericModelMixin</span><span class="p">,</span>
    <span class="n">GenericModelPermissionRequiredMixin</span><span class="p">,</span>
    <span class="n">autocomplete</span><span class="o">.</span><span class="n">Select2QuerySetView</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Autocomplete view for a generic model.</span>
<span class="sd">    Access requires the `&lt;model&gt;_view` permission.</span>
<span class="sd">    The queryset is overridden by the first match from</span>
<span class="sd">    the `first_member_match` helper.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">permission_action_required</span> <span class="o">=</span> <span class="s2">&quot;view&quot;</span>
    <span class="n">template_name_suffix</span> <span class="o">=</span> <span class="s2">&quot;_autocomplete_result&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># We use a URI parameter to enable the create functionality in the</span>
        <span class="c1"># autocomplete dropdown. It is not important what the value of the</span>
        <span class="c1"># `create_field` is, because we override create_object anyway.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;create&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">template</span> <span class="o">=</span> <span class="n">select_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_template_names</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">name</span>
        <span class="k">except</span> <span class="n">TemplateDoesNotExist</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">queryset_methods</span> <span class="o">=</span> <span class="n">module_paths</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;querysets&quot;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;AutocompleteQueryset&quot;</span>
        <span class="p">)</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">first_member_match</span><span class="p">(</span><span class="n">queryset_methods</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">queryset</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">queryset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">generate_search_filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="n">external_only</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;external_only&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">external_only</span> <span class="k">else</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_results</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
        <span class="n">queryset_methods</span> <span class="o">=</span> <span class="n">module_paths</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;querysets&quot;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;ExternalAutocomplete&quot;</span>
        <span class="p">)</span>
        <span class="n">ExternalAutocomplete</span> <span class="o">=</span> <span class="n">first_member_match</span><span class="p">(</span><span class="n">queryset_methods</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ExternalAutocomplete</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ExternalAutocomplete</span><span class="p">()</span><span class="o">.</span><span class="n">get_results</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        We try multiple approaches to create a model instance from a value:</span>
<span class="sd">        * we first test if the value is an URL and if so we expect it to be</span>
<span class="sd">        something that can be imported using one of the configured importers</span>
<span class="sd">        and so we pass the value to the import logic.</span>
<span class="sd">        * if the value is not a string, we try to pass it to the `create_from_string`</span>
<span class="sd">        method of the model, if that does exist. Its the models responsibility to</span>
<span class="sd">        implement this method and the method should somehow know how to create</span>
<span class="sd">        model instance from the value...</span>
<span class="sd">        * finally we pass the value to the `create_object` method from the DAL</span>
<span class="sd">        view, which tries to pass it to `get_or_create` which likely also fails,</span>
<span class="sd">        but this is expected and we raise a more useful exception.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">URLValidator</span><span class="p">()(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">queryset</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">import_from</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ValidationError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">queryset</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">create_from_string</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ImproperlyConfigured</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Model &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">queryset</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">verbose_name</span><span class="si">}</span><span class="s1">&quot; not configured to create from string&#39;</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">transaction</span><span class="o">.</span><span class="n">atomic</span><span class="p">():</span>
                <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
            <span class="k">return</span> <span class="n">http</span><span class="o">.</span><span class="n">JsonResponse</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)})</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="apis_core.generic.views.Autocomplete.create_object" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_object</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>We try multiple approaches to create a model instance from a value:
* we first test if the value is an URL and if so we expect it to be
something that can be imported using one of the configured importers
and so we pass the value to the import logic.
* if the value is not a string, we try to pass it to the <code>create_from_string</code>
method of the model, if that does exist. Its the models responsibility to
implement this method and the method should somehow know how to create
model instance from the value...
* finally we pass the value to the <code>create_object</code> method from the DAL
view, which tries to pass it to <code>get_or_create</code> which likely also fails,
but this is expected and we raise a more useful exception.</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/generic/views.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    We try multiple approaches to create a model instance from a value:</span>
<span class="sd">    * we first test if the value is an URL and if so we expect it to be</span>
<span class="sd">    something that can be imported using one of the configured importers</span>
<span class="sd">    and so we pass the value to the import logic.</span>
<span class="sd">    * if the value is not a string, we try to pass it to the `create_from_string`</span>
<span class="sd">    method of the model, if that does exist. Its the models responsibility to</span>
<span class="sd">    implement this method and the method should somehow know how to create</span>
<span class="sd">    model instance from the value...</span>
<span class="sd">    * finally we pass the value to the `create_object` method from the DAL</span>
<span class="sd">    view, which tries to pass it to `get_or_create` which likely also fails,</span>
<span class="sd">    but this is expected and we raise a more useful exception.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">URLValidator</span><span class="p">()(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">queryset</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">import_from</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">ValidationError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">queryset</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">create_from_string</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ImproperlyConfigured</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;Model &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">queryset</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">verbose_name</span><span class="si">}</span><span class="s1">&quot; not configured to create from string&#39;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="apis_core.generic.views.Create" class="doc doc-heading">
            <code>Create</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GenericModelMixin (apis_core.generic.views.GenericModelMixin)" href="#apis_core.generic.views.GenericModelMixin">GenericModelMixin</a></code>, <code><a class="autorefs autorefs-internal" title="GenericModelPermissionRequiredMixin (apis_core.generic.views.GenericModelPermissionRequiredMixin)" href="#apis_core.generic.views.GenericModelPermissionRequiredMixin">GenericModelPermissionRequiredMixin</a></code>, <code><span title="django.contrib.messages.views.SuccessMessageMixin">SuccessMessageMixin</span></code>, <code><span title="django.views.generic.edit.CreateView">CreateView</span></code></p>


        <p>Create view for a generic model.
Access requires the <code>&lt;model&gt;_add</code> permission.
The form class is overridden by the first match from
the <code>first_member_match</code> helper.</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/generic/views.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Create</span><span class="p">(</span>
    <span class="n">GenericModelMixin</span><span class="p">,</span>
    <span class="n">GenericModelPermissionRequiredMixin</span><span class="p">,</span>
    <span class="n">SuccessMessageMixin</span><span class="p">,</span>
    <span class="n">CreateView</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create view for a generic model.</span>
<span class="sd">    Access requires the `&lt;model&gt;_add` permission.</span>
<span class="sd">    The form class is overridden by the first match from</span>
<span class="sd">    the `first_member_match` helper.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">template_name_suffix</span> <span class="o">=</span> <span class="s2">&quot;_create&quot;</span>
    <span class="n">permission_action_required</span> <span class="o">=</span> <span class="s2">&quot;add&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_form_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">form_modules</span> <span class="o">=</span> <span class="n">module_paths</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;forms&quot;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;Form&quot;</span><span class="p">)</span>
        <span class="n">form_class</span> <span class="o">=</span> <span class="n">first_member_match</span><span class="p">(</span><span class="n">form_modules</span><span class="p">,</span> <span class="n">GenericModelForm</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">modelform_factory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">form_class</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_success_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cleaned_data</span><span class="p">):</span>
        <span class="n">message_templates</span> <span class="o">=</span> <span class="n">template_names_via_mro</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;_create_success_message.html&quot;</span>
        <span class="p">)</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">select_template</span><span class="p">(</span><span class="n">message_templates</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">({</span><span class="s2">&quot;object&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_success_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">get_create_success_url</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="apis_core.generic.views.Delete" class="doc doc-heading">
            <code>Delete</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GenericModelMixin (apis_core.generic.views.GenericModelMixin)" href="#apis_core.generic.views.GenericModelMixin">GenericModelMixin</a></code>, <code><a class="autorefs autorefs-internal" title="GenericModelPermissionRequiredMixin (apis_core.generic.views.GenericModelPermissionRequiredMixin)" href="#apis_core.generic.views.GenericModelPermissionRequiredMixin">GenericModelPermissionRequiredMixin</a></code>, <code><span title="django.views.generic.edit.DeleteView">DeleteView</span></code></p>


        <p>Delete view for a generic model.
Access requires the <code>&lt;model&gt;_delete</code> permission.</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/generic/views.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Delete</span><span class="p">(</span><span class="n">GenericModelMixin</span><span class="p">,</span> <span class="n">GenericModelPermissionRequiredMixin</span><span class="p">,</span> <span class="n">DeleteView</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete view for a generic model.</span>
<span class="sd">    Access requires the `&lt;model&gt;_delete` permission.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">permission_action_required</span> <span class="o">=</span> <span class="s2">&quot;delete&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_success_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">redirect</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;redirect&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">redirect</span>
        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span>
            <span class="s2">&quot;apis_core:generic:list&quot;</span><span class="p">,</span>
            <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">resolver_match</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;contenttype&quot;</span><span class="p">]],</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="apis_core.generic.views.Detail" class="doc doc-heading">
            <code>Detail</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GenericModelMixin (apis_core.generic.views.GenericModelMixin)" href="#apis_core.generic.views.GenericModelMixin">GenericModelMixin</a></code>, <code><a class="autorefs autorefs-internal" title="GenericModelPermissionRequiredMixin (apis_core.generic.views.GenericModelPermissionRequiredMixin)" href="#apis_core.generic.views.GenericModelPermissionRequiredMixin">GenericModelPermissionRequiredMixin</a></code>, <code><span title="django.views.generic.DetailView">DetailView</span></code></p>


        <p>Detail view for a generic model.
Access requires the <code>&lt;model&gt;_view</code> permission.</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/generic/views.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Detail</span><span class="p">(</span><span class="n">GenericModelMixin</span><span class="p">,</span> <span class="n">GenericModelPermissionRequiredMixin</span><span class="p">,</span> <span class="n">DetailView</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Detail view for a generic model.</span>
<span class="sd">    Access requires the `&lt;model&gt;_view` permission.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">permission_action_required</span> <span class="o">=</span> <span class="s2">&quot;view&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="apis_core.generic.views.Enrich" class="doc doc-heading">
            <code>Enrich</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GenericModelMixin (apis_core.generic.views.GenericModelMixin)" href="#apis_core.generic.views.GenericModelMixin">GenericModelMixin</a></code>, <code><a class="autorefs autorefs-internal" title="GenericModelPermissionRequiredMixin (apis_core.generic.views.GenericModelPermissionRequiredMixin)" href="#apis_core.generic.views.GenericModelPermissionRequiredMixin">GenericModelPermissionRequiredMixin</a></code>, <code><span title="django.views.generic.edit.FormView">FormView</span></code></p>


        <p>Enrich an entity with data from an external source
Provides the user with a form to select the fields that should be updated.</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/generic/views.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Enrich</span><span class="p">(</span><span class="n">GenericModelMixin</span><span class="p">,</span> <span class="n">GenericModelPermissionRequiredMixin</span><span class="p">,</span> <span class="n">FormView</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enrich an entity with data from an external source</span>
<span class="sd">    Provides the user with a form to select the fields that should be updated.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">permission_action_required</span> <span class="o">=</span> <span class="s2">&quot;change&quot;</span>
    <span class="n">template_name_suffix</span> <span class="o">=</span> <span class="s2">&quot;_enrich&quot;</span>
    <span class="n">form_class</span> <span class="o">=</span> <span class="n">GenericEnrichForm</span>
    <span class="n">importer_class</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">])</span>
        <span class="n">_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uri</span> <span class="o">=</span> <span class="n">get_autocomplete_data_and_normalized_uri</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uri&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">uri</span><span class="p">:</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;No uri parameter specified.&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">uriobj</span> <span class="o">=</span> <span class="n">Uri</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">uri</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">uriobj</span><span class="o">.</span><span class="n">object_id</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
                <span class="n">messages</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;Object with URI </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">uri</span><span class="si">}</span><span class="s2"> already exists, you were redirected to the merge form.&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">get_merge_url</span><span class="p">(</span><span class="n">uriobj</span><span class="o">.</span><span class="n">object_id</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">Uri</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ctx</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span>
        <span class="n">ctx</span><span class="p">[</span><span class="s2">&quot;uri&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uri</span>
        <span class="k">return</span> <span class="n">ctx</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_form_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_form_kwargs</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;instance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uri&quot;</span><span class="p">))</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="k">except</span> <span class="n">ImproperlyConfigured</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">kwargs</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">form_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Go through all the form fields and extract the ones that</span>
<span class="sd">        start with `update_` and that are set (those are the checkboxes that</span>
<span class="sd">        select which fields to update).</span>
<span class="sd">        Create a dict from those values, add the uri and pass the dict on to</span>
<span class="sd">        the models `import_data` method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;update_&quot;</span><span class="p">):</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">removeprefix</span><span class="p">(</span><span class="s2">&quot;update_&quot;</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;same_as&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">uri</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;same_as&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">import_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">field</span><span class="p">,</span> <span class="n">error</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">,</span> <span class="s2">&quot;_import_errors&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">messages</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Could not update </span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Updated fields </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">form_valid</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_success_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="apis_core.generic.views.Enrich.form_valid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">form_valid</span><span class="p">(</span><span class="n">form</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Go through all the form fields and extract the ones that
start with <code>update_</code> and that are set (those are the checkboxes that
select which fields to update).
Create a dict from those values, add the uri and pass the dict on to
the models <code>import_data</code> method.</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/generic/views.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">form_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Go through all the form fields and extract the ones that</span>
<span class="sd">    start with `update_` and that are set (those are the checkboxes that</span>
<span class="sd">    select which fields to update).</span>
<span class="sd">    Create a dict from those values, add the uri and pass the dict on to</span>
<span class="sd">    the models `import_data` method.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;update_&quot;</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">removeprefix</span><span class="p">(</span><span class="s2">&quot;update_&quot;</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;same_as&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">uri</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;same_as&quot;</span><span class="p">,</span> <span class="p">[])</span>
    <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">import_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">field</span><span class="p">,</span> <span class="n">error</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">,</span> <span class="s2">&quot;_import_errors&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Could not update </span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">messages</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Updated fields </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">form_valid</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="apis_core.generic.views.GenericModelMixin" class="doc doc-heading">
            <code>GenericModelMixin</code>


</h4>


    <div class="doc doc-contents ">


        <p>A mixin providing the common functionality for all the views working
with <code>generic</code> models - that is models that are accessed via the
contenttype framework (using <code>app_label.model</code>).
It sets the <code>.model</code> of the view and generates a list of possible template
names (based on the MRO of the model).
If the view has a <code>permission_action_required</code> attribute, this is used
to set the permission required to access the view for this specific model.</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/generic/views.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">GenericModelMixin</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A mixin providing the common functionality for all the views working</span>
<span class="sd">    with `generic` models - that is models that are accessed via the</span>
<span class="sd">    contenttype framework (using `app_label.model`).</span>
<span class="sd">    It sets the `.model` of the view and generates a list of possible template</span>
<span class="sd">    names (based on the MRO of the model).</span>
<span class="sd">    If the view has a `permission_action_required` attribute, this is used</span>
<span class="sd">    to set the permission required to access the view for this specific model.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">contenttype</span> <span class="o">:=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;contenttype&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">contenttype</span><span class="o">.</span><span class="n">model_class</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">queryset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_template_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">template_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="nb">super</span><span class="p">(),</span> <span class="s2">&quot;get_template_names&quot;</span><span class="p">):</span>
            <span class="c1"># Some parent classes come with custom template_names,</span>
            <span class="c1"># some need a `.template_name` attribute set. For the</span>
            <span class="c1"># latter ones we handle the missing `.template_name`</span>
            <span class="c1"># gracefully</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">template_names</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_template_names</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">ImproperlyConfigured</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="n">suffix</span> <span class="o">=</span> <span class="s2">&quot;.html&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;template_name_suffix&quot;</span><span class="p">):</span>
            <span class="n">suffix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_name_suffix</span> <span class="o">+</span> <span class="s2">&quot;.html&quot;</span>
        <span class="n">additional_templates</span> <span class="o">=</span> <span class="n">template_names_via_mro</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="n">suffix</span><span class="p">)</span>
        <span class="n">template_names</span> <span class="o">+=</span> <span class="nb">filter</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">template</span><span class="p">:</span> <span class="n">template</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">template_names</span><span class="p">,</span> <span class="n">additional_templates</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">template_names</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="apis_core.generic.views.GenericModelPermissionRequiredMixin" class="doc doc-heading">
            <code>GenericModelPermissionRequiredMixin</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="django.contrib.auth.mixins.PermissionRequiredMixin">PermissionRequiredMixin</span></code></p>


        <p>Verify that the current user has the required permission for this model.
The model overrides the <code>PermissionRequiredMixin.get_permission_required</code>
method to generate the required permission name on the fly, based on a
verb (<code>permission_action_required</code>) and the model this view act upon.
This allows us to set <code>permission_action_required</code> simply to <code>add</code>, or
<code>view</code> and reuse the mixin for views that work with different models.
In addition, for the views that have <code>permission_action_required</code> set to
<code>view</code>, it check if there is the global setting <code>APIS_ANON_VIEWS_ALLOWED</code>
set to <code>True</code>, which permits anonymouse users access to the view.</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/generic/views.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">GenericModelPermissionRequiredMixin</span><span class="p">(</span><span class="n">PermissionRequiredMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Verify that the current user has the required permission for this model.</span>
<span class="sd">    The model overrides the `PermissionRequiredMixin.get_permission_required`</span>
<span class="sd">    method to generate the required permission name on the fly, based on a</span>
<span class="sd">    verb (`permission_action_required`) and the model this view act upon.</span>
<span class="sd">    This allows us to set `permission_action_required` simply to `add`, or</span>
<span class="sd">    `view` and reuse the mixin for views that work with different models.</span>
<span class="sd">    In addition, for the views that have `permission_action_required` set to</span>
<span class="sd">    `view`, it check if there is the global setting `APIS_ANON_VIEWS_ALLOWED`</span>
<span class="sd">    set to `True`, which permits anonymouse users access to the view.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_permission_required</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ImproperlyConfigured</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> is missing the model attribute&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;permission_action_required&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;view&quot;</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span>
            <span class="n">settings</span><span class="p">,</span> <span class="s2">&quot;APIS_ANON_VIEWS_ALLOWED&quot;</span><span class="p">,</span> <span class="kc">False</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;permission_action_required&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">permission_fullname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">permission_action_required</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)]</span>
        <span class="k">return</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="apis_core.generic.views.List" class="doc doc-heading">
            <code>List</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GenericModelMixin (apis_core.generic.views.GenericModelMixin)" href="#apis_core.generic.views.GenericModelMixin">GenericModelMixin</a></code>, <code><a class="autorefs autorefs-internal" title="GenericModelPermissionRequiredMixin (apis_core.generic.views.GenericModelPermissionRequiredMixin)" href="#apis_core.generic.views.GenericModelPermissionRequiredMixin">GenericModelPermissionRequiredMixin</a></code>, <code><span title="django_tables2.export.views.ExportMixin">ExportMixin</span></code>, <code><span title="django_tables2.SingleTableMixin">SingleTableMixin</span></code>, <code><span title="django_filters.views.FilterView">FilterView</span></code></p>


        <p>List view for a generic model.
Access requires the <code>&lt;model&gt;_view</code> permission.
It is based on django-filters FilterView and django-tables SingleTableMixin.
The table class is overridden by the first match from
the <code>first_member_match</code> helper.
The filterset class is overridden by the first match from
the <code>first_member_match</code> helper.
The queryset is overridden by the first match from
the <code>first_member_match</code> helper.</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/generic/views.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">List</span><span class="p">(</span>
    <span class="n">GenericModelMixin</span><span class="p">,</span>
    <span class="n">GenericModelPermissionRequiredMixin</span><span class="p">,</span>
    <span class="n">ExportMixin</span><span class="p">,</span>
    <span class="n">SingleTableMixin</span><span class="p">,</span>
    <span class="n">FilterView</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    List view for a generic model.</span>
<span class="sd">    Access requires the `&lt;model&gt;_view` permission.</span>
<span class="sd">    It is based on django-filters FilterView and django-tables SingleTableMixin.</span>
<span class="sd">    The table class is overridden by the first match from</span>
<span class="sd">    the `first_member_match` helper.</span>
<span class="sd">    The filterset class is overridden by the first match from</span>
<span class="sd">    the `first_member_match` helper.</span>
<span class="sd">    The queryset is overridden by the first match from</span>
<span class="sd">    the `first_member_match` helper.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">template_name_suffix</span> <span class="o">=</span> <span class="s2">&quot;_list&quot;</span>
    <span class="n">permission_action_required</span> <span class="o">=</span> <span class="s2">&quot;view&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_table_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">table_modules</span> <span class="o">=</span> <span class="n">module_paths</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;tables&quot;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;Table&quot;</span><span class="p">)</span>
        <span class="n">table_class</span> <span class="o">=</span> <span class="n">first_member_match</span><span class="p">(</span><span class="n">table_modules</span><span class="p">,</span> <span class="n">GenericTable</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">table_factory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">table_class</span><span class="p">)</span>

    <span class="n">export_formats</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s2">&quot;EXPORT_FORMATS&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;csv&quot;</span><span class="p">,</span> <span class="s2">&quot;json&quot;</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_export_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extension</span><span class="p">):</span>
        <span class="n">table_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_table_class</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">table_class</span><span class="p">,</span> <span class="s2">&quot;export_filename&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">table_class</span><span class="o">.</span><span class="n">export_filename</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">extension</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_export_filename</span><span class="p">(</span><span class="n">extension</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_table_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_table_kwargs</span><span class="p">()</span>

        <span class="n">selected_columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s2">&quot;choices-columns&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">modelfields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_fields</span><span class="p">()</span>
        <span class="c1"># if the form was submitted, we look at the selected</span>
        <span class="c1"># columns and exclude all columns that are not part of that list</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span> <span class="ow">and</span> <span class="s2">&quot;choices-columns&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">:</span>
            <span class="n">columns_exclude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_filterset_class</span><span class="p">()</span><span class="o">.</span><span class="n">Meta</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">columns_exclude</span>
            <span class="n">other_columns</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">name</span> <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_columns_choices</span><span class="p">(</span><span class="n">columns_exclude</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;exclude&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">field</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">other_columns</span> <span class="k">if</span> <span class="n">field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">selected_columns</span>
            <span class="p">]</span>

        <span class="c1"># now we look at the selected columns and</span>
        <span class="c1"># add all modelfields and annotated fields that</span>
        <span class="c1"># are part of the selected columns to the extra_columns</span>
        <span class="n">annotationfields</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">object_list</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">annotations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># we have to use copy, so we don&#39;t edit the original field</span>
            <span class="n">fake_field</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;field&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">output_field</span><span class="p">))</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">fake_field</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
            <span class="n">annotationfields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fake_field</span><span class="p">)</span>
        <span class="n">extra_fields</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">filter</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">selected_columns</span><span class="p">,</span>
                <span class="n">modelfields</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">annotationfields</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;extra_columns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">library</span><span class="o">.</span><span class="n">column_for_field</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">accessor</span><span class="o">=</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">extra_fields</span>
            <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_table_class</span><span class="p">()</span><span class="o">.</span><span class="n">base_columns</span>
        <span class="p">]</span>

        <span class="k">return</span> <span class="n">kwargs</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_filterset_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">filterset_modules</span> <span class="o">=</span> <span class="n">module_paths</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;filtersets&quot;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;FilterSet&quot;</span>
        <span class="p">)</span>
        <span class="n">filterset_class</span> <span class="o">=</span> <span class="n">first_member_match</span><span class="p">(</span><span class="n">filterset_modules</span><span class="p">,</span> <span class="n">GenericFilterSet</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">filterset_factory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">filterset_class</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_columns_choices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">columns_exclude</span><span class="p">):</span>
        <span class="c1"># lets start with the custom table fields</span>
        <span class="n">choices</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">key</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">capfirst</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">or</span> <span class="n">key</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s2">&quot;Nameless column&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_table</span><span class="p">()</span><span class="o">.</span><span class="n">columns</span>
        <span class="p">}</span>
        <span class="c1"># then add the model fields, but only the ones</span>
        <span class="c1"># that are not automatically created (parent keys)</span>
        <span class="c1"># and not the m2m relations and not any that are</span>
        <span class="c1"># already part of the choices</span>
        <span class="n">choices</span> <span class="o">|=</span> <span class="p">{</span>
            <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">pretty_name</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="s2">&quot;verbose_name&quot;</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_fields</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="s2">&quot;auto_created&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">ManyToManyRel</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">choices</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="c1"># finally we add any annotated fields</span>
        <span class="n">choices</span> <span class="o">|=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">annotations</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
        <span class="c1"># now we drop all the choices that are listed in columns_exclude</span>
        <span class="n">choices</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">key</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">choices</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">columns_exclude</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">choices</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_filterset_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filterset_class</span><span class="p">):</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_filterset_kwargs</span><span class="p">(</span><span class="n">filterset_class</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;prefix&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;filterset&quot;</span>
        <span class="k">return</span> <span class="n">kwargs</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_filterset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filterset_class</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        We override the `get_filterset` method, so we can add a</span>
<span class="sd">        css class to the the selected filters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filterset</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_filterset</span><span class="p">(</span><span class="n">filterset_class</span><span class="p">)</span>

        <span class="c1"># If the filterset form contains form data</span>
        <span class="c1"># we add a CSS class to the element wrapping</span>
        <span class="c1"># that field in HTML. This CSS class can be</span>
        <span class="c1"># used to emphasize the fields that are used.</span>
        <span class="c1"># To be able to compare the fields with the form</span>
        <span class="c1"># data, we create a temporary mapping between</span>
        <span class="c1"># widget_names and fields</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">filterset</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">fields</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">widget</span><span class="p">,</span> <span class="s2">&quot;widgets_names&quot;</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">widget_name</span> <span class="ow">in</span> <span class="n">field</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">widgets_names</span><span class="p">:</span>
                    <span class="n">fields</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="n">widget_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">if</span> <span class="n">filterset</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">filterset</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span>
            <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="p">[</span><span class="n">param</span> <span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">value</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">fieldname</span> <span class="o">:=</span> <span class="n">fields</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">filterset</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">helper</span><span class="p">[</span><span class="n">fieldname</span><span class="p">]</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
                        <span class="n">Field</span><span class="p">,</span> <span class="n">wrapper_class</span><span class="o">=</span><span class="s2">&quot;filter-input-selected&quot;</span>
                    <span class="p">)</span>

        <span class="k">return</span> <span class="n">filterset</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">queryset_methods</span> <span class="o">=</span> <span class="n">module_paths</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;querysets&quot;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;ListViewQueryset&quot;</span>
        <span class="p">)</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">first_member_match</span><span class="p">(</span><span class="n">queryset_methods</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">queryset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_table_pagination</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Override `get_table_pagination` from the tables2 TableMixinBase,</span>
<span class="sd">        so we can set the table_pagination value as attribute of the table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_pagination</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="s2">&quot;table_pagination&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_table_pagination</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;table&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">filterset</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;filter&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">table</span> <span class="ow">and</span> <span class="n">filterset</span><span class="p">:</span>
            <span class="n">columns_exclude</span> <span class="o">=</span> <span class="n">filterset</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">columns_exclude</span>
            <span class="n">initial_columns</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">col</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">columns_exclude</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="n">choices</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_columns_choices</span><span class="p">(</span><span class="n">columns_exclude</span><span class="o">=</span><span class="n">columns_exclude</span><span class="p">):</span>
                <span class="n">context</span><span class="p">[</span><span class="s2">&quot;columns_selector&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ColumnsSelectorForm</span><span class="p">(</span>
                    <span class="n">choices</span><span class="o">=</span><span class="n">choices</span><span class="p">,</span>
                    <span class="n">initial</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;choices&quot;</span><span class="p">:</span> <span class="n">initial_columns</span><span class="p">},</span>
                    <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;choices&quot;</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">context</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="apis_core.generic.views.List.get_filterset" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_filterset</span><span class="p">(</span><span class="n">filterset_class</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>We override the <code>get_filterset</code> method, so we can add a
css class to the the selected filters</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/generic/views.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_filterset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filterset_class</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    We override the `get_filterset` method, so we can add a</span>
<span class="sd">    css class to the the selected filters</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filterset</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_filterset</span><span class="p">(</span><span class="n">filterset_class</span><span class="p">)</span>

    <span class="c1"># If the filterset form contains form data</span>
    <span class="c1"># we add a CSS class to the element wrapping</span>
    <span class="c1"># that field in HTML. This CSS class can be</span>
    <span class="c1"># used to emphasize the fields that are used.</span>
    <span class="c1"># To be able to compare the fields with the form</span>
    <span class="c1"># data, we create a temporary mapping between</span>
    <span class="c1"># widget_names and fields</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">filterset</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">fields</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">widget</span><span class="p">,</span> <span class="s2">&quot;widgets_names&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">widget_name</span> <span class="ow">in</span> <span class="n">field</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">widgets_names</span><span class="p">:</span>
                <span class="n">fields</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="n">widget_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
    <span class="k">if</span> <span class="n">filterset</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">filterset</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="p">[</span><span class="n">param</span> <span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">value</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">fieldname</span> <span class="o">:=</span> <span class="n">fields</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">filterset</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">helper</span><span class="p">[</span><span class="n">fieldname</span><span class="p">]</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
                    <span class="n">Field</span><span class="p">,</span> <span class="n">wrapper_class</span><span class="o">=</span><span class="s2">&quot;filter-input-selected&quot;</span>
                <span class="p">)</span>

    <span class="k">return</span> <span class="n">filterset</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="apis_core.generic.views.List.get_table_pagination" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_table_pagination</span><span class="p">(</span><span class="n">table</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Override <code>get_table_pagination</code> from the tables2 TableMixinBase,
so we can set the table_pagination value as attribute of the table.</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/generic/views.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_table_pagination</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Override `get_table_pagination` from the tables2 TableMixinBase,</span>
<span class="sd">    so we can set the table_pagination value as attribute of the table.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">table_pagination</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="s2">&quot;table_pagination&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_table_pagination</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="apis_core.generic.views.MergeWith" class="doc doc-heading">
            <code>MergeWith</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GenericModelMixin (apis_core.generic.views.GenericModelMixin)" href="#apis_core.generic.views.GenericModelMixin">GenericModelMixin</a></code>, <code><a class="autorefs autorefs-internal" title="GenericModelPermissionRequiredMixin (apis_core.generic.views.GenericModelPermissionRequiredMixin)" href="#apis_core.generic.views.GenericModelPermissionRequiredMixin">GenericModelPermissionRequiredMixin</a></code>, <code><span title="django.views.generic.edit.FormView">FormView</span></code></p>


        <p>Generic merge view.</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/generic/views.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MergeWith</span><span class="p">(</span><span class="n">GenericModelMixin</span><span class="p">,</span> <span class="n">GenericModelPermissionRequiredMixin</span><span class="p">,</span> <span class="n">FormView</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generic merge view.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">permission_action_required</span> <span class="o">=</span> <span class="s2">&quot;change&quot;</span>
    <span class="n">form_class</span> <span class="o">=</span> <span class="n">GenericMergeWithForm</span>
    <span class="n">template_name_suffix</span> <span class="o">=</span> <span class="s2">&quot;_merge&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">other</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;otherpk&quot;</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The context consists of the two objects that are merged as well</span>
<span class="sd">        as a list of changes. Those changes are presented in the view as</span>
<span class="sd">        a table with diffs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Change</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;Change&quot;</span><span class="p">,</span> <span class="s2">&quot;field old new&quot;</span><span class="p">)</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ctx</span><span class="p">[</span><span class="s2">&quot;changes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
            <span class="n">newval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">get_field_value_after_merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">other</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
            <span class="n">ctx</span><span class="p">[</span><span class="s2">&quot;changes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">Change</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="n">newval</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="n">ctx</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span>
        <span class="n">ctx</span><span class="p">[</span><span class="s2">&quot;other&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">other</span>
        <span class="k">return</span> <span class="n">ctx</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">form_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">merge_with</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">other</span><span class="p">])</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Merged values of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">other</span><span class="si">}</span><span class="s2"> into </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">form_valid</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_success_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="apis_core.generic.views.MergeWith.get_context_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>The context consists of the two objects that are merged as well
as a list of changes. Those changes are presented in the view as
a table with diffs</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/generic/views.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The context consists of the two objects that are merged as well</span>
<span class="sd">    as a list of changes. Those changes are presented in the view as</span>
<span class="sd">    a table with diffs</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Change</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;Change&quot;</span><span class="p">,</span> <span class="s2">&quot;field old new&quot;</span><span class="p">)</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">ctx</span><span class="p">[</span><span class="s2">&quot;changes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
        <span class="n">newval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">get_field_value_after_merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">other</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
        <span class="n">ctx</span><span class="p">[</span><span class="s2">&quot;changes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">Change</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="n">newval</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="n">ctx</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span>
    <span class="n">ctx</span><span class="p">[</span><span class="s2">&quot;other&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">other</span>
    <span class="k">return</span> <span class="n">ctx</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="apis_core.generic.views.SelectMergeOrEnrich" class="doc doc-heading">
            <code>SelectMergeOrEnrich</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GenericModelMixin (apis_core.generic.views.GenericModelMixin)" href="#apis_core.generic.views.GenericModelMixin">GenericModelMixin</a></code>, <code><a class="autorefs autorefs-internal" title="GenericModelPermissionRequiredMixin (apis_core.generic.views.GenericModelPermissionRequiredMixin)" href="#apis_core.generic.views.GenericModelPermissionRequiredMixin">GenericModelPermissionRequiredMixin</a></code>, <code><span title="django.views.generic.edit.FormView">FormView</span></code></p>


        <p>This view provides a simple form that allows to select other entities (also from
external sources, if set up) and on form submit redirects to the Enrich view.</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/generic/views.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SelectMergeOrEnrich</span><span class="p">(</span>
    <span class="n">GenericModelMixin</span><span class="p">,</span> <span class="n">GenericModelPermissionRequiredMixin</span><span class="p">,</span> <span class="n">FormView</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This view provides a simple form that allows to select other entities (also from</span>
<span class="sd">    external sources, if set up) and on form submit redirects to the Enrich view.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">template_name_suffix</span> <span class="o">=</span> <span class="s2">&quot;_selectmergeorenrich&quot;</span>
    <span class="n">permission_action_required</span> <span class="o">=</span> <span class="s2">&quot;add&quot;</span>
    <span class="n">form_class</span> <span class="o">=</span> <span class="n">GenericSelectMergeOrEnrichForm</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pk&quot;</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">context</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_form_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_form_kwargs</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;content_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">kwargs</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">form_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;uri&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">uri</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span><span class="o">.</span><span class="n">get_merge_url</span><span class="p">(</span><span class="n">uri</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span><span class="o">.</span><span class="n">get_enrich_url</span><span class="p">()</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;?uri=</span><span class="si">{</span><span class="n">uri</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="apis_core.generic.views.Update" class="doc doc-heading">
            <code>Update</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GenericModelMixin (apis_core.generic.views.GenericModelMixin)" href="#apis_core.generic.views.GenericModelMixin">GenericModelMixin</a></code>, <code><a class="autorefs autorefs-internal" title="GenericModelPermissionRequiredMixin (apis_core.generic.views.GenericModelPermissionRequiredMixin)" href="#apis_core.generic.views.GenericModelPermissionRequiredMixin">GenericModelPermissionRequiredMixin</a></code>, <code><span title="django.contrib.messages.views.SuccessMessageMixin">SuccessMessageMixin</span></code>, <code><span title="django.views.generic.edit.UpdateView">UpdateView</span></code></p>


        <p>Update view for a generic model.
Access requires the <code>&lt;model&gt;_change</code> permission.
The form class is overridden by the first match from
the <code>first_member_match</code> helper.</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/generic/views.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Update</span><span class="p">(</span>
    <span class="n">GenericModelMixin</span><span class="p">,</span>
    <span class="n">GenericModelPermissionRequiredMixin</span><span class="p">,</span>
    <span class="n">SuccessMessageMixin</span><span class="p">,</span>
    <span class="n">UpdateView</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update view for a generic model.</span>
<span class="sd">    Access requires the `&lt;model&gt;_change` permission.</span>
<span class="sd">    The form class is overridden by the first match from</span>
<span class="sd">    the `first_member_match` helper.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">permission_action_required</span> <span class="o">=</span> <span class="s2">&quot;change&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_form_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">form_modules</span> <span class="o">=</span> <span class="n">module_paths</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;forms&quot;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;Form&quot;</span><span class="p">)</span>
        <span class="n">form_class</span> <span class="o">=</span> <span class="n">first_member_match</span><span class="p">(</span><span class="n">form_modules</span><span class="p">,</span> <span class="n">GenericModelForm</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">modelform_factory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">form_class</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_success_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cleaned_data</span><span class="p">):</span>
        <span class="n">message_templates</span> <span class="o">=</span> <span class="n">template_names_via_mro</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;_update_success_message.html&quot;</span>
        <span class="p">)</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">select_template</span><span class="p">(</span><span class="n">message_templates</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">({</span><span class="s2">&quot;object&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_success_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">get_update_success_url</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="apis_core.history" class="doc doc-heading">
            <code>history</code>


</h2>

    <div class="doc doc-contents ">









  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h3 id="apis_core.history.models" class="doc doc-heading">
            <code>models</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="apis_core.history.models.APISHistoricalRecords" class="doc doc-heading">
            <code>APISHistoricalRecords</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="simple_history.models.HistoricalRecords">HistoricalRecords</span></code></p>








              <details class="quote">
                <summary>Source code in <code>apis_core/history/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">APISHistoricalRecords</span><span class="p">(</span><span class="n">HistoricalRecords</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_m2m_fields_from_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="c1"># Change the original simple history function to also return m2m fields</span>
        <span class="n">m2m_fields</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span>
                    <span class="n">field</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">django</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">related_descriptors</span><span class="o">.</span><span class="n">ManyToManyDescriptor</span><span class="p">,</span>
                <span class="p">):</span>
                    <span class="n">m2m_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">field</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">field</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">AppRegistryNotReady</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">m2m_fields</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_prev_record</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the previous history record for the instance. `None` if first.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">history</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_history_manager_from_history</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">history</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">history_date__lt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history_date</span><span class="p">)</span>
            <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;history_date&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="apis_core.history.models.APISHistoricalRecords.get_prev_record" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_prev_record</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Get the previous history record for the instance. <code>None</code> if first.</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/history/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_prev_record</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the previous history record for the instance. `None` if first.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">history</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_history_manager_from_history</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">history</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">history_date__lt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history_date</span><span class="p">)</span>
        <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;history_date&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="apis_core.history.tables" class="doc doc-heading">
            <code>tables</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="apis_core.history.tables.DescriptionColumnHistory" class="doc doc-heading">
            <code>DescriptionColumnHistory</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="CustomTemplateColumn (apis_core.generic.tables.CustomTemplateColumn)" href="#apis_core.generic.tables.CustomTemplateColumn">CustomTemplateColumn</a></code></p>


        <p>A column showing a model description</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/history/tables.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DescriptionColumnHistory</span><span class="p">(</span><span class="n">CustomTemplateColumn</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A column showing a model description</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">template_name</span> <span class="o">=</span> <span class="s2">&quot;history/columns/description.html&quot;</span>
    <span class="n">orderable</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="apis_core.history.tables.OriginalIDColumn" class="doc doc-heading">
            <code>OriginalIDColumn</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="CustomTemplateColumn (apis_core.generic.tables.CustomTemplateColumn)" href="#apis_core.generic.tables.CustomTemplateColumn">CustomTemplateColumn</a></code></p>


        <p>A column showing the original id of a model instance</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/history/tables.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">OriginalIDColumn</span><span class="p">(</span><span class="n">CustomTemplateColumn</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A column showing the original id of a model instance</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">template_name</span> <span class="o">=</span> <span class="s2">&quot;history/columns/original_id.html&quot;</span>
    <span class="n">orderable</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Original ID&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="apis_core.history.tables.ResetColumn" class="doc doc-heading">
            <code>ResetColumn</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ActionColumn (apis_core.generic.tables.ActionColumn)" href="#apis_core.generic.tables.ActionColumn">ActionColumn</a></code></p>


        <p>A column showing a reset button</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/history/tables.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ResetColumn</span><span class="p">(</span><span class="n">ActionColumn</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A column showing a reset button</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">template_name</span> <span class="o">=</span> <span class="s2">&quot;history/columns/reset.html&quot;</span>
    <span class="n">permission</span> <span class="o">=</span> <span class="s2">&quot;change&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="apis_core.history.tests" class="doc doc-heading">
            <code>tests</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="apis_core.history.tests.setup_test_app" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setup_test_app</span><span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Setup a Django test app for the provided package to allow test models
tables to be created if the containing app has migrations.</p>
<p>This function should be called from app.tests <strong>init</strong> module and pass
along <strong>package</strong>.</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/history/tests/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">setup_test_app</span><span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Setup a Django test app for the provided package to allow test models</span>
<span class="sd">    tables to be created if the containing app has migrations.</span>

<span class="sd">    This function should be called from app.tests __init__ module and pass</span>
<span class="sd">    along __package__.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">app_config</span> <span class="o">=</span> <span class="n">AppConfig</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">package</span><span class="p">)</span>
    <span class="n">app_config</span><span class="o">.</span><span class="n">apps</span> <span class="o">=</span> <span class="n">apps</span>
    <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">containing_app_config</span> <span class="o">=</span> <span class="n">apps</span><span class="o">.</span><span class="n">get_containing_app_config</span><span class="p">(</span><span class="n">package</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">containing_app_config</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s2">_tests&quot;</span>
    <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">apps</span><span class="o">.</span><span class="n">app_configs</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There&#39;s already an app registered with the &#39;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">&#39; label.&quot;</span><span class="p">)</span>
    <span class="n">app_config</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
    <span class="n">apps</span><span class="o">.</span><span class="n">app_configs</span><span class="p">[</span><span class="n">app_config</span><span class="o">.</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">app_config</span>
    <span class="n">app_config</span><span class="o">.</span><span class="n">import_models</span><span class="p">()</span>
    <span class="n">apps</span><span class="o">.</span><span class="n">clear_cache</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>


<div class="doc doc-object doc-module">



<h4 id="apis_core.history.tests.test_history" class="doc doc-heading">
            <code>test_history</code>


</h4>

    <div class="doc doc-contents ">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h5 id="apis_core.history.tests.test_history.TestHistory" class="doc doc-heading">
            <code>TestHistory</code>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="object">object</span></code></p>








              <details class="quote">
                <summary>Source code in <code>apis_core/history/tests/test_history.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">django_db</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TestHistory</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_history_date_setter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test the date setter of the VersionMixin.&quot;&quot;&quot;</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
        <span class="n">person</span><span class="o">.</span><span class="n">_history_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">1970</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astimezone</span><span class="p">()</span>
        <span class="n">person</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">person</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">last</span><span class="p">()</span><span class="o">.</span><span class="n">history_date</span>
            <span class="o">==</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">1970</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astimezone</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_history</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests the simple version of attributes changed on a models instance.&quot;&quot;&quot;</span>
        <span class="n">first_name</span> <span class="o">=</span> <span class="n">fake</span><span class="o">.</span><span class="n">first_name</span><span class="p">()</span>
        <span class="n">last_name</span> <span class="o">=</span> <span class="n">fake</span><span class="o">.</span><span class="n">last_name</span><span class="p">()</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">first_name</span><span class="o">=</span><span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="o">=</span><span class="n">last_name</span><span class="p">)</span>
        <span class="n">new_first_name</span> <span class="o">=</span> <span class="n">fake</span><span class="o">.</span><span class="n">first_name</span><span class="p">()</span>
        <span class="n">person</span><span class="o">.</span><span class="n">first_name</span> <span class="o">=</span> <span class="n">new_first_name</span>
        <span class="n">person</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">person</span><span class="o">.</span><span class="n">first_name</span> <span class="o">==</span> <span class="n">new_first_name</span>
        <span class="n">person_history</span> <span class="o">=</span> <span class="n">person</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">person_history</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="k">assert</span> <span class="n">person</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">most_recent</span><span class="p">()</span><span class="o">.</span><span class="n">first_name</span> <span class="o">==</span> <span class="n">new_first_name</span>
        <span class="k">assert</span> <span class="n">person</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">earliest</span><span class="p">()</span><span class="o">.</span><span class="n">first_name</span> <span class="o">==</span> <span class="n">first_name</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_history_delete_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests the deletion of an entry.&quot;&quot;&quot;</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
        <span class="n">person</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">all</span><span class="p">())</span> <span class="o">==</span> <span class="mi">2</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_m2m_save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test if m2m profession is saved correctly.&quot;&quot;&quot;</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
        <span class="n">person_history</span> <span class="o">=</span> <span class="n">person</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">person_history</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="n">profession</span> <span class="o">=</span> <span class="n">Profession</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">fake</span><span class="o">.</span><span class="n">job</span><span class="p">())</span>
        <span class="n">person</span><span class="o">.</span><span class="n">profession</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">profession</span><span class="p">)</span>
        <span class="n">person</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">profession</span><span class="o">.</span><span class="n">all</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">latest</span><span class="p">()</span><span class="o">.</span><span class="n">profession</span><span class="o">.</span><span class="n">all</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">earliest</span><span class="p">()</span><span class="o">.</span><span class="n">profession</span><span class="o">.</span><span class="n">all</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_history_date</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that history is set correctly when not manually set.&quot;&quot;&quot;</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
        <span class="n">person</span><span class="o">.</span><span class="n">first_name</span> <span class="o">=</span> <span class="n">fake</span><span class="o">.</span><span class="n">first_name</span><span class="p">()</span>
        <span class="n">person</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">person</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">earliest</span><span class="p">()</span><span class="o">.</span><span class="n">history_date</span>
            <span class="o">&lt;</span> <span class="n">person</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">latest</span><span class="p">()</span><span class="o">.</span><span class="n">history_date</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_relation_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
        <span class="n">place</span> <span class="o">=</span> <span class="n">Place</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">get_history_data</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="n">ppr</span> <span class="o">=</span> <span class="n">PersonPlaceRelation</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_between_instances</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="n">place</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">get_history_data</span><span class="p">())</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="n">place</span> <span class="o">=</span> <span class="n">Place</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
        <span class="n">ppr</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">place</span>
        <span class="n">ppr</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">get_history_data</span><span class="p">())</span> <span class="o">==</span> <span class="mi">3</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h6 id="apis_core.history.tests.test_history.TestHistory.test_history" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">test_history</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Tests the simple version of attributes changed on a models instance.</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/history/tests/test_history.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_history</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests the simple version of attributes changed on a models instance.&quot;&quot;&quot;</span>
    <span class="n">first_name</span> <span class="o">=</span> <span class="n">fake</span><span class="o">.</span><span class="n">first_name</span><span class="p">()</span>
    <span class="n">last_name</span> <span class="o">=</span> <span class="n">fake</span><span class="o">.</span><span class="n">last_name</span><span class="p">()</span>
    <span class="n">person</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">first_name</span><span class="o">=</span><span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="o">=</span><span class="n">last_name</span><span class="p">)</span>
    <span class="n">new_first_name</span> <span class="o">=</span> <span class="n">fake</span><span class="o">.</span><span class="n">first_name</span><span class="p">()</span>
    <span class="n">person</span><span class="o">.</span><span class="n">first_name</span> <span class="o">=</span> <span class="n">new_first_name</span>
    <span class="n">person</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">person</span><span class="o">.</span><span class="n">first_name</span> <span class="o">==</span> <span class="n">new_first_name</span>
    <span class="n">person_history</span> <span class="o">=</span> <span class="n">person</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">person_history</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">person</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">most_recent</span><span class="p">()</span><span class="o">.</span><span class="n">first_name</span> <span class="o">==</span> <span class="n">new_first_name</span>
    <span class="k">assert</span> <span class="n">person</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">earliest</span><span class="p">()</span><span class="o">.</span><span class="n">first_name</span> <span class="o">==</span> <span class="n">first_name</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="apis_core.history.tests.test_history.TestHistory.test_history_date" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">test_history_date</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test that history is set correctly when not manually set.</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/history/tests/test_history.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_history_date</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that history is set correctly when not manually set.&quot;&quot;&quot;</span>
    <span class="n">person</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
    <span class="n">person</span><span class="o">.</span><span class="n">first_name</span> <span class="o">=</span> <span class="n">fake</span><span class="o">.</span><span class="n">first_name</span><span class="p">()</span>
    <span class="n">person</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">person</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">earliest</span><span class="p">()</span><span class="o">.</span><span class="n">history_date</span>
        <span class="o">&lt;</span> <span class="n">person</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">latest</span><span class="p">()</span><span class="o">.</span><span class="n">history_date</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="apis_core.history.tests.test_history.TestHistory.test_history_date_setter" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">test_history_date_setter</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test the date setter of the VersionMixin.</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/history/tests/test_history.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_history_date_setter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test the date setter of the VersionMixin.&quot;&quot;&quot;</span>
    <span class="n">person</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
    <span class="n">person</span><span class="o">.</span><span class="n">_history_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">1970</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astimezone</span><span class="p">()</span>
    <span class="n">person</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">person</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">last</span><span class="p">()</span><span class="o">.</span><span class="n">history_date</span>
        <span class="o">==</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">1970</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astimezone</span><span class="p">()</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="apis_core.history.tests.test_history.TestHistory.test_history_delete_entry" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">test_history_delete_entry</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Tests the deletion of an entry.</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/history/tests/test_history.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_history_delete_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests the deletion of an entry.&quot;&quot;&quot;</span>
    <span class="n">person</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
    <span class="n">person</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">all</span><span class="p">())</span> <span class="o">==</span> <span class="mi">2</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="apis_core.history.tests.test_history.TestHistory.test_m2m_save" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">test_m2m_save</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test if m2m profession is saved correctly.</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/history/tests/test_history.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_m2m_save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test if m2m profession is saved correctly.&quot;&quot;&quot;</span>
    <span class="n">person</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
    <span class="n">person_history</span> <span class="o">=</span> <span class="n">person</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">person_history</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="n">profession</span> <span class="o">=</span> <span class="n">Profession</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">fake</span><span class="o">.</span><span class="n">job</span><span class="p">())</span>
    <span class="n">person</span><span class="o">.</span><span class="n">profession</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">profession</span><span class="p">)</span>
    <span class="n">person</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">profession</span><span class="o">.</span><span class="n">all</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">latest</span><span class="p">()</span><span class="o">.</span><span class="n">profession</span><span class="o">.</span><span class="n">all</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">earliest</span><span class="p">()</span><span class="o">.</span><span class="n">profession</span><span class="o">.</span><span class="n">all</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="apis_core.history.views" class="doc doc-heading">
            <code>views</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="apis_core.history.views.HistoryReset" class="doc doc-heading">
            <code>HistoryReset</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GenericModelMixin (apis_core.generic.views.GenericModelMixin)" href="#apis_core.generic.views.GenericModelMixin">GenericModelMixin</a></code>, <code><a class="autorefs autorefs-internal" title="GenericModelPermissionRequiredMixin (apis_core.generic.views.GenericModelPermissionRequiredMixin)" href="#apis_core.generic.views.GenericModelPermissionRequiredMixin">GenericModelPermissionRequiredMixin</a></code>, <code><span title="django.views.generic.detail.BaseDetailView">BaseDetailView</span></code>, <code><span title="django.views.generic.edit.FormView">FormView</span></code></p>


        <p>This view allows to reset a model instance to an earlier version.
The <code>GenericModel</code> this view acts upon IS the historical model, so the permission
required to access the view refers to the versioned model. For example for the
<code>Person</code> model, this view acts upon the <code>VersionPerson</code> model and therefore the
permission required is the <code>.versionperson_view</code> permission.</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/history/views.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">HistoryReset</span><span class="p">(</span>
    <span class="n">GenericModelMixin</span><span class="p">,</span> <span class="n">GenericModelPermissionRequiredMixin</span><span class="p">,</span> <span class="n">BaseDetailView</span><span class="p">,</span> <span class="n">FormView</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This view allows to reset a model instance to an earlier version.</span>
<span class="sd">    The `GenericModel` this view acts upon IS the historical model, so the permission</span>
<span class="sd">    required to access the view refers to the versioned model. For example for the</span>
<span class="sd">    `Person` model, this view acts upon the `VersionPerson` model and therefore the</span>
<span class="sd">    permission required is the `.versionperson_view` permission.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">form_class</span> <span class="o">=</span> <span class="n">Form</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s2">&quot;history/reset.html&quot;</span>
    <span class="n">permission_action_required</span> <span class="o">=</span> <span class="s2">&quot;change&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">form_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">form_valid</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_success_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">get_history_url</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="apis_core.history.views.HistoryView" class="doc doc-heading">
            <code>HistoryView</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GenericModelMixin (apis_core.generic.views.GenericModelMixin)" href="#apis_core.generic.views.GenericModelMixin">GenericModelMixin</a></code>, <code><a class="autorefs autorefs-internal" title="GenericModelPermissionRequiredMixin (apis_core.generic.views.GenericModelPermissionRequiredMixin)" href="#apis_core.generic.views.GenericModelPermissionRequiredMixin">GenericModelPermissionRequiredMixin</a></code>, <code><span title="django_tables2.SingleTableMixin">SingleTableMixin</span></code>, <code><span title="django.views.generic.detail.DetailView">DetailView</span></code></p>


        <p>This view lists the historical data of one object.
The <code>GenericModel</code> this view acts upon is NOT the historical model, but the base model.
I.e. it is not the <code>VersionPerson</code>, but the <code>Person</code>. Therefore the permission required
to access this view refers to the <code>Person</code> model, NOT the <code>VersionPerson</code> model!</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/history/views.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">HistoryView</span><span class="p">(</span>
    <span class="n">GenericModelMixin</span><span class="p">,</span> <span class="n">GenericModelPermissionRequiredMixin</span><span class="p">,</span> <span class="n">SingleTableMixin</span><span class="p">,</span> <span class="n">DetailView</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This view lists the historical data of one object.</span>
<span class="sd">    The `GenericModel` this view acts upon is NOT the historical model, but the base model.</span>
<span class="sd">    I.e. it is not the `VersionPerson`, but the `Person`. Therefore the permission required</span>
<span class="sd">    to access this view refers to the `Person` model, NOT the `VersionPerson` model!</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">template_name</span> <span class="o">=</span> <span class="s2">&quot;history/history.html&quot;</span>
    <span class="n">permission_action_required</span> <span class="o">=</span> <span class="s2">&quot;view&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_table_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">table_modules</span> <span class="o">=</span> <span class="n">module_paths</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;tables&quot;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;HistoryTable&quot;</span><span class="p">)</span>
        <span class="n">table_class</span> <span class="o">=</span> <span class="n">first_member_match</span><span class="p">(</span><span class="n">table_modules</span><span class="p">,</span> <span class="n">HistoryGenericTable</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">table_factory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">table_class</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_table_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span><span class="o">.</span><span class="n">get_history_data</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="apis_core.relations" class="doc doc-heading">
            <code>relations</code>


</h2>

    <div class="doc doc-contents ">









  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h3 id="apis_core.relations.filtersets" class="doc doc-heading">
            <code>filtersets</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="apis_core.relations.filtersets.EntityFilter" class="doc doc-heading">
            <code>EntityFilter</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="django_filters.CharFilter">CharFilter</span></code></p>


        <p>Custom CharFilter that uses the generate_search_filter helper
to search in all instances inheriting from RootObject and then
uses those results to only list relations that point to one of
the results.</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/relations/filtersets.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">EntityFilter</span><span class="p">(</span><span class="n">CharFilter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Custom CharFilter that uses the generate_search_filter helper</span>
<span class="sd">    to search in all instances inheriting from RootObject and then</span>
<span class="sd">    uses those results to only list relations that point to one of</span>
<span class="sd">    the results.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extra</span><span class="p">[</span><span class="s2">&quot;help_text&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Searches in subclasses of RootObject&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_search_all_entities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">Q</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">content_type</span> <span class="ow">in</span> <span class="n">get_all_relation_subj_and_obj</span><span class="p">():</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">content_type</span><span class="o">.</span><span class="n">model</span>
            <span class="n">q</span> <span class="o">|=</span> <span class="n">Q</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">__isnull&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span> <span class="o">&amp;</span> <span class="n">generate_search_filter</span><span class="p">(</span>
                <span class="n">content_type</span><span class="o">.</span><span class="n">model_class</span><span class="p">(),</span> <span class="n">value</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">__&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">RootObject</span><span class="o">.</span><span class="n">objects_inheritance</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s2">&quot;pk&quot;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qs</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">all_entities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_all_entities</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">qs</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">field_name</span><span class="si">}</span><span class="s2">_object_id__in&quot;</span><span class="p">:</span> <span class="n">all_entities</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">qs</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="apis_core.relations.filtersets.RelationFilterSet" class="doc doc-heading">
            <code>RelationFilterSet</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GenericFilterSet (apis_core.generic.filtersets.GenericFilterSet)" href="#apis_core.generic.filtersets.GenericFilterSet">GenericFilterSet</a></code></p>


        <p>Override the GenericFilterSet that is created for the Relation model.
It does not really make sense to filter for content type id and object id,
so we exclude those.
Instead, we add a multiple choice filter for object and subject class, that
only lists those choices that actually exists (meaning the classes that are
actually set as subj or obj in some relation).
Additionaly, we add a search filter, that searches in instances connected
to relations (this does only work for instances inheriting from RootObject).</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/relations/filtersets.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RelationFilterSet</span><span class="p">(</span><span class="n">GenericFilterSet</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Override the GenericFilterSet that is created for the Relation model.</span>
<span class="sd">    It does not really make sense to filter for content type id and object id,</span>
<span class="sd">    so we exclude those.</span>
<span class="sd">    Instead, we add a multiple choice filter for object and subject class, that</span>
<span class="sd">    only lists those choices that actually exists (meaning the classes that are</span>
<span class="sd">    actually set as subj or obj in some relation).</span>
<span class="sd">    Additionaly, we add a search filter, that searches in instances connected</span>
<span class="sd">    to relations (this does only work for instances inheriting from RootObject).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">subj_search</span> <span class="o">=</span> <span class="n">EntityFilter</span><span class="p">(</span>
        <span class="n">field_name</span><span class="o">=</span><span class="s2">&quot;subj&quot;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Subject search&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">obj_search</span> <span class="o">=</span> <span class="n">EntityFilter</span><span class="p">(</span>
        <span class="n">field_name</span><span class="o">=</span><span class="s2">&quot;obj&quot;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Object search&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">exclude</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;subj_object_id&quot;</span><span class="p">,</span>
            <span class="s2">&quot;subj_content_type&quot;</span><span class="p">,</span>
            <span class="s2">&quot;obj_object_id&quot;</span><span class="p">,</span>
            <span class="s2">&quot;obj_content_type&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">RelationFilterSetForm</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">model</span> <span class="o">:=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Meta</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="n">Relation</span> <span class="ow">and</span> <span class="s2">&quot;collections&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="s2">&quot;collections&quot;</span><span class="p">]</span>
            <span class="n">all_models</span> <span class="o">=</span> <span class="p">[</span><span class="n">ct</span><span class="o">.</span><span class="n">model_class</span><span class="p">()</span> <span class="k">for</span> <span class="n">ct</span> <span class="ow">in</span> <span class="n">get_all_relation_subj_and_obj</span><span class="p">()]</span>
            <span class="n">subj_models</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;subj_model&quot;</span><span class="p">,</span> <span class="n">all_models</span><span class="p">)</span>
            <span class="n">obj_models</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;obj_model&quot;</span><span class="p">,</span> <span class="n">all_models</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subj_models</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="s2">&quot;subj_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SubjObjClassFilter</span><span class="p">(</span>
                    <span class="n">field_name</span><span class="o">=</span><span class="s2">&quot;subj&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Subject class&quot;</span><span class="p">,</span> <span class="n">models</span><span class="o">=</span><span class="n">subj_models</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj_models</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="s2">&quot;obj_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SubjObjClassFilter</span><span class="p">(</span>
                    <span class="n">field_name</span><span class="o">=</span><span class="s2">&quot;obj&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Object Class&quot;</span><span class="p">,</span> <span class="n">models</span><span class="o">=</span><span class="n">obj_models</span>
                <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="apis_core.relations.filtersets.SubjObjClassFilter" class="doc doc-heading">
            <code>SubjObjClassFilter</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="django_filters.MultipleChoiceFilter">MultipleChoiceFilter</span></code></p>


        <p>Custom MultipleChoiceFilter
* it lists model classes as choices, that are in some way
  connected to a relation, either as subj or as obj
* it filters relations by the content types of the connected
  subjects and objects</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/relations/filtersets.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SubjObjClassFilter</span><span class="p">(</span><span class="n">MultipleChoiceFilter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Custom MultipleChoiceFilter</span>
<span class="sd">    * it lists model classes as choices, that are in some way</span>
<span class="sd">      connected to a relation, either as subj or as obj</span>
<span class="sd">    * it filters relations by the content types of the connected</span>
<span class="sd">      subjects and objects</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">models</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">content_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span> <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extra</span><span class="p">[</span><span class="s2">&quot;choices&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">item</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">content_types</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qs</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">):</span>
        <span class="c1"># value is the list of contenttypes ids</span>
        <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">qs</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Q</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">field_name</span><span class="si">}</span><span class="s2">_content_type__in&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">}))</span>
        <span class="k">return</span> <span class="n">qs</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="apis_core.relations.forms" class="doc doc-heading">
            <code>forms</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="apis_core.relations.forms.RelationFilterSetForm" class="doc doc-heading">
            <code>RelationFilterSetForm</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GenericFilterSetForm (apis_core.generic.forms.GenericFilterSetForm)" href="#apis_core.generic.forms.GenericFilterSetForm">GenericFilterSetForm</a></code></p>


        <p>FilterSet form for relations based on GenericFilterSetForm.
Excludes <code>relation_ptr</code> from the columns selector</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/relations/forms/__init__.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RelationFilterSetForm</span><span class="p">(</span><span class="n">GenericFilterSetForm</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    FilterSet form for relations based on GenericFilterSetForm.</span>
<span class="sd">    Excludes `relation_ptr` from the columns selector</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">columns_exclude</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;relation_ptr&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="apis_core.relations.forms.RelationForm" class="doc doc-heading">
            <code>RelationForm</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GenericModelForm (apis_core.generic.forms.GenericModelForm)" href="#apis_core.generic.forms.GenericModelForm">GenericModelForm</a></code></p>


        <p>This form overrides generic form for relation editing.
Relations have generic relations to subj and obj, but we
hide those ForeignKey form fields and instead show
autocomplete choices fields.
In addition, one can pass a hx_post_route argument to the
form to make the form set the <code>hx-post</code> attribute to the
given value.
We also pass a <code>reverse</code> boolean, wich gets passed on
to the htmx POST endpoint using url parameters (the endpoint
can then select the success_url based on the <code>reverse</code> state).</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/relations/forms/__init__.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RelationForm</span><span class="p">(</span><span class="n">GenericModelForm</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This form overrides generic form for relation editing.</span>
<span class="sd">    Relations have generic relations to subj and obj, but we</span>
<span class="sd">    hide those ForeignKey form fields and instead show</span>
<span class="sd">    autocomplete choices fields.</span>
<span class="sd">    In addition, one can pass a hx_post_route argument to the</span>
<span class="sd">    form to make the form set the `hx-post` attribute to the</span>
<span class="sd">    given value.</span>
<span class="sd">    We also pass a `reverse` boolean, wich gets passed on</span>
<span class="sd">    to the htmx POST endpoint using url parameters (the endpoint</span>
<span class="sd">    can then select the success_url based on the `reverse` state).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Media</span><span class="p">:</span>
        <span class="n">js</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;js/relation_dialog.js&quot;</span><span class="p">]</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="s2">&quot;__all__&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the form and replace `subj_object_id` and</span>
<span class="sd">        `obj_object_id` fields with a autocomplete widget.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;params&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">subj_model</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Meta</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;subj_model&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">obj_model</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Meta</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;obj_model&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">subj_model</span><span class="p">:</span>
            <span class="n">subj_ct</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">subj_model</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;initial&quot;</span><span class="p">][</span><span class="s2">&quot;subj_content_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subj_ct</span>
        <span class="k">if</span> <span class="n">obj_model</span><span class="p">:</span>
            <span class="n">obj_ct</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">obj_model</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;initial&quot;</span><span class="p">][</span><span class="s2">&quot;obj_content_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj_ct</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">subj_model</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;subj_content_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">required</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;subj_content_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">HiddenInput</span><span class="p">()</span>
            <span class="c1"># if we already now the id of the subject, hide the subject input</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;initial&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;subj_object_id&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;subj_object_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">HiddenInput</span><span class="p">()</span>
            <span class="c1"># otherwise create an autocomplete to select the subject</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;subj_object_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ModelImportChoiceField</span><span class="p">(</span>
                    <span class="n">queryset</span><span class="o">=</span><span class="n">subj_model</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="n">label</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Subject&quot;</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;subj_object_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">ApisListSelect2</span><span class="p">(</span>
                    <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;data-html&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
                    <span class="n">url</span><span class="o">=</span><span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;apis_core:generic:autocomplete&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">subj_ct</span><span class="p">])</span>
                    <span class="o">+</span> <span class="s2">&quot;?create=True&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;subj_object_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">choices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span>
                    <span class="s2">&quot;subj_object_id&quot;</span>
                <span class="p">]</span><span class="o">.</span><span class="n">choices</span>

        <span class="k">if</span> <span class="n">obj_model</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;obj_content_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">required</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;obj_content_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">HiddenInput</span><span class="p">()</span>
            <span class="c1"># if we already now the id of the object, hide the object input</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;initial&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;obj_object_id&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;obj_object_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">HiddenInput</span><span class="p">()</span>
            <span class="c1"># otherwise create an autocomplete to select the object</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;obj_object_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ModelImportChoiceField</span><span class="p">(</span>
                    <span class="n">queryset</span><span class="o">=</span><span class="n">obj_model</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="n">label</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Object&quot;</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;obj_object_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">ApisListSelect2</span><span class="p">(</span>
                    <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;data-html&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
                    <span class="n">url</span><span class="o">=</span><span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;apis_core:generic:autocomplete&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">obj_ct</span><span class="p">])</span>
                    <span class="o">+</span> <span class="s2">&quot;?create=True&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;obj_object_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">choices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span>
                    <span class="s2">&quot;obj_object_id&quot;</span>
                <span class="p">]</span><span class="o">.</span><span class="n">choices</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">order_fields</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">field_order</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">helper</span> <span class="o">=</span> <span class="n">FormHelper</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">model_ct</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Meta</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">form_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;relation_</span><span class="si">{</span><span class="n">model_ct</span><span class="o">.</span><span class="n">model</span><span class="si">}</span><span class="s2">_form&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="n">Submit</span><span class="p">(</span><span class="s2">&quot;submit&quot;</span><span class="p">,</span> <span class="s2">&quot;Submit&quot;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">hx_post_route</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;hx_post_route&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;hx-post&quot;</span><span class="p">:</span> <span class="n">hx_post_route</span> <span class="o">+</span> <span class="s2">&quot;?&quot;</span> <span class="o">+</span> <span class="n">urlencode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="n">doseq</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="s2">&quot;hx-swap&quot;</span><span class="p">:</span> <span class="s2">&quot;outerHTML&quot;</span><span class="p">,</span>
                <span class="s2">&quot;hx-target&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;#</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">form_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        subj_object_id and obj_object_id can either come</span>
<span class="sd">        from initial values or from the autocomplete.</span>
<span class="sd">        In the former case, the values are simply the primary keys,</span>
<span class="sd">        which is what we want.</span>
<span class="sd">        In the latter case, the values are object instances and we</span>
<span class="sd">        want to set them to the primary keys instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cleaned_data</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span>
        <span class="n">subj_object_id</span> <span class="o">=</span> <span class="n">cleaned_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;subj_object_id&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">subj_object_id</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subj_object_id</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;subj_object_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subj_object_id</span><span class="o">.</span><span class="n">id</span>
        <span class="n">obj_object_id</span> <span class="o">=</span> <span class="n">cleaned_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;obj_object_id&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">obj_object_id</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj_object_id</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;obj_object_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj_object_id</span><span class="o">.</span><span class="n">id</span>
        <span class="k">return</span> <span class="n">cleaned_data</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">relation_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A helper method to access the correct name of the relation&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;reverse&quot;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">reverse_name</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">name</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="apis_core.relations.forms.RelationForm.relation_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">relation_name</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>A helper method to access the correct name of the relation</p>

    </div>

</div>



<div class="doc doc-object doc-function">


<h5 id="apis_core.relations.forms.RelationForm.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Initialize the form and replace <code>subj_object_id</code> and
<code>obj_object_id</code> fields with a autocomplete widget.</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/relations/forms/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize the form and replace `subj_object_id` and</span>
<span class="sd">    `obj_object_id` fields with a autocomplete widget.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;params&quot;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="n">subj_model</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Meta</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;subj_model&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">obj_model</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Meta</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;obj_model&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">subj_model</span><span class="p">:</span>
        <span class="n">subj_ct</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">subj_model</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;initial&quot;</span><span class="p">][</span><span class="s2">&quot;subj_content_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subj_ct</span>
    <span class="k">if</span> <span class="n">obj_model</span><span class="p">:</span>
        <span class="n">obj_ct</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">obj_model</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;initial&quot;</span><span class="p">][</span><span class="s2">&quot;obj_content_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj_ct</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">subj_model</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;subj_content_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">required</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;subj_content_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">HiddenInput</span><span class="p">()</span>
        <span class="c1"># if we already now the id of the subject, hide the subject input</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;initial&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;subj_object_id&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;subj_object_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">HiddenInput</span><span class="p">()</span>
        <span class="c1"># otherwise create an autocomplete to select the subject</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;subj_object_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ModelImportChoiceField</span><span class="p">(</span>
                <span class="n">queryset</span><span class="o">=</span><span class="n">subj_model</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="n">label</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Subject&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;subj_object_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">ApisListSelect2</span><span class="p">(</span>
                <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;data-html&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
                <span class="n">url</span><span class="o">=</span><span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;apis_core:generic:autocomplete&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">subj_ct</span><span class="p">])</span>
                <span class="o">+</span> <span class="s2">&quot;?create=True&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;subj_object_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">choices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span>
                <span class="s2">&quot;subj_object_id&quot;</span>
            <span class="p">]</span><span class="o">.</span><span class="n">choices</span>

    <span class="k">if</span> <span class="n">obj_model</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;obj_content_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">required</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;obj_content_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">HiddenInput</span><span class="p">()</span>
        <span class="c1"># if we already now the id of the object, hide the object input</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;initial&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;obj_object_id&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;obj_object_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">HiddenInput</span><span class="p">()</span>
        <span class="c1"># otherwise create an autocomplete to select the object</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;obj_object_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ModelImportChoiceField</span><span class="p">(</span>
                <span class="n">queryset</span><span class="o">=</span><span class="n">obj_model</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="n">label</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Object&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;obj_object_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">ApisListSelect2</span><span class="p">(</span>
                <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;data-html&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
                <span class="n">url</span><span class="o">=</span><span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;apis_core:generic:autocomplete&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">obj_ct</span><span class="p">])</span>
                <span class="o">+</span> <span class="s2">&quot;?create=True&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;obj_object_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">choices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span>
                <span class="s2">&quot;obj_object_id&quot;</span>
            <span class="p">]</span><span class="o">.</span><span class="n">choices</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">order_fields</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">field_order</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">helper</span> <span class="o">=</span> <span class="n">FormHelper</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">model_ct</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Meta</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">form_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;relation_</span><span class="si">{</span><span class="n">model_ct</span><span class="o">.</span><span class="n">model</span><span class="si">}</span><span class="s2">_form&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="n">Submit</span><span class="p">(</span><span class="s2">&quot;submit&quot;</span><span class="p">,</span> <span class="s2">&quot;Submit&quot;</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">hx_post_route</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;hx_post_route&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;hx-post&quot;</span><span class="p">:</span> <span class="n">hx_post_route</span> <span class="o">+</span> <span class="s2">&quot;?&quot;</span> <span class="o">+</span> <span class="n">urlencode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="n">doseq</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="s2">&quot;hx-swap&quot;</span><span class="p">:</span> <span class="s2">&quot;outerHTML&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hx-target&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;#</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">form_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="apis_core.relations.forms.RelationForm.clean" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">clean</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>subj_object_id and obj_object_id can either come
from initial values or from the autocomplete.
In the former case, the values are simply the primary keys,
which is what we want.
In the latter case, the values are object instances and we
want to set them to the primary keys instead.</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/relations/forms/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    subj_object_id and obj_object_id can either come</span>
<span class="sd">    from initial values or from the autocomplete.</span>
<span class="sd">    In the former case, the values are simply the primary keys,</span>
<span class="sd">    which is what we want.</span>
<span class="sd">    In the latter case, the values are object instances and we</span>
<span class="sd">    want to set them to the primary keys instead.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cleaned_data</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span>
    <span class="n">subj_object_id</span> <span class="o">=</span> <span class="n">cleaned_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;subj_object_id&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">subj_object_id</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subj_object_id</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;subj_object_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subj_object_id</span><span class="o">.</span><span class="n">id</span>
    <span class="n">obj_object_id</span> <span class="o">=</span> <span class="n">cleaned_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;obj_object_id&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">obj_object_id</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj_object_id</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;obj_object_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj_object_id</span><span class="o">.</span><span class="n">id</span>
    <span class="k">return</span> <span class="n">cleaned_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="apis_core.relations.models" class="doc doc-heading">
            <code>models</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="apis_core.relations.models.Relation" class="doc doc-heading">
            <code>Relation</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GenericModel (apis_core.generic.abc.GenericModel)" href="#apis_core.generic.abc.GenericModel">GenericModel</a></code>, <code><span title="django.db.models.Model">Model</span></code></p>








              <details class="quote">
                <summary>Source code in <code>apis_core/relations/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Relation</span><span class="p">(</span><span class="n">GenericModel</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">metaclass</span><span class="o">=</span><span class="n">RelationModelBase</span><span class="p">):</span>
    <span class="n">subj_content_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="n">ContentType</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;relation_subj_set&quot;</span>
    <span class="p">)</span>
    <span class="n">subj_object_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">subj</span> <span class="o">=</span> <span class="n">GenericForeignKey</span><span class="p">(</span><span class="s2">&quot;subj_content_type&quot;</span><span class="p">,</span> <span class="s2">&quot;subj_object_id&quot;</span><span class="p">)</span>
    <span class="n">obj_content_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="n">ContentType</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;relation_obj_set&quot;</span>
    <span class="p">)</span>
    <span class="n">obj_object_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">GenericForeignKey</span><span class="p">(</span><span class="s2">&quot;obj_content_type&quot;</span><span class="p">,</span> <span class="s2">&quot;obj_object_id&quot;</span><span class="p">)</span>

    <span class="n">objects</span> <span class="o">=</span> <span class="n">RelationManager</span><span class="p">()</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">indexes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">models</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span>
                <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;subj_content_type&quot;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;relations_r_subj_content_type&quot;</span>
            <span class="p">),</span>
            <span class="n">models</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;subj_object_id&quot;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;relations_r_subj_object_id&quot;</span><span class="p">),</span>
            <span class="n">models</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span>
                <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;obj_content_type&quot;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;relations_r_obj_content_type&quot;</span>
            <span class="p">),</span>
            <span class="n">models</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;obj_object_id&quot;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;relations_r_obj_object_id&quot;</span><span class="p">),</span>
            <span class="n">models</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span>
                <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;subj_content_type&quot;</span><span class="p">,</span> <span class="s2">&quot;subj_object_id&quot;</span><span class="p">],</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;relations_r_subj_c_t_o_i&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">models</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span>
                <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;obj_content_type&quot;</span><span class="p">,</span> <span class="s2">&quot;obj_object_id&quot;</span><span class="p">],</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;relations_r_obj_c_t_o_i&quot;</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">subj_model</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;subj_model&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">subj_model</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">subj_content_type</span> <span class="ow">is</span> <span class="n">subj_model</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">subj</span><span class="si">}</span><span class="s2"> is not of type </span><span class="si">{</span><span class="n">subj_model</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">obj_model</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;obj_model&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">obj_model</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj_content_type</span> <span class="ow">is</span> <span class="n">obj_model</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="si">}</span><span class="s2"> is not of type </span><span class="si">{</span><span class="n">obj_model</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">subj_to_obj_text</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">subj</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">()</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">subj</span><span class="si">}</span><span class="s2"> relation to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">obj_to_subj_text</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;reverse_name&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse_name</span><span class="p">()</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">subj</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="si">}</span><span class="s2"> relation to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">subj</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">subj_to_obj_text</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">subj_model_type</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">subj_model</span>
        <span class="k">return</span> <span class="n">get_by_natural_key</span><span class="p">(</span><span class="n">model</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">model</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">obj_model_type</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">obj_model</span>
        <span class="k">return</span> <span class="n">get_by_natural_key</span><span class="p">(</span><span class="n">model</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">model</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">verbose_name</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">reverse_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">verbose_name</span> <span class="o">+</span> <span class="s2">&quot; reverse&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name_and_reverse_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a string with both the name and the reverse name.</span>

<span class="sd">        If they are identical, return only the name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">name</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">reverse_name</span><span class="p">():</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">name</span><span class="p">()</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">reverse_name</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">name</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="apis_core.relations.models.Relation.name_and_reverse_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">name_and_reverse_name</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Return a string with both the name and the reverse name.</p>
<p>If they are identical, return only the name.</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/relations/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">name_and_reverse_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a string with both the name and the reverse name.</span>

<span class="sd">    If they are identical, return only the name.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">name</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">reverse_name</span><span class="p">():</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">name</span><span class="p">()</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">reverse_name</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">name</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="apis_core.relations.models.RelationManager" class="doc doc-heading">
            <code>RelationManager</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="model_utils.managers.InheritanceManager">InheritanceManager</span></code></p>








              <details class="quote">
                <summary>Source code in <code>apis_core/relations/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RelationManager</span><span class="p">(</span><span class="n">InheritanceManager</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_between_instances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subj</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">subj_object_id</span> <span class="o">=</span> <span class="n">subj</span><span class="o">.</span><span class="n">pk</span>
        <span class="n">subj_content_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">subj</span><span class="p">)</span>
        <span class="n">obj_object_id</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">pk</span>
        <span class="n">obj_content_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="n">rel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">subj_object_id</span><span class="o">=</span><span class="n">subj_object_id</span><span class="p">,</span>
            <span class="n">subj_content_type</span><span class="o">=</span><span class="n">subj_content_type</span><span class="p">,</span>
            <span class="n">obj_object_id</span><span class="o">=</span><span class="n">obj_object_id</span><span class="p">,</span>
            <span class="n">obj_content_type</span><span class="o">=</span><span class="n">obj_content_type</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Created relation </span><span class="si">%s</span><span class="s2"> between </span><span class="si">%s</span><span class="s2"> and </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">rel</span><span class="o">.</span><span class="n">name</span><span class="p">(),</span> <span class="n">subj</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rel</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_content_type_with_targets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content_type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the queryset annotated with the target content type</span>
<span class="sd">        and object id, based on the content_type that is passed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
            <span class="n">target_content_type</span><span class="o">=</span><span class="n">Case</span><span class="p">(</span>
                <span class="n">When</span><span class="p">(</span><span class="n">subj_content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">,</span> <span class="n">then</span><span class="o">=</span><span class="s2">&quot;obj_content_type&quot;</span><span class="p">),</span>
                <span class="n">default</span><span class="o">=</span><span class="s2">&quot;subj_content_type&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">target_id</span><span class="o">=</span><span class="n">Case</span><span class="p">(</span>
                <span class="n">When</span><span class="p">(</span><span class="n">subj_content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">,</span> <span class="n">then</span><span class="o">=</span><span class="s2">&quot;obj_object_id&quot;</span><span class="p">),</span>
                <span class="n">default</span><span class="o">=</span><span class="s2">&quot;subj_object_id&quot;</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="apis_core.relations.models.RelationManager.to_content_type_with_targets" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_content_type_with_targets</span><span class="p">(</span><span class="n">content_type</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Return the queryset annotated with the target content type
and object id, based on the content_type that is passed.</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/relations/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_content_type_with_targets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content_type</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the queryset annotated with the target content type</span>
<span class="sd">    and object id, based on the content_type that is passed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
        <span class="n">target_content_type</span><span class="o">=</span><span class="n">Case</span><span class="p">(</span>
            <span class="n">When</span><span class="p">(</span><span class="n">subj_content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">,</span> <span class="n">then</span><span class="o">=</span><span class="s2">&quot;obj_content_type&quot;</span><span class="p">),</span>
            <span class="n">default</span><span class="o">=</span><span class="s2">&quot;subj_content_type&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">target_id</span><span class="o">=</span><span class="n">Case</span><span class="p">(</span>
            <span class="n">When</span><span class="p">(</span><span class="n">subj_content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">,</span> <span class="n">then</span><span class="o">=</span><span class="s2">&quot;obj_object_id&quot;</span><span class="p">),</span>
            <span class="n">default</span><span class="o">=</span><span class="s2">&quot;subj_object_id&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="apis_core.relations.signals" class="doc doc-heading">
            <code>signals</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="apis_core.relations.signals.create_relations" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_relations</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">created</span><span class="p">,</span> <span class="n">raw</span><span class="p">,</span> <span class="n">using</span><span class="p">,</span> <span class="n">update_fields</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>This signal looks at the <code>create_relations_to_uris</code> attribute of a model
instance. The attribute should contain a dict mapping between a relation
name and mapping between they key <code>obj</code> or <code>subj</code> and a list of URIs.
The signal then tries to create relations between the instance and the
subjects or objects listed in the relation dict mapping.
An example for the dict mapping would be:
"myapp.livesin" = {
    curies = ["https://example.org/123"],
    obj = "apis_ontology.place"
}</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/relations/signals.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@receiver</span><span class="p">(</span><span class="n">post_save</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">create_relations</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">created</span><span class="p">,</span> <span class="n">raw</span><span class="p">,</span> <span class="n">using</span><span class="p">,</span> <span class="n">update_fields</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This signal looks at the `create_relations_to_uris` attribute of a model</span>
<span class="sd">    instance. The attribute should contain a dict mapping between a relation</span>
<span class="sd">    name and mapping between they key `obj` or `subj` and a list of URIs.</span>
<span class="sd">    The signal then tries to create relations between the instance and the</span>
<span class="sd">    subjects or objects listed in the relation dict mapping.</span>
<span class="sd">    An example for the dict mapping would be:</span>
<span class="sd">    &quot;myapp.livesin&quot; = {</span>
<span class="sd">        curies = [&quot;https://example.org/123&quot;],</span>
<span class="sd">        obj = &quot;apis_ontology.place&quot;</span>
<span class="sd">    }</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># disable the handler during fixture loading</span>
    <span class="k">if</span> <span class="n">raw</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">relations</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="s2">&quot;create_relations_to_uris&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">relation</span><span class="p">,</span> <span class="n">details</span> <span class="ow">in</span> <span class="n">relations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">relation_model</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_by_natural_key</span><span class="p">(</span>
            <span class="o">*</span><span class="n">relation</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">model_class</span><span class="p">()</span>

        <span class="n">target</span> <span class="o">=</span> <span class="n">details</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;obj&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">details</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;subj&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">target_content_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_by_natural_key</span><span class="p">(</span><span class="o">*</span><span class="n">target</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">))</span>
        <span class="n">related_model</span> <span class="o">=</span> <span class="n">target_content_type</span><span class="o">.</span><span class="n">model_class</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">related_uri</span> <span class="ow">in</span> <span class="n">details</span><span class="p">[</span><span class="s2">&quot;curies&quot;</span><span class="p">]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">related_instance</span> <span class="o">=</span> <span class="n">related_model</span><span class="o">.</span><span class="n">import_from</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">related_uri</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">details</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;obj&quot;</span><span class="p">):</span>
                    <span class="n">relation_model</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_between_instances</span><span class="p">(</span>
                        <span class="n">instance</span><span class="p">,</span> <span class="n">related_instance</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">relation_model</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_between_instances</span><span class="p">(</span>
                        <span class="n">related_instance</span><span class="p">,</span> <span class="n">instance</span>
                    <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s2">&quot;Could not create relation to </span><span class="si">%s</span><span class="s2"> due to </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">related_uri</span><span class="p">,</span> <span class="n">e</span>
                <span class="p">)</span>
        <span class="k">del</span> <span class="n">instance</span><span class="o">.</span><span class="n">create_relations_to_uris</span><span class="p">[</span><span class="n">relation</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="apis_core.relations.utils" class="doc doc-heading">
            <code>utils</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="apis_core.relations.utils.get_all_relation_subj_and_obj" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_all_relation_subj_and_obj</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-cached"><code>cached</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Return the model classes of any model that is in some way
connected to a relation - either as obj or as subj</p>
<p>Returns:
list[ContentType]: A list of unique ContentTypes for related models.</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/relations/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@functools</span><span class="o">.</span><span class="n">cache</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_all_relation_subj_and_obj</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ContentType</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the model classes of any model that is in some way</span>
<span class="sd">    connected to a relation - either as obj or as subj</span>

<span class="sd">    Returns:</span>
<span class="sd">    list[ContentType]: A list of unique ContentTypes for related models.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">related_models</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">relation_content_types</span><span class="p">():</span>
        <span class="n">related_models</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rel</span><span class="o">.</span><span class="n">model_class</span><span class="p">()</span><span class="o">.</span><span class="n">subj_model_type</span><span class="p">())</span>
        <span class="n">related_models</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rel</span><span class="o">.</span><span class="n">model_class</span><span class="p">()</span><span class="o">.</span><span class="n">obj_model_type</span><span class="p">())</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">related_models</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="apis_core.relations.utils.relation_match_target" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">relation_match_target</span><span class="p">(</span><span class="n">relation</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>test if a relation points to a target
this function should not be cached, because the <code>forward</code> attribute
is an annotation that does not seem to be part of the relation, so
if cached, method could be called with another <code>forward</code> value and
return the wrong result</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/relations/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">relation_match_target</span><span class="p">(</span><span class="n">relation</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">ContentType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    test if a relation points to a target</span>
<span class="sd">    this function should not be cached, because the `forward` attribute</span>
<span class="sd">    is an annotation that does not seem to be part of the relation, so</span>
<span class="sd">    if cached, method could be called with another `forward` value and</span>
<span class="sd">    return the wrong result</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">relation</span><span class="o">.</span><span class="n">forward</span> <span class="ow">and</span> <span class="n">relation</span><span class="o">.</span><span class="n">obj_content_type</span> <span class="o">==</span> <span class="n">target</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">relation</span><span class="o">.</span><span class="n">forward</span> <span class="ow">and</span> <span class="n">relation</span><span class="o">.</span><span class="n">subj_content_type</span> <span class="o">==</span> <span class="n">target</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="apis_core.uris" class="doc doc-heading">
            <code>uris</code>


</h2>

    <div class="doc doc-contents ">









  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h3 id="apis_core.uris.models" class="doc doc-heading">
            <code>models</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="apis_core.uris.models.Uri" class="doc doc-heading">
            <code>Uri</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GenericModel (apis_core.generic.abc.GenericModel)" href="#apis_core.generic.abc.GenericModel">GenericModel</a></code>, <code><span title="django.db.models.Model">Model</span></code></p>


        <p>The URI model provides a way of storing globally scoped identifiers for
objects. For the objects in our application, we store both internal URIs
(URIs that we created) as well as external URIs (when we want to link the
object to an external resource, asserting that this object is the "same as"
the external object).</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/uris/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Uri</span><span class="p">(</span><span class="n">GenericModel</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The URI model provides a way of storing globally scoped identifiers for</span>
<span class="sd">    objects. For the objects in our application, we store both internal URIs</span>
<span class="sd">    (URIs that we created) as well as external URIs (when we want to link the</span>
<span class="sd">    object to an external resource, asserting that this object is the &quot;same as&quot;</span>
<span class="sd">    the external object).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">uri</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">URLField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
    <span class="n">content_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">ContentType</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">object_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">content_object</span> <span class="o">=</span> <span class="n">GenericForeignKey</span><span class="p">()</span>

    <span class="n">objects</span> <span class="o">=</span> <span class="n">UriManager</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uri</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uri</span> <span class="o">=</span> <span class="n">get_normalized_uri</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uri</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">uri</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;content_object&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">rdf</span><span class="o">.</span><span class="n">get_something_from_uri</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uri</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">model</span> <span class="o">:=</span> <span class="n">result</span><span class="o">.</span><span class="n">getattr</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                    <span class="n">obj</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="o">**</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{}))</span>
                    <span class="n">obj</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">content_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">object_id</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">id</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ImproperlyConfigured</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">uri</span><span class="si">}</span><span class="s2">: did not find matching rdf defintion&quot;</span>
                    <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">uri</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">internal</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="n">my_netloc</span> <span class="o">=</span> <span class="n">urlsplit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uri</span><span class="p">)</span><span class="o">.</span><span class="n">netloc</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span>
            <span class="p">[</span><span class="n">my_netloc</span> <span class="o">==</span> <span class="n">urlsplit</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span><span class="o">.</span><span class="n">netloc</span> <span class="k">for</span> <span class="n">uri</span> <span class="ow">in</span> <span class="n">apis_settings</span><span class="o">.</span><span class="n">internal_uris</span><span class="p">()]</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">short_label</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal</span><span class="p">():</span>
            <span class="k">return</span> <span class="s2">&quot;local&quot;</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">get_rules</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;match&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">uri</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">urlsplit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uri</span><span class="p">)</span><span class="o">.</span><span class="n">netloc</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="apis_core.uris.tests" class="doc doc-heading">
            <code>tests</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="apis_core.uris.tests.setup_test_app" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setup_test_app</span><span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Setup a Django test app for the provided package to allow test models
tables to be created if the containing app has migrations.</p>
<p>This function should be called from app.tests <strong>init</strong> module and pass
along <strong>package</strong>.</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/uris/tests/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">setup_test_app</span><span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Setup a Django test app for the provided package to allow test models</span>
<span class="sd">    tables to be created if the containing app has migrations.</span>

<span class="sd">    This function should be called from app.tests __init__ module and pass</span>
<span class="sd">    along __package__.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">app_config</span> <span class="o">=</span> <span class="n">AppConfig</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">package</span><span class="p">)</span>
    <span class="n">app_config</span><span class="o">.</span><span class="n">apps</span> <span class="o">=</span> <span class="n">apps</span>
    <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">containing_app_config</span> <span class="o">=</span> <span class="n">apps</span><span class="o">.</span><span class="n">get_containing_app_config</span><span class="p">(</span><span class="n">package</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">containing_app_config</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s2">_tests&quot;</span>
    <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">apps</span><span class="o">.</span><span class="n">app_configs</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There&#39;s already an app registered with the &#39;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">&#39; label.&quot;</span><span class="p">)</span>
    <span class="n">app_config</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
    <span class="n">apps</span><span class="o">.</span><span class="n">app_configs</span><span class="p">[</span><span class="n">app_config</span><span class="o">.</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">app_config</span>
    <span class="n">app_config</span><span class="o">.</span><span class="n">import_models</span><span class="p">()</span>
    <span class="n">apps</span><span class="o">.</span><span class="n">clear_cache</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>


<div class="doc doc-object doc-module">



<h4 id="apis_core.uris.tests.test_uris" class="doc doc-heading">
            <code>test_uris</code>


</h4>

    <div class="doc doc-contents ">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h5 id="apis_core.uris.tests.test_uris.TestUris" class="doc doc-heading">
            <code>TestUris</code>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="object">object</span></code></p>








              <details class="quote">
                <summary>Source code in <code>apis_core/uris/tests/test_uris.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">django_db</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TestUris</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Create a couple of person objects</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fake</span><span class="o">.</span><span class="n">random_int</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">20</span><span class="p">)):</span>
            <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                <span class="n">first_name</span><span class="o">=</span><span class="n">fake</span><span class="o">.</span><span class="n">first_name</span><span class="p">(),</span> <span class="n">last_name</span><span class="o">=</span><span class="n">fake</span><span class="o">.</span><span class="n">last_name</span><span class="p">()</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_uris_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the correct number of Uris was created&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">Uri</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">==</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_uris_list_view_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="p">,</span> <span class="n">admin_client</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the uris list view works&quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">admin_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/uris.uri/&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_uris_list_view_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="p">,</span> <span class="n">admin_client</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the uris list view works&quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">admin_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/uris.uri/&quot;</span><span class="p">)</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="c1"># check for the correct result count in the response content</span>
        <span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> results.&quot;</span><span class="p">)</span>
        <span class="c1"># check if all the persons are listed</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_delete_view_template_override</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="p">,</span> <span class="n">admin_client</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check that the delete confirm view uses the right template&quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">admin_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/uris.uri/delete/1&quot;</span><span class="p">)</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="n">Uri</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">assertTemplateUsed</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s2">&quot;uris/uri_confirm_delete.html&quot;</span><span class="p">)</span>
        <span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">uri</span><span class="o">.</span><span class="n">uri</span><span class="p">)</span>
        <span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">uri</span><span class="o">.</span><span class="n">content_object</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_no_uris_for_dummy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check that we don&#39;t create uris for dummy objects&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
            <span class="n">Dummy</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
        <span class="n">content_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">Dummy</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">Uri</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_custom_uri</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">Dummy</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;http://example.org&quot;</span>
        <span class="n">d</span><span class="o">.</span><span class="n">_uris</span> <span class="o">=</span> <span class="p">[</span><span class="n">uri</span><span class="p">]</span>
        <span class="n">d</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">Uri</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">Uri</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">)</span><span class="o">.</span><span class="n">content_object</span> <span class="o">==</span> <span class="n">d</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h6 id="apis_core.uris.tests.test_uris.TestUris.test_delete_view_template_override" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">test_delete_view_template_override</span><span class="p">(</span><span class="n">setup</span><span class="p">,</span> <span class="n">admin_client</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Check that the delete confirm view uses the right template</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/uris/tests/test_uris.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_delete_view_template_override</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="p">,</span> <span class="n">admin_client</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check that the delete confirm view uses the right template&quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">admin_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/uris.uri/delete/1&quot;</span><span class="p">)</span>
    <span class="n">uri</span> <span class="o">=</span> <span class="n">Uri</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">assertTemplateUsed</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s2">&quot;uris/uri_confirm_delete.html&quot;</span><span class="p">)</span>
    <span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">uri</span><span class="o">.</span><span class="n">uri</span><span class="p">)</span>
    <span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">uri</span><span class="o">.</span><span class="n">content_object</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="apis_core.uris.tests.test_uris.TestUris.test_no_uris_for_dummy" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">test_no_uris_for_dummy</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Check that we don't create uris for dummy objects</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/uris/tests/test_uris.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_no_uris_for_dummy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check that we don&#39;t create uris for dummy objects&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
        <span class="n">Dummy</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
    <span class="n">content_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">Dummy</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">Uri</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="apis_core.uris.tests.test_uris.TestUris.test_uris_count" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">test_uris_count</span><span class="p">(</span><span class="n">setup</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Check if the correct number of Uris was created</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/uris/tests/test_uris.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_uris_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if the correct number of Uris was created&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">Uri</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">==</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="apis_core.uris.tests.test_uris.TestUris.test_uris_list_view_content" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">test_uris_list_view_content</span><span class="p">(</span><span class="n">setup</span><span class="p">,</span> <span class="n">admin_client</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Check if the uris list view works</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/uris/tests/test_uris.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_uris_list_view_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="p">,</span> <span class="n">admin_client</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if the uris list view works&quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">admin_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/uris.uri/&quot;</span><span class="p">)</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
    <span class="c1"># check for the correct result count in the response content</span>
    <span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> results.&quot;</span><span class="p">)</span>
    <span class="c1"># check if all the persons are listed</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="apis_core.uris.tests.test_uris.TestUris.test_uris_list_view_status" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">test_uris_list_view_status</span><span class="p">(</span><span class="n">setup</span><span class="p">,</span> <span class="n">admin_client</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Check if the uris list view works</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/uris/tests/test_uris.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_uris_list_view_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="p">,</span> <span class="n">admin_client</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if the uris list view works&quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">admin_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/uris.uri/&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="apis_core.uris.viewsets" class="doc doc-heading">
            <code>viewsets</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="apis_core.uris.viewsets.UriToObjectViewSet" class="doc doc-heading">
            <code>UriToObjectViewSet</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="rest_framework.viewsets.ViewSet">ViewSet</span></code></p>


        <p>This API route provides an endpoint for resolving URIs and forwarding
them to the endpoint in the local instance. Pass a <code>uri</code> request
parameter to resolve the uri.</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/uris/viewsets.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">UriToObjectViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ViewSet</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This API route provides an endpoint for resolving URIs and forwarding</span>
<span class="sd">    them to the endpoint in the local instance. Pass a `uri` request</span>
<span class="sd">    parameter to resolve the uri.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@extend_schema</span><span class="p">(</span>
        <span class="n">parameters</span><span class="o">=</span><span class="p">[</span>
            <span class="n">OpenApiParameter</span><span class="p">(</span>
                <span class="s2">&quot;uri&quot;</span><span class="p">,</span> <span class="n">OpenApiTypes</span><span class="o">.</span><span class="n">URI</span><span class="p">,</span> <span class="n">OpenApiParameter</span><span class="o">.</span><span class="n">QUERY</span>
            <span class="p">),</span>  <span class="c1"># path variable was overridden</span>
        <span class="p">],</span>
        <span class="n">responses</span><span class="o">=</span><span class="p">{</span><span class="mi">301</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;This API route provides an endpoint for resolving URIs and forwarding them to the endpoint in the local instance. Pass a `uri` request parameter to resolve the uri.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">query_params</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;uri&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">uri</span><span class="p">:</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Uri</span><span class="p">,</span> <span class="n">uri</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">query_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uri&quot;</span><span class="p">))</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">content_object</span><span class="o">.</span><span class="n">get_api_detail_endpoint</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">params</span><span class="p">:</span>
                <span class="n">r</span> <span class="o">+=</span> <span class="s2">&quot;?&quot;</span> <span class="o">+</span> <span class="n">QueryDict</span><span class="o">.</span><span class="n">from_keys</span><span class="p">(</span><span class="n">params</span><span class="p">)</span><span class="o">.</span><span class="n">urlencode</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Response</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="apis_core.urls" class="doc doc-heading">
            <code>urls</code>


</h2>

    <div class="doc doc-contents ">

        <p>Main entry point for APIS routes</p>









  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="apis_core.utils" class="doc doc-heading">
            <code>utils</code>


</h2>

    <div class="doc doc-contents ">









  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h3 id="apis_core.utils.autocomplete" class="doc doc-heading">
            <code>autocomplete</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="apis_core.utils.autocomplete.ExternalAutocomplete" class="doc doc-heading">
            <code>ExternalAutocomplete</code>


</h4>


    <div class="doc doc-contents ">


        <p>This is a helper base class for implementing external
autocomplete classes. <Modelname>ExernalAutocomplete classes
are expected to have a <code>get_results(self, q)</code> method that
returns a list of results usable by the autocomplete view.
This base class implements this <code>get_results</code> method in a
way that you can inherit from it and just define a list of
<code>adapters</code>. Those adapters are then used one by one to
add external autocomplete search results.</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/utils/autocomplete.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ExternalAutocomplete</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a helper base class for implementing external</span>
<span class="sd">    autocomplete classes. &lt;Modelname&gt;ExernalAutocomplete classes</span>
<span class="sd">    are expected to have a `get_results(self, q)` method that</span>
<span class="sd">    returns a list of results usable by the autocomplete view.</span>
<span class="sd">    This base class implements this `get_results` method in a</span>
<span class="sd">    way that you can inherit from it and just define a list of</span>
<span class="sd">    `adapters`. Those adapters are then used one by one to</span>
<span class="sd">    add external autocomplete search results.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">client</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
    <span class="n">adapters</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">adapter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">adapters</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">adapter</span><span class="o">.</span><span class="n">get_results</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="apis_core.utils.autocomplete.ExternalAutocompleteAdapter" class="doc doc-heading">
            <code>ExternalAutocompleteAdapter</code>


</h4>


    <div class="doc doc-contents ">


        <p>Base class for ExternalAutocompleteAdapters. It provides
the methods used for templating the autocomplete results.
You can pass a <code>template</code> name to initialization, which
is then used to style the results.</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/utils/autocomplete.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ExternalAutocompleteAdapter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for ExternalAutocompleteAdapters. It provides</span>
<span class="sd">    the methods used for templating the autocomplete results.</span>
<span class="sd">    You can pass a `template` name to initialization, which</span>
<span class="sd">    is then used to style the results.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">template</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;template&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_mapping</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data_mapping&quot;</span><span class="p">,</span> <span class="p">{})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_nested_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict_</span><span class="p">,</span> <span class="n">keys</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a nested value from a dict by poviding the</span>
<span class="sd">        path as a list of keys</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">keys</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">dict_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)]</span>
            <span class="n">dict_</span> <span class="o">=</span> <span class="n">dict_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">{})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">map_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Map data from the result to a a new dict. The new dict</span>
<span class="sd">        is built using the settings in `.data_mapping`, which</span>
<span class="sd">        should be a mapping of keys to be created in the result</span>
<span class="sd">        dict to paths in the `result` item.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span><span class="p">]</span>
            <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nested_get</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_data_to_uri</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uri</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">b64_data</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span><span class="o">.</span><span class="n">query</span><span class="p">:</span>
            <span class="n">uri</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&amp;anero_ac_data=</span><span class="si">{</span><span class="n">b64_data</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">uri</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;?anero_ac_data=</span><span class="si">{</span><span class="n">b64_data</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">uri</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">default_template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> &lt;a href=&quot;</span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&quot;&gt;</span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/a&gt;&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_result_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">render_to_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">})</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_template</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="apis_core.utils.autocomplete.ExternalAutocompleteAdapter.map_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">map_data</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Map data from the result to a a new dict. The new dict
is built using the settings in <code>.data_mapping</code>, which
should be a mapping of keys to be created in the result
dict to paths in the <code>result</code> item.</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/utils/autocomplete.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">map_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Map data from the result to a a new dict. The new dict</span>
<span class="sd">    is built using the settings in `.data_mapping`, which</span>
<span class="sd">    should be a mapping of keys to be created in the result</span>
<span class="sd">    dict to paths in the `result` item.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">val</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span><span class="p">]</span>
        <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nested_get</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="apis_core.utils.autocomplete.LobidAutocompleteAdapter" class="doc doc-heading">
            <code>LobidAutocompleteAdapter</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ExternalAutocompleteAdapter (apis_core.utils.autocomplete.ExternalAutocompleteAdapter)" href="#apis_core.utils.autocomplete.ExternalAutocompleteAdapter">ExternalAutocompleteAdapter</a></code></p>


        <p>This autocomplete adapters queries the lobid autocomplete apis.
See https://lobid.org/gnd/api for details
You can pass a <code>lobid_params</code> dict which will then be use as GET
request parameters.</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/utils/autocomplete.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">LobidAutocompleteAdapter</span><span class="p">(</span><span class="n">ExternalAutocompleteAdapter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This autocomplete adapters queries the lobid autocomplete apis.</span>
<span class="sd">    See https://lobid.org/gnd/api for details</span>
<span class="sd">    You can pass a `lobid_params` dict which will then be use as GET</span>
<span class="sd">    request parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;params&quot;</span><span class="p">,</span> <span class="p">{})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">extract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">res</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_data</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_data_to_uri</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">uri</span><span class="p">,</span>
            <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_result_label</span><span class="p">(</span><span class="n">res</span><span class="p">),</span>
            <span class="s2">&quot;selected_text&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_result_label</span><span class="p">(</span><span class="n">res</span><span class="p">),</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">()):</span>
        <span class="n">endpoint</span> <span class="o">=</span> <span class="s2">&quot;https://lobid.org/gnd/search?&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;q&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">res</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extract</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">json</span><span class="p">())))</span>
        <span class="k">return</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="apis_core.utils.autocomplete.TypeSenseAutocompleteAdapter" class="doc doc-heading">
            <code>TypeSenseAutocompleteAdapter</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ExternalAutocompleteAdapter (apis_core.utils.autocomplete.ExternalAutocompleteAdapter)" href="#apis_core.utils.autocomplete.ExternalAutocompleteAdapter">ExternalAutocompleteAdapter</a></code></p>


        <p>This autocomplete adapters queries typesense collections on a
typesense server. The <code>collections</code> variable can either be a
string or a list - if its a string, that collection is queried
directly, if its a list, the adapter uses typesense <code>multi_search</code>
endpoint.</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/utils/autocomplete.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TypeSenseAutocompleteAdapter</span><span class="p">(</span><span class="n">ExternalAutocompleteAdapter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This autocomplete adapters queries typesense collections on a</span>
<span class="sd">    typesense server. The `collections` variable can either be a</span>
<span class="sd">    string or a list - if its a string, that collection is queried</span>
<span class="sd">    directly, if its a list, the adapter uses typesense `multi_search`</span>
<span class="sd">    endpoint.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">collections</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">token</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">server</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collections</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;collections&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;token&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;server&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">default_template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">default_template</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;document&quot;</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">extract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">res</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;document&quot;</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_data</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
            <span class="n">uri</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_data_to_uri</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;document&quot;</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">uri</span><span class="p">,</span>
                <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_result_label</span><span class="p">(</span><span class="n">res</span><span class="p">),</span>
                <span class="s2">&quot;selected_text&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_result_label</span><span class="p">(</span><span class="n">res</span><span class="p">),</span>
            <span class="p">}</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Could not parse result from typesense collection </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">collections</span><span class="p">,</span>
            <span class="n">res</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">()):</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;X-TYPESENSE-API-KEY&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">}</span>
        <span class="n">res</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="p">:</span>
            <span class="k">match</span> <span class="bp">self</span><span class="o">.</span><span class="n">collections</span><span class="p">:</span>
                <span class="c1"># if there is only on collection configured, we hit that collection directly</span>
                <span class="k">case</span> <span class="nb">str</span><span class="p">()</span> <span class="k">as</span> <span class="n">collection</span><span class="p">:</span>
                    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="si">}</span><span class="s2">/collections/</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">/documents/search?q=</span><span class="si">{</span><span class="n">q</span><span class="si">}</span><span class="s2">&amp;query_by=description&amp;query_by=label&quot;</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
                <span class="c1"># if there are multiple collections configured, we use the `multi_search` endpoint</span>
                <span class="k">case</span> <span class="nb">list</span><span class="p">()</span> <span class="k">as</span> <span class="n">collectionlist</span><span class="p">:</span>
                    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="si">}</span><span class="s2">/multi_search?q=</span><span class="si">{</span><span class="n">q</span><span class="si">}</span><span class="s2">&amp;query_by=description&amp;query_by=label&quot;</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;searches&quot;</span><span class="p">:</span> <span class="p">[]}</span>
                    <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="n">collectionlist</span><span class="p">:</span>
                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;searches&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">collection</span><span class="p">})</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
                <span class="k">case</span> <span class="n">unknown</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Don&#39;t know what to do with collection </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">unknown</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">res</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                <span class="n">hits</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;hits&quot;</span><span class="p">,</span> <span class="p">[])</span>
                <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                    <span class="n">hits</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;hits&quot;</span><span class="p">])</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extract</span><span class="p">,</span> <span class="n">hits</span><span class="p">)))</span>
        <span class="k">return</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="apis_core.utils.fields" class="doc doc-heading">
            <code>fields</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="apis_core.utils.fields.NewlineSeparatedListField" class="doc doc-heading">
            <code>NewlineSeparatedListField</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="django.db.models.TextField">TextField</span></code></p>


        <p>This field is basically a textfield with a custom widget.
It uses the NewlineSeparatedListWidget to provide a simply way
for users to enter multiple values without having to think about
the separator.</p>







              <details class="quote">
                <summary>Source code in <code>apis_core/utils/fields.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">NewlineSeparatedListField</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This field is basically a textfield with a custom widget.</span>
<span class="sd">    It uses the NewlineSeparatedListWidget to provide a simply way</span>
<span class="sd">    for users to enter multiple values without having to think about</span>
<span class="sd">    the separator.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">formfield</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form_class</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">choices_form_class</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;widget&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">NewlineSeparatedListWidget</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;mb-1&quot;</span><span class="p">})</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">formfield</span><span class="p">(</span>
            <span class="n">form_class</span><span class="o">=</span><span class="n">form_class</span><span class="p">,</span> <span class="n">choices_form_class</span><span class="o">=</span><span class="n">choices_form_class</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="apis_core.utils.helpers" class="doc doc-heading">
            <code>helpers</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="apis_core.utils.helpers.construct_lookup" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">construct_lookup</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Helper method to parse input values and construct field lookups
(https://docs.djangoproject.com/en/4.2/ref/models/querysets/#field-lookups)
Parses user input for wildcards and returns a tuple containing the
interpreted django lookup string and the trimmed value
E.g.</p>
<ul>
<li><code>example</code> -&gt; <code>('__icontains', 'example')</code></li>
<li><code>*example*</code> -&gt; <code>('__icontains', 'example')</code></li>
<li><code>*example</code> -&gt; <code>('__iendswith', 'example')</code></li>
<li><code>example*</code>-&gt; <code>('__istartswith', 'example')</code></li>
<li><code>"example"</code> -&gt; <code>('__iexact', 'example')</code></li>
</ul>
<p>:param str value: text to be parsed for <code>*</code>
:return: a tuple containing the lookup type and the value without modifiers</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/utils/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">construct_lookup</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper method to parse input values and construct field lookups</span>
<span class="sd">    (https://docs.djangoproject.com/en/4.2/ref/models/querysets/#field-lookups)</span>
<span class="sd">    Parses user input for wildcards and returns a tuple containing the</span>
<span class="sd">    interpreted django lookup string and the trimmed value</span>
<span class="sd">    E.g.</span>

<span class="sd">    - ``example`` -&gt; ``(&#39;__icontains&#39;, &#39;example&#39;)``</span>
<span class="sd">    - ``*example*`` -&gt; ``(&#39;__icontains&#39;, &#39;example&#39;)``</span>
<span class="sd">    - ``*example`` -&gt; ``(&#39;__iendswith&#39;, &#39;example&#39;)``</span>
<span class="sd">    - ``example*``-&gt; ``(&#39;__istartswith&#39;, &#39;example&#39;)``</span>
<span class="sd">    - ``&quot;example&quot;`` -&gt; ``(&#39;__iexact&#39;, &#39;example&#39;)``</span>

<span class="sd">    :param str value: text to be parsed for ``*``</span>
<span class="sd">    :return: a tuple containing the lookup type and the value without modifiers</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">value</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">return</span> <span class="s2">&quot;__iendswith&quot;</span><span class="p">,</span> <span class="n">value</span>

    <span class="k">elif</span> <span class="ow">not</span> <span class="n">value</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="s2">&quot;__istartswith&quot;</span><span class="p">,</span> <span class="n">value</span>

    <span class="k">elif</span> <span class="n">value</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="s2">&quot;__iexact&quot;</span><span class="p">,</span> <span class="n">value</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="s2">&quot;__icontains&quot;</span><span class="p">,</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="apis_core.utils.helpers.datadump_get_queryset" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">datadump_get_queryset</span><span class="p">(</span><span class="n">additional_app_labels</span><span class="o">=</span><span class="p">[])</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>This method is loosely based on the <code>dumpdata</code> admin command.
It iterates throug the relevant app models and exports them using
a serializer and natural foreign keys.
Data exported this way can be reimported into a newly created Django APIS app</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/utils/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">datadump_get_queryset</span><span class="p">(</span><span class="n">additional_app_labels</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method is loosely based on the `dumpdata` admin command.</span>
<span class="sd">    It iterates throug the relevant app models and exports them using</span>
<span class="sd">    a serializer and natural foreign keys.</span>
<span class="sd">    Data exported this way can be reimported into a newly created Django APIS app</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># get all APIS apps and all APIS models</span>
    <span class="n">apis_app_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;apis_relations&quot;</span><span class="p">,</span> <span class="s2">&quot;apis_metainfo&quot;</span><span class="p">]</span>
    <span class="n">apis_app_models</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">model</span> <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">apps</span><span class="o">.</span><span class="n">get_models</span><span class="p">()</span> <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">app_label</span> <span class="ow">in</span> <span class="n">apis_app_labels</span>
    <span class="p">]</span>

    <span class="c1"># create a list of app labels we want to iterate</span>
    <span class="c1"># this allows to extend the apps via the ?app_labels= parameter</span>
    <span class="n">app_labels</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">apis_app_labels</span><span class="p">)</span>
    <span class="n">app_labels</span> <span class="o">|=</span> <span class="nb">set</span><span class="p">(</span><span class="n">additional_app_labels</span><span class="p">)</span>

    <span class="c1"># look for models that inherit from APIS models and add their</span>
    <span class="c1"># app label to app_labels</span>
    <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">apps</span><span class="o">.</span><span class="n">get_models</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">apis_app_models</span><span class="p">)):</span>
            <span class="n">app_labels</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">app_label</span><span class="p">)</span>

    <span class="c1"># now go through all app labels</span>
    <span class="n">app_list</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">app_label</span> <span class="ow">in</span> <span class="n">app_labels</span><span class="p">:</span>
        <span class="n">app_config</span> <span class="o">=</span> <span class="n">apps</span><span class="o">.</span><span class="n">get_app_config</span><span class="p">(</span><span class="n">app_label</span><span class="p">)</span>
        <span class="n">app_list</span><span class="p">[</span><span class="n">app_config</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">models</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">sort_dependencies</span><span class="p">(</span><span class="n">app_list</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">allow_cycles</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">yield from</span> <span class="n">datadump_get_objects</span><span class="p">(</span><span class="n">models</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="apis_core.utils.helpers.get_html_diff" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_html_diff</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">show_a</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_b</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shorten</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Create an colorized html represenation of the difference of two values a and b
If <code>show_a</code> is True, colorize deletions in <code>a</code>
If <code>show_b</code> is True, colorize insertions in <code>b</code>
The value of <code>shorten</code> defines if long parts of strings that contains no change should be shortened</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/utils/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_html_diff</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">show_a</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_b</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shorten</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create an colorized html represenation of the difference of two values a and b</span>
<span class="sd">    If `show_a` is True, colorize deletions in `a`</span>
<span class="sd">    If `show_b` is True, colorize insertions in `b`</span>
<span class="sd">    The value of `shorten` defines if long parts of strings that contains no change should be shortened</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">style_remove</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;span class=&#39;diff-remove&#39;&gt;</span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s2">&lt;/span&gt;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">style_insert</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;span class=&#39;diff-insert&#39;&gt;</span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s2">&lt;/span&gt;&quot;</span>

    <span class="n">nones</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">nones</span> <span class="ow">and</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">nones</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">elif</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">nones</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">style_insert</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">if</span> <span class="n">show_b</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    <span class="k">elif</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">nones</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">style_remove</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">if</span> <span class="n">show_a</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="n">codes</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">get_opcodes</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">opcode</span><span class="p">,</span> <span class="n">a_start</span><span class="p">,</span> <span class="n">a_end</span><span class="p">,</span> <span class="n">b_start</span><span class="p">,</span> <span class="n">b_end</span> <span class="ow">in</span> <span class="n">codes</span><span class="p">:</span>
            <span class="k">match</span> <span class="n">opcode</span><span class="p">:</span>
                <span class="k">case</span> <span class="s2">&quot;equal&quot;</span><span class="p">:</span>
                    <span class="n">equal</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">a_start</span><span class="p">:</span><span class="n">a_end</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">shorten</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">equal</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">shorten</span><span class="p">:</span>
                        <span class="n">equal</span> <span class="o">=</span> <span class="n">equal</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; ... &quot;</span> <span class="o">+</span> <span class="n">equal</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span>
                    <span class="n">result</span> <span class="o">+=</span> <span class="n">equal</span>
                <span class="k">case</span> <span class="s2">&quot;delete&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">show_a</span><span class="p">:</span>
                        <span class="n">result</span> <span class="o">+=</span> <span class="n">style_remove</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">a_start</span><span class="p">:</span><span class="n">a_end</span><span class="p">])</span>
                <span class="k">case</span> <span class="s2">&quot;insert&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">show_b</span><span class="p">:</span>
                        <span class="n">result</span> <span class="o">+=</span> <span class="n">style_insert</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">b_start</span><span class="p">:</span><span class="n">b_end</span><span class="p">])</span>
                <span class="k">case</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">show_b</span><span class="p">:</span>
                        <span class="n">result</span> <span class="o">+=</span> <span class="n">style_insert</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">b_start</span><span class="p">:</span><span class="n">b_end</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">show_a</span><span class="p">:</span>
                        <span class="n">result</span> <span class="o">+=</span> <span class="n">style_remove</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">a_start</span><span class="p">:</span><span class="n">a_end</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="apis_core.utils.rdf" class="doc doc-heading">
            <code>rdf</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="apis_core.utils.rdf.build_sparql_query" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">build_sparql_query</span><span class="p">(</span><span class="n">curie</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Build a SPARQL query with language preferences.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>curie</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>predicate to filter on as defined in the toml.
    needs to include the predicate and optionally
    a lang tag to filter for separated with a comma.
    Eg "wdt:P122,en".</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A SPARQL query string</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>apis_core/utils/rdf.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">build_sparql_query</span><span class="p">(</span><span class="n">curie</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build a SPARQL query with language preferences.</span>

<span class="sd">    Args:</span>
<span class="sd">        curie: predicate to filter on as defined in the toml.</span>
<span class="sd">                needs to include the predicate and optionally</span>
<span class="sd">                a lang tag to filter for separated with a comma.</span>
<span class="sd">                Eg &quot;wdt:P122,en&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A SPARQL query string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">curie</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s2">&quot;select&quot;</span><span class="p">,</span> <span class="s2">&quot;prefix&quot;</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">curie</span>
    <span class="n">lang_tag</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;,&quot;</span> <span class="ow">in</span> <span class="n">curie</span><span class="p">:</span>
        <span class="n">curie</span><span class="p">,</span> <span class="n">lang_tag</span> <span class="o">=</span> <span class="n">curie</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">lang_tag</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;FILTER LANGMATCHES(LANG(?object), &quot;</span><span class="si">{</span><span class="n">lang_tag</span><span class="si">}</span><span class="s1">&quot;)&#39;</span>
    <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            SELECT ?object </span>
<span class="s2">            WHERE </span><span class="se">{{</span><span class="s2"> </span>
<span class="s2">                ?subject </span><span class="si">{</span><span class="n">curie</span><span class="si">}</span><span class="s2"> ?object </span><span class="si">{</span><span class="n">lang_tag</span><span class="si">}</span>
<span class="s2">            </span><span class="se">}}</span>
<span class="s2">        &quot;&quot;&quot;</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Generated SPARQL query: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">query</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="apis_core.utils.rdf.graph_matches_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">graph_matches_config</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">configfile</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Check if a file contains a config that matches this
graph and if so, return the config as dict. Otherwise
return False</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/utils/rdf.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">graph_matches_config</span><span class="p">(</span><span class="n">graph</span><span class="p">:</span> <span class="n">Graph</span><span class="p">,</span> <span class="n">configfile</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if a file contains a config that matches this</span>
<span class="sd">    graph and if so, return the config as dict. Otherwise</span>
<span class="sd">    return False</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">configfile</span><span class="p">):</span>
        <span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;relations&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s2">&quot;filters&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;attributes&quot;</span><span class="p">:</span> <span class="p">{}}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="n">att</span> <span class="k">for</span> <span class="n">att</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">configfile</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">att</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">)]:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">configfile</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
            <span class="k">match</span> <span class="n">value</span><span class="p">:</span>
                <span class="k">case</span> <span class="n">Filter</span><span class="p">():</span>
                    <span class="n">config</span><span class="p">[</span><span class="s2">&quot;filters&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                <span class="k">case</span> <span class="n">Attribute</span><span class="p">():</span>
                    <span class="n">config</span><span class="p">[</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">value</span>
                <span class="k">case</span> <span class="n">Relation</span><span class="p">():</span>
                    <span class="n">config</span><span class="p">[</span><span class="s2">&quot;relations&quot;</span><span class="p">][</span><span class="n">value</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">value</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">load_path</span><span class="p">(</span><span class="n">configfile</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_filter</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;filters&quot;</span><span class="p">,</span> <span class="p">[[(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]]):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_filter</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">_filter</span> <span class="o">=</span> <span class="n">_filter</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">triples</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">predicate</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">_filter</span><span class="p">:</span>
                <span class="n">triples</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="kc">None</span><span class="p">,</span> <span class="n">resolve</span><span class="p">(</span><span class="n">predicate</span><span class="p">,</span> <span class="n">graph</span><span class="p">),</span> <span class="n">resolve</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">graph</span><span class="p">)))</span>
            <span class="n">triples</span> <span class="o">=</span> <span class="p">[</span><span class="n">triple</span> <span class="ow">in</span> <span class="n">graph</span> <span class="k">for</span> <span class="n">triple</span> <span class="ow">in</span> <span class="n">triples</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">triples</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Using </span><span class="si">%s</span><span class="s2"> for parsing graph&quot;</span><span class="p">,</span> <span class="n">configfile</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">config</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Filter </span><span class="si">%s</span><span class="s2"> does not match: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">_filter</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="apis_core.utils.rdf.load_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Load a tomlfile either from a path or from the directory
<code>triple_configs</code> in any of the app directories.</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/utils/rdf.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_path</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load a tomlfile either from a path or from the directory</span>
<span class="sd">    `triple_configs` in any of the app directories.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tomllib</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">render_to_string</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
    <span class="k">except</span> <span class="n">TemplateDoesNotExist</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Tried to load template </span><span class="si">%s</span><span class="s2"> but it does not exist&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">directory</span> <span class="o">/</span> <span class="n">path</span> <span class="k">for</span> <span class="n">directory</span> <span class="ow">in</span> <span class="n">get_app_template_dirs</span><span class="p">(</span><span class="s2">&quot;triple_configs&quot;</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">file</span><span class="p">:</span> <span class="n">file</span><span class="o">.</span><span class="n">exists</span><span class="p">(),</span> <span class="n">files</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tomllib</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">read_text</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="apis_core.utils.rdf.resolve" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resolve</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">graph</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Look at the value of object and return the parsed
value. If the value starts and ens with angle brackets,
we interpret it as and transform it to an URI.
If the value is simple text we interpret it as an curie
and we expand it using the graphs namespace manager.
Otherwise we simply return the value</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/utils/rdf.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">resolve</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Look at the value of object and return the parsed</span>
<span class="sd">    value. If the value starts and ens with angle brackets,</span>
<span class="sd">    we interpret it as and transform it to an URI.</span>
<span class="sd">    If the value is simple text we interpret it as an curie</span>
<span class="sd">    and we expand it using the graphs namespace manager.</span>
<span class="sd">    Otherwise we simply return the value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">obj</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">URIRef</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">graph</span><span class="o">.</span><span class="n">namespace_manager</span><span class="o">.</span><span class="n">expand_curie</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">and</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">obj</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="apis_core.utils.settings" class="doc doc-heading">
            <code>settings</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="apis_core.utils.settings.get_entity_settings_by_modelname" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_entity_settings_by_modelname</span><span class="p">(</span><span class="n">entity</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>return the settings for a specific entity or the dict for all entities
if no entity is given</p>


            <details class="quote">
              <summary>Source code in <code>apis_core/utils/settings.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@deprecated</span><span class="p">(</span><span class="s2">&quot;Not used anywhere, so it will be dropped.&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_entity_settings_by_modelname</span><span class="p">(</span><span class="n">entity</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    return the settings for a specific entity or the dict for all entities</span>
<span class="sd">    if no entity is given</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">apis_entities</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s2">&quot;APIS_ENTITIES&quot;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="k">if</span> <span class="n">entity</span><span class="p">:</span>
        <span class="c1"># lookup entity settings by name and by capitalized name</span>
        <span class="k">return</span> <span class="n">apis_entities</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">apis_entities</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span> <span class="p">{}))</span>
    <span class="k">return</span> <span class="n">apis_entities</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>


  </div>

    </div>

</div></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>

        <div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
